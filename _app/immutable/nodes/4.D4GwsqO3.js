import"../chunks/DsnmJJEf.js";import{d as je,e as ie,a as l,p as Bt,k as qt,f as v,l as a,j as e,s as r,H as re,w as t,t as D,z as va,o as S,G as ye,n as le,V as Lt,an as ua}from"../chunks/BkhWOpPj.js";import{d as Gt,s as p,o as ba,e as sa}from"../chunks/CqLQNChA.js";import{l as kt,s as Ct,i as k,p as Rt}from"../chunks/DbalZYyT.js";import{a as wt,s as ta}from"../chunks/CPHStP6i.js";import{p as _a}from"../chunks/DzkggBSF.js";import{A as fa,d as xa,m as ra,a as Sa,e as rt,n as oa,o as $a,q as Jt,k as Ra,t as aa,b as $t,f as ga,g as na,l as Aa}from"../chunks/DpieVsxQ.js";import{C as ha,b as ca,c as ya,l as Da,a as Pa}from"../chunks/CbAYYRpU.js";import{e as ge,s as ce,i as Ge,r as yt,d as Ft,g as la,f as Ta}from"../chunks/Am2pCLS3.js";import{b as Ha}from"../chunks/p8T5NLcP.js";import{U as Fa,W as Va,r as wa}from"../chunks/Byzf0FCw.js";import{a as La,A as da,M as Ua,G as ia,D as Ba,b as qa,H as ka,C as Ca,c as Ga,I as Qa,s as Ja,d as Wa,L as Za,S as Xa,e as Ka}from"../chunks/CudhgMy-.js";import{k as za}from"../chunks/I8de5jbN.js";import{M as Ya,X as ea,P as Ut,c as er,T as Xt,b as tr,a as ar}from"../chunks/f4sK7lT0.js";import"../chunks/D9IBKMOw.js";import{I as zt,s as Et}from"../chunks/CUvy-rMn.js";import{S as rr,G as ir,P as Ea,u as pa,C as sr}from"../chunks/B87lhilk.js";import{C as ma}from"../chunks/DLp-uDZ5.js";import{b as nr}from"../chunks/CjcyXWTt.js";import{g as or}from"../chunks/hqda9HG3.js";function lr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"m6 9 6 6 6-6"}]];zt(_,Ct({name:"chevron-down"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function dr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"m18 15-6-6-6 6"}]];zt(_,Ct({name:"chevron-up"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function Ma(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335"}],["path",{d:"m9 11 3 3L22 4"}]];zt(_,Ct({name:"circle-check-big"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function vr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];zt(_,Ct({name:"copy"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function cr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];zt(_,Ct({name:"eye"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function ur(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4"}]];zt(_,Ct({name:"flame"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function br(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]];zt(_,Ct({name:"grip-vertical"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function Ia(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];zt(_,Ct({name:"layers"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function fr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"m16 6 4 14"}],["path",{d:"M12 6v14"}],["path",{d:"M8 8v12"}],["path",{d:"M4 4v16"}]];zt(_,Ct({name:"library"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function xr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3"}],["path",{d:"M21 21v.01"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7"}],["path",{d:"M3 12h.01"}],["path",{d:"M12 3h.01"}],["path",{d:"M12 16v.01"}],["path",{d:"M16 12h1"}],["path",{d:"M21 12v.01"}],["path",{d:"M12 21v-1"}]];zt(_,Ct({name:"qr-code"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function gr(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];zt(_,Ct({name:"rotate-ccw"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function Oa(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];zt(_,Ct({name:"save"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function Na(_,i){const f=kt(i,["children","$$slots","$$events","$$legacy"]);const O=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21"}]];zt(_,Ct({name:"swords"},()=>f,{get iconNode(){return O},children:(o,y)=>{var u=je(),g=ie(u);Et(g,i,"default",{}),l(o,u)},$$slots:{default:!0}}))}function pr(_){let i=!1;return document.body&&(document.body.appendChild(_),i=!0),{destroy(){i&&_.parentNode&&_.parentNode.removeChild(_)}}}var mr=v("<button> <!></button>"),_r=v('<p class="text-xs text-slate-600 italic">Nenhuma aflição selecionada.</p>'),hr=v('<div class="text-xs leading-tight"><span class="text-red-400 font-bold"> </span> <span class="text-slate-400"> </span></div>'),yr=v('<div class="space-y-1"></div>'),wr=v('<div class="grid grid-cols-2 gap-2 max-h-[60vh] overflow-y-auto custom-scrollbar p-1"></div> <div class="mt-4 pt-3 border-t border-slate-800 flex flex-col gap-2"><div class="p-3 bg-slate-900/50 rounded-lg border border-slate-700/50 min-h-[60px]"><p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Efeitos</p> <!></div> <div class="flex justify-end mt-2"><button class="bg-indigo-600 text-white px-4 py-2 rounded-xl font-bold text-sm shadow hover:bg-indigo-500 transition-colors w-full sm:w-auto">Concluído</button></div></div>',1),kr=v("<div><!></div>");function Cr(_,i){Bt(i,!0);var f=je(),O=ie(f);{var o=y=>{var u=kr(),g=a(u);Ya(g,{get isOpen(){return i.isOpen},get onClose(){return i.onClose},title:"Gerenciar Aflições",maxWidth:"max-w-md",children:(R,A)=>{var H=wr(),se=ie(H);ge(se,21,()=>Object.keys(fa),Ge,(C,F)=>{const B=re(()=>i.afflictions.includes(e(F)));var q=mr();q.__click=()=>i.onToggle(e(F));var P=a(q),V=r(P);{var pe=I=>{Ma(I,{size:14,class:"text-red-400"})};k(V,I=>{e(B)&&I(pe)})}t(q),D(()=>{ce(q,1,`flex items-center justify-between px-3 py-2 rounded-lg border text-xs font-bold transition-all ${e(B)?"bg-red-500/20 border-red-500 text-red-100":"bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-750"}`),p(P,`${e(F)??""} `)}),l(C,q)}),t(se);var de=r(se,2),U=a(de),ue=r(a(U),2);{var $=C=>{var F=_r();l(C,F)},J=C=>{var F=yr();ge(F,21,()=>i.afflictions,Ge,(B,q)=>{var P=hr(),V=a(P),pe=a(V);t(V);var I=r(V,2),me=a(I,!0);t(I),t(P),D(()=>{p(pe,`${e(q)??""}:`),p(me,fa[e(q)]?.effect)}),l(B,P)}),t(F),l(C,F)};k(ue,C=>{i.afflictions.length===0?C($):C(J,!1)})}t(U);var K=r(U,2),w=a(K);w.__click=function(...C){i.onClose?.apply(this,C)},t(K),t(de),l(R,H)},$$slots:{default:!0}}),t(u),La(u,R=>pr?.(R)),l(y,u)};k(O,y=>{i.isOpen&&y(o)})}l(_,f),qt()}Gt(["click"]);var zr=v('<div class="absolute top-0 right-0 bg-gradient-to-l from-yellow-600/20 to-transparent border-l border-b border-yellow-500/30 text-yellow-500 text-[9px] font-black tracking-widest px-3 py-1 rounded-bl-xl z-20 uppercase shadow-[0_0_10px_rgba(234,179,8,0.2)]">Iniciativa</div>'),Er=v('<div class="absolute inset-0 bg-red-950/40 animate-pulse z-0 pointer-events-none"></div>'),Mr=v('<span class="text-[9px] font-black bg-red-950/40 text-red-500 px-1.5 py-0.5 rounded border border-red-900/30 uppercase tracking-wider flex-shrink-0"> </span>'),Ir=v('<button title="Iniciativa"><!></button>'),Or=v('<button class="w-7 h-7 flex items-center justify-center rounded bg-slate-800/50 text-slate-600 hover:text-red-400 hover:bg-red-950/30 border border-slate-700/50 transition-colors"><!></button>'),Nr=v('<div><div class="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent"></div></div>'),jr=v('<div class="absolute inset-0 bg-gradient-to-r from-emerald-500/20 via-emerald-400/30 to-emerald-500/20 z-10"><div class="absolute inset-0 bg-gradient-to-b from-white/10 to-transparent"></div></div>'),Sr=v('<div class="absolute inset-0 flex items-center justify-center pointer-events-none z-20"><span class="text-[9px] font-black uppercase text-white drop-shadow-[0_1px_1px_rgba(0,0,0,0.8)] tracking-widest leading-none mt-0.5">INCAPACITADO</span></div>'),$r=v('<div class="absolute inset-0 flex items-center justify-center pointer-events-none z-20"><span class="text-[9px] font-black uppercase text-white drop-shadow-[0_1px_1px_rgba(0,0,0,0.8)] tracking-widest leading-none mt-0.5">FERIDO</span></div>'),Rr=v('<button class="text-[9px] bg-red-500/10 text-red-400 px-1.5 py-0.5 rounded border border-red-500/20 hover:bg-red-500/20 hover:border-red-500/40 transition-all flex items-center gap-1 group/btn"> <!></button>'),Ar=v('<div class="bg-slate-900/50 p-2 rounded border border-slate-800/50 text-center"><span class="text-[9px] text-slate-500 uppercase font-black block mb-0.5"> </span> <div class="text-white font-bold font-mono text-lg leading-none"> </div> <div> </div></div>'),Dr=v('<div class="text-sm bg-slate-900/30 p-2 rounded border border-slate-800/30"><span class="font-bold text-slate-300"> </span> <span class="text-slate-400 text-xs block mt-1 leading-relaxed"> </span></div>'),Pr=v('<div><div> <span class="h-px flex-1 bg-current opacity-20"></span></div> <div class="grid gap-2"></div></div>'),Tr=v('<div class="border-t border-slate-800/50 bg-slate-950/30 p-4"><div class="mb-4"><div class="text-slate-500 font-bold uppercase text-[10px] mb-2 flex items-center gap-2"><span>Atributos</span> <div class="h-px flex-1 bg-slate-800"></div></div> <div class="grid grid-cols-4 gap-2"></div></div> <div class="grid grid-cols-3 gap-4 mb-4"><div class="p-2 rounded bg-slate-900/50 border border-slate-800/50 flex flex-col items-center"><span class="text-[9px] text-slate-500 uppercase font-black">Tamanho</span> <span class="text-white font-bold"> </span></div> <div class="p-2 rounded bg-slate-900/50 border border-slate-800/50 flex flex-col items-center"><span class="text-[9px] text-slate-500 uppercase font-black">Deslocamento</span> <span class="text-white font-bold"> </span></div> <div class="p-2 rounded bg-slate-900/50 border border-slate-800/50 flex flex-col items-center"><span class="text-[9px] text-slate-500 uppercase font-black">Defesa</span> <span class="text-white font-bold"> </span></div></div> <div class="space-y-4"></div></div>'),Hr=v('<div><!> <!> <div class="relative z-10 p-4"><div class="flex items-start gap-4 mb-3"><div class="relative flex-shrink-0"><div><!></div> <button><!></button></div> <div class="flex-1 min-w-0"><div class="flex justify-between items-start mb-1"><div class="flex flex-col min-w-0 mr-2"><div class="flex items-center gap-2"><h3> </h3> <!></div></div> <div class="flex gap-1 flex-shrink-0"><button class="w-7 h-7 flex items-center justify-center rounded bg-slate-800 text-slate-500 hover:text-white hover:bg-slate-700 border border-slate-700/50 transition-colors"><!></button> <!></div></div>  <div class="relative w-full h-3.5 sm:h-4 bg-slate-950 rounded-full border border-white/5 overflow-hidden shadow-inner group-hover:border-white/20 transition-all mb-2"><div></div> <!> <!> <!></div> <div class="flex flex-col sm:flex-row gap-3"><div class="flex items-start gap-1.5"><div class="flex flex-col items-center justify-between bg-slate-900 border border-slate-700 rounded-lg p-1.5 w-[4.5rem] h-[3.75rem] shadow-sm"><span class="text-[9px] font-black text-slate-400 uppercase tracking-wider mb-0.5">Def</span> <span class="text-xl font-bold text-white font-mono leading-none"> </span></div> <div class="flex flex-col items-center justify-between bg-red-950/30 border border-red-900/50 rounded-lg p-1.5 w-[4.5rem] h-[3.75rem] shadow-sm relative group/dmg"><span class="text-[9px] font-black text-red-400 uppercase tracking-wider mb-0.5">Dano</span> <input type="number" class="w-full bg-transparent text-center text-white font-mono font-bold text-xl focus:outline-none p-0 leading-none placeholder-red-800"/> <span class="absolute -top-1 -right-1 flex h-2 w-2 opacity-0 group-hover/dmg:opacity-100 transition-opacity"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span></span></div> <div><span>Vida</span> <div class="flex items-baseline gap-0.5 justify-center w-full"><input type="number" class="w-full bg-transparent text-right text-white font-mono font-bold text-xl focus:outline-none p-0 leading-none"/> <span class="text-[10px] text-slate-500 font-mono self-end mb-0.5 opacity-70"> </span></div></div></div> <div class="flex flex-wrap gap-1.5 items-center flex-1"><!> <button class="text-[10px] sm:text-[9px] font-bold text-slate-500 hover:text-indigo-400 px-1.5 py-0.5 rounded border border-transparent hover:border-indigo-500/30 hover:bg-indigo-500/10 transition-all flex items-center gap-1 whitespace-nowrap"><!> Aflição</button></div></div></div></div></div>  <!> <!></div>');function Fr(_,i){Bt(i,!0);let f=Rt(i,"updateEnemy",3,(c,m)=>{}),O=Rt(i,"updatePlayer",3,(c,m)=>{}),o=Rt(i,"removeFromCombat",3,c=>{}),y=re(()=>i.entity.type==="player"),u=re(()=>i.entity.damage||0),g=re(()=>i.entity.normalHealth||i.entity.health||10),R=re(()=>i.entity.currentHealth??e(g)),A=re(()=>e(u)>=e(R)),H=re(()=>e(u)>=e(R)/2&&!e(A)),se=re(()=>e(R)>0?Math.min(100,Math.max(0,e(u)/e(R)*100)):100),de=ye(!1),U=ye(!1);va(()=>{const c=i.entity.afflictions||[],m=c.includes("Incapacitated");if(e(A)&&!m){const ee={afflictions:[...c,"Incapacitated"]};i.entity.type==="player"?ue(ee):f()(i.entity.instanceId,ee)}else if(!e(A)&&m){const ee={afflictions:c.filter(Re=>Re!=="Incapacitated")};i.entity.type==="player"?ue(ee):f()(i.entity.instanceId,ee)}});function ue(c){if(i.entity.type!=="player")return;const m=xa.get(i.entity.id);m&&xa.set(i.entity.id,{...m,...c}),O()(i.entity.id,c),ra({id:i.entity.id,...c})}function $(c){const m=parseInt(c.target.value);if(isNaN(m))return;const ee={damage:Math.max(0,m)};i.entity.type==="player"?ue(ee):f()(i.entity.instanceId,ee)}function J(c){const m=parseInt(c.target.value);if(isNaN(m))return;const W=Math.max(0,m);let ee=e(u);W<e(u)&&(ee=W);const Re={currentHealth:W,damage:ee};i.entity.type==="player"?ue(Re):f()(i.entity.instanceId,Re)}function K(){const c=!i.entity.acted;i.entity.type==="player"?ue({acted:c}):f()(i.entity.instanceId,{acted:c})}function w(){i.entity.type==="player"&&ue({initiative:!i.entity.initiative})}function C(c){const m=i.entity.afflictions||[],ee={afflictions:m.includes(c)?m.filter(Re=>Re!==c):[...m,c]};i.entity.type==="player"?ue(ee):f()(i.entity.instanceId,ee)}var F=Hr(),B=a(F);{var q=c=>{var m=zr();l(c,m)};k(B,c=>{e(y)&&i.entity.initiative&&c(q)})}var P=r(B,2);{var V=c=>{var m=Er();l(c,m)};k(P,c=>{e(A)&&c(V)})}var pe=r(P,2),I=a(pe),me=a(I),Pe=a(me),Ue=a(Pe);za(Ue,()=>i.entity.imageUrl,c=>{{let m=re(()=>i.entity.name.charAt(0));da(c,{get hash(){return i.entity.imageUrl},get alt(){return i.entity.name},size:"custom",get fallbackText(){return e(m)}})}}),t(Pe);var Oe=r(Pe,2);Oe.__click=K;var it=a(Oe);{var ft=c=>{rr(c,{size:14,class:""})},st=c=>{var m=je(),W=ie(m);{var ee=h=>{Ma(h,{size:14})},Re=h=>{Na(h,{size:14})};k(W,h=>{i.entity.acted?h(ee):h(Re,!1)},!0)}l(c,m)};k(it,c=>{e(A)?c(ft):c(st,!1)})}t(Oe),t(me);var nt=r(me,2),we=a(nt),Y=a(we),Qe=a(Y),Je=a(Qe),Fe=a(Je,!0);t(Je);var be=r(Je,2);{var tt=c=>{var m=Mr(),W=a(m);t(m),D(()=>p(W,`Dif ${i.entity.difficulty??""}`)),l(c,m)};k(be,c=>{e(y)||c(tt)})}t(Qe),t(Y);var Ze=r(Y,2),ot=a(Ze);ot.__click=()=>S(de,!e(de));var Xe=a(ot);{var mt=c=>{dr(c,{size:14})},_t=c=>{lr(c,{size:14})};k(Xe,c=>{e(de)?c(mt):c(_t,!1)})}t(ot);var xt=r(ot,2);{var z=c=>{var m=Ir();m.__click=w;var W=a(m);ur(W,{size:14}),t(m),D(()=>ce(m,1,`w-7 h-7 flex items-center justify-center rounded transition-all ${i.entity.initiative?"bg-yellow-500 text-yellow-950 shadow-lg shadow-yellow-500/20":"bg-slate-800 text-slate-500 hover:text-white hover:bg-slate-700"}`)),l(c,m)},E=c=>{var m=Or();m.__click=()=>o()(i.entity.instanceId);var W=a(m);ea(W,{size:14}),t(m),l(c,m)};k(xt,c=>{e(y)?c(z):c(E,!1)})}t(Ze),t(we);var L=r(we,2),Se=a(L),Ne=r(Se,2);{var Ve=c=>{var m=Nr();D(()=>{ce(m,1,`absolute top-0 left-0 h-full transition-all duration-500 ease-out z-10 
                            ${e(A)?"bg-gradient-to-r from-red-600 via-red-500 to-rose-500 animate-pulse":e(se)>=80?"bg-gradient-to-r from-red-600 to-rose-500":e(H)?"bg-gradient-to-r from-amber-600 to-orange-500":"bg-gradient-to-r from-orange-500 to-amber-400"}`),Ta(m,`width: ${e(se)??""}%`)}),l(c,m)};k(Ne,c=>{e(se)>0&&c(Ve)})}var ke=r(Ne,2);{var lt=c=>{var m=jr();l(c,m)};k(ke,c=>{e(u)===0&&c(lt)})}var Mt=r(ke,2);{var It=c=>{var m=Sr();l(c,m)},Pt=c=>{var m=je(),W=ie(m);{var ee=Re=>{var h=$r();l(Re,h)};k(W,Re=>{e(H)&&Re(ee)},!0)}l(c,m)};k(Mt,c=>{e(A)?c(It):c(Pt,!1)})}t(L);var Ke=r(L,2),ht=a(Ke),We=a(ht),Ot=r(a(We),2),Le=a(Ot,!0);t(Ot),t(We);var dt=r(We,2),$e=r(a(dt),2);yt($e),$e.__input=$,le(2),t(dt);var Ye=r(dt,2),Nt=a(Ye),jt=r(Nt,2),Be=a(jt);yt(Be),Be.__input=J;var gt=r(Be,2),St=a(gt);t(gt),t(jt),t(Ye),t(ht);var pt=r(ht,2),Tt=a(pt);ge(Tt,17,()=>i.entity.afflictions||[],Ge,(c,m)=>{var W=Rr();W.__click=()=>C(e(m));var ee=a(W),Re=r(ee);ea(Re,{size:8,class:"opacity-50 group-hover/btn:opacity-100"}),t(W),D(()=>p(ee,`${e(m)??""} `)),l(c,W)});var At=r(Tt,2);At.__click=()=>S(U,!0);var Kt=a(At);Ut(Kt,{size:10}),le(),t(At),t(pt),t(Ke),t(nt),t(I),t(pe);var Vt=r(pe,2);{var Yt=c=>{var m=Tr(),W=a(m),ee=r(a(W),2);ge(ee,20,()=>["str","agi","int","wil"],Ge,(et,xe)=>{var Ie=Ar(),qe=a(Ie),vt=a(qe,!0);t(qe);var Ae=r(qe,2),Te=a(Ae,!0);t(Ae);var _e=r(Ae,2),ct=a(_e);t(_e),t(Ie),D(()=>{p(vt,xe),p(Te,i.entity.stats?.[xe]??i.entity.attributes?.[xe]??10),ce(_e,1,`text-[9px] font-bold ${(i.entity.stats?.[xe]??i.entity.attributes?.[xe]??10)-10>=0?"text-emerald-500":"text-red-500"}`),p(ct,`${(i.entity.stats?.[xe]??i.entity.attributes?.[xe]??10)-10>=0?"+":""}${(i.entity.stats?.[xe]??i.entity.attributes?.[xe]??10)-10}`)}),l(et,Ie)}),t(ee),t(W);var Re=r(W,2),h=a(Re),N=r(a(h),2),Q=a(N,!0);t(N),t(h);var te=r(h,2),ze=r(a(te),2),ae=a(ze,!0);t(ze),t(te);var G=r(te,2),Ee=r(a(G),2),fe=a(Ee,!0);t(Ee),t(G),t(Re);var Me=r(Re,2);ge(Me,20,()=>[{key:"traits",label:"Traços",color:"text-amber-500"},{key:"actions",label:"Ações",color:"text-red-400"},{key:"reactions",label:"Reações",color:"text-indigo-400"},{key:"end_of_round",label:"Fim da Rodada",color:"text-emerald-400"}],Ge,(et,xe)=>{var Ie=je(),qe=ie(Ie);{var vt=Ae=>{var Te=Pr(),_e=a(Te),ct=a(_e);le(),t(_e);var ut=r(_e,2);ge(ut,21,()=>i.entity[xe.key],Ge,(s,n)=>{var d=Dr(),b=a(d),M=a(b,!0);t(b);var j=r(b,2),x=a(j,!0);t(j),t(d),D(()=>{p(M,e(n).name),p(x,e(n).description||e(n).effect)}),l(s,d)}),t(ut),t(Te),D(()=>{ce(_e,1,`${xe.color??""} text-[10px] font-black uppercase mb-2 flex items-center gap-2`),p(ct,`${xe.label??""} `)}),l(Ae,Te)};k(qe,Ae=>{i.entity[xe.key]&&i.entity[xe.key].length>0&&Ae(vt)})}l(et,Ie)}),t(Me),t(m),D(()=>{p(Q,i.entity.size||1),p(ae,i.entity.speed||10),p(fe,i.entity.defense||10)}),l(c,m)};k(Vt,c=>{e(de)&&c(Yt)})}var Wt=r(Vt,2);{let c=re(()=>i.entity.afflictions||[]);Cr(Wt,{get isOpen(){return e(U)},onClose:()=>S(U,!1),get afflictions(){return e(c)},onToggle:C})}t(F),D(()=>{ce(F,1,`group relative overflow-hidden transition-all duration-300 rounded-2xl border ${e(y)?"bg-slate-900/80 border-indigo-500/30 hover:border-indigo-500/50 hover:shadow-indigo-900/20":"bg-slate-950/80 border-red-900/30 hover:border-red-800/50 hover:shadow-red-900/10"} shadow-lg backdrop-blur-sm`),ce(Pe,1,`w-14 h-14 rounded-2xl overflow-hidden border-2 shadow-xl transition-transform group-hover:scale-105 ${e(A)?"border-red-600 grayscale brightness-50":e(y)?"border-indigo-500/50":"border-red-900/50"}`),ce(Oe,1,`absolute -bottom-2 -right-2 w-7 h-7 rounded-lg flex items-center justify-center border shadow-lg transition-all hover:scale-110 z-20 ${i.entity.acted?"bg-slate-800 border-slate-600 text-slate-500":e(y)?"bg-indigo-600 border-indigo-400 text-white":"bg-red-600 border-red-400 text-white"}`),Ft(Oe,"title",i.entity.acted?"Já agiu":"Agir"),ce(Je,1,`text-base font-bold truncate leading-snug ${e(y)?"text-white":"text-red-100 font-serif tracking-wide"}`),p(Fe,i.entity.name),ce(Se,1,`absolute inset-0 w-full ${e(u)===0?"bg-emerald-900/20":"bg-slate-900/50"}`),p(Le,i.entity.defense||10),la($e,e(u)),ce(Ye,1,`flex flex-col items-center justify-between border rounded-lg p-1.5 w-[5.5rem] h-[3.75rem] shadow-sm relative transition-colors ${e(A)?"bg-red-950/50 border-red-500":e(H)?"bg-orange-950/30 border-orange-500":"bg-emerald-950/30 border-emerald-900/50"}`),ce(Nt,1,`text-[9px] font-black uppercase tracking-wider mb-0.5 ${e(A)?"text-red-400":e(H)?"text-orange-400":"text-emerald-400"}`),la(Be,e(R)),p(St,`/${e(g)??""}`)}),l(_,F),qt()}Gt(["click","input"]);function Vr(_,{from:i,to:f},O={}){var{delay:o=0,duration:y=q=>Math.sqrt(q)*120,easing:u=er}=O,g=getComputedStyle(_),R=g.transform==="none"?"":g.transform,[A,H]=g.transformOrigin.split(" ").map(parseFloat);A/=_.clientWidth,H/=_.clientHeight;var se=Lr(_),de=_.clientWidth/f.width/se,U=_.clientHeight/f.height/se,ue=i.left+i.width*A,$=i.top+i.height*H,J=f.left+f.width*A,K=f.top+f.height*H,w=(ue-J)*de,C=($-K)*U,F=i.width/f.width,B=i.height/f.height;return{delay:o,duration:typeof y=="function"?y(Math.sqrt(w*w+C*C)):y,easing:u,css:(q,P)=>{var V=P*w,pe=P*C,I=q+P*F,me=q+P*B;return`transform: ${R} translate(${V}px, ${pe}px) scale(${I}, ${me});`}}}function Lr(_){if("currentCSSZoom"in _)return _.currentCSSZoom;for(var i=_,f=1;i!==null;)f*=+getComputedStyle(i).zoom,i=i.parentElement;return f}function Ur(_,i=1,f=0){const O=[];let o=0;for(let R=0;R<i;R++){const A=Math.floor(Math.random()*_)+1;O.push(A),o+=A}let y=`${i}d${_}`,u=[],g=0;if(f!==0)if(_===20){const R=Math.abs(f);for(let H=0;H<R;H++)u.push(Math.floor(Math.random()*6)+1);const A=Math.max(...u);f>0?(g=A,o+=A,y+=` + ${A} [Boon]`):(g=-A,o-=A,y+=` - ${A} [Bane]`)}else g=f,o+=f,y+=f>0?` + ${f}`:` - ${Math.abs(f)}`;return{total:o,results:O,bonusRolls:u,formula:y,crit:_===20&&O.includes(20),modifierTotal:g}}var Br=v('<span class="text-[10px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded-full"> </span>'),qr=v('<div class="p-3 rounded-xl border border-amber-500/30 bg-amber-500/5 flex items-center gap-3 transition-all hover:bg-amber-500/10 shadow-sm"><div class="flex-1"><div class="font-bold text-sm text-amber-200 leading-none"> </div> <div class="text-[9px] text-amber-500/60 font-medium mt-1 uppercase tracking-tighter">Novo pedido de entrada</div></div> <div class="flex items-center gap-1.5"><button class="p-2 rounded-lg bg-green-600/20 text-green-400 hover:bg-green-600 hover:text-white transition-all shadow-lg active:scale-90" title="Aprovar"><!></button> <button class="p-2 rounded-lg bg-red-600/20 text-red-400 hover:bg-red-600 hover:text-white transition-all shadow-lg active:scale-90" title="Recusar"><!></button></div></div>'),Gr=v('<div class="space-y-2 animate-in fade-in slide-in-from-top-2"><div class="flex items-center gap-2 px-1"><div class="w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse"></div> <span class="text-[10px] font-black text-amber-500 uppercase tracking-wider"> </span></div> <!> <div class="h-px bg-slate-800/50 mx-2 my-2"></div></div>'),Qr=v('<span class="text-indigo-400 font-bold uppercase tracking-tighter mr-1">Sessão</span>'),Jr=v('<div><div></div> <div class="flex-1"><div> </div> <div class="text-[10px] text-slate-500 font-medium"><!> </div></div> <div class="flex items-center gap-1"><button><!></button> <button class="text-slate-600 hover:text-red-400 p-1.5 hover:bg-red-400/10 rounded-lg transition-all" title="Expulsar da Campanha"><!></button></div></div>'),Wr=v('<div class="text-xs text-slate-600 italic p-6 border-2 border-dashed border-slate-800 rounded-xl text-center">Nenhum jogador na sessão.</div>'),Zr=v('<button class="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl font-black uppercase text-[10px] tracking-[0.2em] shadow-lg shadow-indigo-900/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2"><!> Publicar Sessão</button> <p class="text-[9px] text-slate-600 text-center font-bold uppercase tracking-tighter">Torne sua sessão visível e obtenha o link de convite</p>',1),Xr=v('<div class="flex justify-center p-3 bg-white rounded-xl mb-2 animate-in zoom-in-95 duration-200 shadow-xl mx-auto w-32 h-32"><img alt="QR Code de Convite" class="w-24 h-24"/></div>'),Kr=v('<div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-green-500 text-white text-[10px] font-bold rounded shadow-lg animate-in fade-in slide-in-from-bottom-1 whitespace-nowrap"><!> Copiado!</div>'),Yr=v('<div class="flex items-center justify-between"><div class="flex items-center gap-2"><span class="text-[10px] font-black text-indigo-400 uppercase tracking-widest flex items-center gap-1"><!> Sessão Pública</span></div> <button class="text-slate-500 hover:text-white transition-colors p-1" title="Ver QR Code"><!></button></div> <!> <div class="relative group"><div class="flex gap-1"><div class="flex-1 bg-slate-950 border border-slate-800 rounded-lg p-2 text-[10px] text-slate-400 font-mono truncate cursor-pointer hover:border-slate-700 transition-colors flex items-center"> </div> <button class="bg-indigo-600 hover:bg-indigo-500 text-white p-2 rounded-lg transition-all active:scale-95 shadow-lg shadow-indigo-900/20 relative" aria-label="Copiar link"><!> <!></button></div></div> <button class="w-full text-[9px] text-slate-600 hover:text-red-400 font-bold uppercase tracking-widest transition-colors mt-1">Retirar de área pública</button>',1),ei=v('<div class="flex justify-between items-center bg-slate-950 p-2 rounded border border-slate-800 group hover:border-indigo-500/30 transition-all"><div class="truncate flex-1 flex items-center gap-2"><!> <div><div class="text-sm font-bold text-white truncate"> </div> <div class="text-[10px] text-slate-500"> </div></div></div> <button class="text-slate-500 hover:text-indigo-400 p-1 ml-2 bg-slate-900 rounded border border-slate-800"><!></button></div>'),ti=v('<div class="text-center text-slate-600 italic text-xs mt-4">Nenhum inimigo.</div>'),ai=v("<!> <!>",1),ri=v('<div class="flex justify-between items-center bg-slate-950 p-2 rounded border border-slate-800 group hover:border-indigo-500/30 transition-all"><div class="truncate flex-1"><div class="text-sm font-bold text-white truncate"> </div> <div class="text-[10px] text-slate-500"> </div></div> <button class="text-slate-500 hover:text-indigo-400 p-1 ml-2 bg-slate-900 rounded border border-slate-800"><!></button></div>'),ii=v('<div class="text-center text-slate-600 italic text-xs mt-4">Nenhum encontro.</div>'),si=v("<!> <!>",1),ni=v('<button class="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-lg font-bold flex items-center gap-2 shadow-lg shadow-green-900/20"><!> INICIAR COMBATE</button>'),oi=v('<div class="flex items-center gap-4"><button class="p-2 hover:bg-slate-700 rounded text-slate-400" title="Voltar Rodada"><!></button> <div class="text-center"><div class="text-[10px] font-bold text-slate-500 uppercase">Rodada</div><div class="text-3xl font-mono font-bold text-white leading-none"> </div></div> <button class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded font-bold flex items-center gap-2" title="Próxima Rodada"><!> Próxima</button> <div class="h-8 w-px bg-slate-700 mx-2"></div> <button class="text-red-400 hover:text-red-300 text-xs font-bold px-3 py-2 border border-red-900/30 rounded bg-red-900/10">Encerrar</button></div>'),li=v("<div><!></div>"),di=v('<div class="text-center text-slate-500 italic py-10">Combate vazio.</div>'),vi=v('<div class="text-sm"><span class="font-bold text-yellow-500"> </span> <span class="text-slate-300"> </span></div>'),ci=v('<div class="bg-slate-900 border border-slate-700 rounded-lg p-4"><h4 class="font-bold text-white mb-2 pb-2 border-b border-slate-800 flex items-center gap-2"><!> </h4> <div class="space-y-2"></div></div>'),ui=v('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4" role="button" aria-label="Fechar" tabindex="-1"><div class="bg-slate-800 rounded-xl w-full max-w-lg border border-slate-700 shadow-2xl p-6 relative" role="dialog" aria-modal="true"><div class="flex items-center gap-3 mb-6"><div class="p-3 bg-yellow-900/20 rounded-full border border-yellow-500/30 text-yellow-500"><!></div> <div><h3 class="font-bold text-white text-xl">Fim da Rodada</h3> <p class="text-slate-400 text-sm">Resumo dos efeitos que ocorrem agora.</p></div></div> <div class="space-y-4 mb-8 max-h-[60vh] overflow-y-auto custom-scrollbar"></div> <div class="flex gap-3"><button class="flex-1 py-1.5 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold text-sm">Cancelar</button> <button class="flex-1 py-1.5 rounded bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-sm">Avançar Rodada</button></div></div></div>'),bi=v('<button class="w-full text-left flex items-center gap-3 p-3 bg-slate-900 border border-slate-700 hover:border-indigo-500 hover:bg-indigo-500/10 rounded-xl group transition-all"><div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-sm font-bold text-slate-500 group-hover:text-indigo-400 border border-slate-700 group-hover:border-indigo-500/30"> </div> <div class="flex-1"><div class="font-bold text-white group-hover:text-indigo-300"> </div> <div class="text-[10px] text-slate-500"> </div></div> <div class="bg-slate-800 p-2 rounded-lg text-slate-500 group-hover:bg-indigo-500 group-hover:text-white transition-colors"><!></div></button>'),fi=v('<div class="text-center py-8"><div class="w-12 h-12 bg-slate-700/50 rounded-full flex items-center justify-center mx-auto mb-3 text-slate-500"><!></div> <p class="text-slate-500 text-sm font-bold">Nenhum personagem disponível.</p> <p class="text-[10px] text-slate-600 mt-1">Todos os personagens da campanha já estão na sessão.</p></div>'),xi=v('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4" role="button" aria-label="Fechar" tabindex="-1"><div class="bg-slate-800 rounded-xl w-full max-w-md border border-slate-700 shadow-2xl p-6" role="dialog" aria-modal="true"><div class="flex justify-between items-center mb-6"><div><h3 class="font-bold text-white text-lg">Gerenciar Sessão</h3> <p class="text-xs text-slate-400">Adicione personagens disponíveis à sessão.</p></div> <button class="bg-slate-700 hover:bg-slate-600 p-2 rounded-lg text-white transition-colors"><!></button></div> <div class="space-y-3 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2"><!> <!></div></div></div>'),gi=v('<div class="grid grid-cols-1 lg:grid-cols-4 gap-6 h-full relative"><div class="space-y-6"><div class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex flex-col gap-4"><div class="flex justify-between items-center bg-slate-950/50 p-2 rounded-lg border border-slate-800"><h3 class="text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><!> Personagens <!></h3> <button class="text-[10px] bg-slate-800 hover:bg-slate-700 text-white px-2.5 py-1.5 rounded-md font-bold transition-all border border-slate-700 active:scale-95"> </button></div> <!> <div class="space-y-2 flex-1 overflow-y-auto max-h-[300px] custom-scrollbar pr-1"><div class="space-y-2"><!> <!></div></div> <div class="pt-4 border-t border-slate-800 space-y-3"><!></div></div> <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex flex-col h-[400px]"><div class="flex items-center gap-2 mb-3 bg-slate-950 p-1 rounded-lg border border-slate-800"><button><!> Inimigos</button> <button><!> Encontros</button></div> <div class="flex-1 overflow-y-auto pr-1 custom-scrollbar space-y-2"><!></div></div></div> <div class="lg:col-span-2 space-y-4"><div class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex justify-between items-center shadow-lg sticky top-0 z-20"><div class="flex items-center gap-4"><!></div></div> <div class="space-y-3 pb-20"><!> <!></div></div> <div class="hidden lg:flex flex-col gap-4"></div></div> <!> <div class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur-md border border-slate-700 rounded-2xl p-2 flex items-center gap-2 shadow-2xl z-40 animate-in slide-in-from-bottom-4"><div class="px-3 border-r border-slate-700 flex items-center gap-2 text-slate-400 font-bold text-xs uppercase"><!> Quick</div> <button class="bg-slate-800 hover:bg-indigo-600 text-white font-bold w-10 h-10 rounded-xl flex items-center justify-center transition-all hover:-translate-y-1 shadow-lg">d20</button> <button class="bg-slate-800 hover:bg-indigo-600 text-white font-bold w-10 h-10 rounded-xl flex items-center justify-center transition-all hover:-translate-y-1 shadow-lg">d6</button> <button class="bg-slate-800 hover:bg-indigo-600 text-white font-bold w-10 h-10 rounded-xl flex items-center justify-center transition-all hover:-translate-y-1 shadow-lg text-xs">2d6</button> <button class="bg-slate-800 hover:bg-indigo-600 text-white font-bold w-10 h-10 rounded-xl flex items-center justify-center transition-all hover:-translate-y-1 shadow-lg text-xs">3d6</button></div> <!> <!> <!> <!>',1);function pi(_,i){Bt(i,!0);const f=()=>wt(Da,"$liveCharacters",u),O=()=>wt(ca,"$liveEnemies",u),o=()=>wt(ya,"$liveEncounters",u),y=()=>wt(Jt,"$isHistoryOpen",u),[u,g]=ta();let R=ye(!1),A=ye(!1),H=ye(!1);const se={active:!1,round:1};let de=ye("enemies"),U=ye(!1),ue=ye(Lt([])),$=ye(Lt({isOpen:!1,title:"",message:"",onConfirm:()=>{}}));ba(()=>{if(i.campaign?.id){Sa(i.campaign.id,!0);const s=setInterval(()=>{const n=rt.get(i.campaign.id)||i.campaign;oa(i.campaign.id,{name:n.name,gmName:n.gmName||"Mestre"})},3e4);return()=>{clearInterval(s),$a()}}});const J=re(()=>typeof window<"u"?`${window.location.origin}${wa("/campaigns/[id]/invite",{id:i.campaign?.id})}`:"");function K(){e(J)&&(navigator.clipboard.writeText(e(J)),S(A,!0),setTimeout(()=>{S(A,!1)},2e3))}let w=re(()=>i.campaign?.sessionRoster||[]),C=re(()=>i.campaign?.combat||se),F=re(()=>i.campaign?.activeEnemies||[]),B=re(()=>i.campaign?.members||[]),q=re(()=>Array.from(new Set([...e(w),...e(B).map(n=>n.id)])).map(n=>{const d=f().find(M=>M.id===n),b=e(B).find(M=>M.id===n);return d&&b?{...d,...b,lastUpdate:b.lastUpdate}:d||b}).filter(Boolean)),P=re(()=>e(q).filter(s=>!s.campaignApproval||s.campaignApproval==="approved")),V=re(()=>e(q).filter(s=>s.campaignApproval==="pending")),pe=re(()=>f().filter(s=>!e(w).includes(s.id)&&!e(B).some(n=>n.id===s.id)));function I(s){if(!i.campaign?.id)return;const d={...rt.get(i.campaign.id)||i.campaign,...s};rt.set(i.campaign.id,d),s.combat&&aa(i.campaign.id,s.combat),(s.name||s.gmName)&&oa(i.campaign.id,{name:d.name,gmName:d.gmName})}function me(s){if(e(w).includes(s)){const n=e(w).filter(d=>d!==s);I({sessionRoster:n})}else{const n=[...e(w),s];I({sessionRoster:n})}}function Pe(s){xt(s,{campaignApproval:"approved"}),ra({id:s,campaignApproval:"approved"})}function Ue(s){ra({id:s,campaignApproval:"rejected",campaignId:null});const d=((rt.get(i.campaign.id)||i.campaign).members||[]).filter(b=>b.id!==s);I({members:d})}function Oe(s){const n=e(q).find(d=>d.id===s);S($,{isOpen:!0,title:"Remover da Campanha",message:`Deseja remover ${n?.name||"este personagem"} da campanha? Eles poderão entrar novamente através do link de convite.`,onConfirm:()=>{const d=rt.get(i.campaign.id)||i.campaign;ra({id:s,campaignId:null});const b=(d.sessionRoster||[]).filter(x=>x!==s),M=(d.members||[]).filter(x=>x.id!==s),j=(d.activeEnemies||[]).filter(x=>x.type!=="player"||x.id!==s);I({sessionRoster:b,members:M,activeEnemies:j}),e($).isOpen=!1}},!0)}function it(s){const d=(rt.get(i.campaign.id)||i.campaign).activeEnemies||[],b={...s,instanceId:`e_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,damage:0,currentHealth:s.health,afflictions:[],acted:!1,initiative:!1};I({activeEnemies:[...d,b]})}function ft(s){const d=(rt.get(i.campaign.id)||i.campaign).activeEnemies||[];let b=[];s.enemies.forEach(M=>{const j=O().find(x=>x.id===M.enemyId);if(j)for(let x=0;x<M.count;x++)b.push({...j,instanceId:`e_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,damage:0,currentHealth:j.health,afflictions:[],acted:!1,initiative:!1})}),I({activeEnemies:[...d,...b]})}function st(){I({combat:{active:!0,round:1}}),aa(i.campaign.id,{active:!0,round:1})}function nt(){const s=e(F).filter(n=>n.damage<(n.currentHealth??n.health)&&n.endOfRound&&n.endOfRound.length>0).map(n=>({name:n.name,effects:n.endOfRound}));if(s.length>0){S(ue,s,!0),S(U,!0);return}we()}function we(){const s=rt.get(i.campaign.id)||i.campaign,n=(s.combat?.round||1)+1,d=(s.activeEnemies||[]).map(b=>({...b,acted:!1}));I({combat:{...s.combat,round:n},activeEnemies:d}),aa(i.campaign.id,{active:!0,round:n}),S(U,!1)}function Y(s){I({combat:{active:!1,round:1}}),aa(i.campaign.id,{active:!1,round:1})}function Qe(s){const n=rt.get(i.campaign.id)||i.campaign;I({activeEnemies:(n.activeEnemies||[]).filter(d=>d.instanceId!==s)})}function Je(s,n){const d=rt.get(i.campaign.id)||i.campaign;I({activeEnemies:(d.activeEnemies||[]).map(b=>b.instanceId===s?{...b,...n}:b)})}function Fe(){const s=rt.get(i.campaign.id)||i.campaign,n=s.combat?.round||1;n>1&&I({combat:{...s.combat,round:n-1}})}let be=ye(Lt({isOpen:!1,sides:20,count:1,modifier:0}));function tt(s,n=1){S(be,{isOpen:!0,sides:s,count:n,modifier:0},!0)}function Ze(s){ot(e(be).sides,e(be).count,s),e(be).isOpen=!1}function ot(s,n=1,d=0){const b=Ur(s,n,d);let M="";n>1&&(M+=`Dados: [${b.results.join(", ")}] `),b.bonusRolls?.length>0&&(M+=`Bonus Rolls: [${b.bonusRolls.join(", ")}] -> ${Math.abs(b.modifierTotal)}`),Ra.addToHistory({source:"GM",charName:"Mestre",name:`${n}d${s} ${d?d>0?`+${d}`:d:""}`,description:M.trim()||null,total:b.total,formula:b.formula,crit:b.crit}),Jt.set(!0)}let Xe=ye(Lt(Date.now()));ba(()=>{const s=setInterval(()=>{S(Xe,Date.now(),!0)},1e4);return()=>clearInterval(s)});let mt=re(()=>(()=>{const s=e(P).filter(x=>e(w).includes(x.id)),n=s.filter(x=>x&&x.initiative).map(x=>({...x,type:"player"})),d=e(F).map(x=>({...x,type:"enemy"})),b=s.filter(x=>x&&!x.initiative).map(x=>({...x,type:"player"})),M=[...n,...d,...b],j=new Set;return M.filter(x=>{if(!x)return!1;const T=x.type==="player"?x.id:x.instanceId;return j.has(T)?!1:(j.add(T),!0)})})());function _t(s){return s.lastUpdate?e(Xe)-s.lastUpdate<6e4:!1}function xt(s,n){const d=rt.get(i.campaign.id)||i.campaign,b=d.members||[],M=b.findIndex(ne=>ne.id===s);let j=b;M!==-1&&(j=[...b],j[M]={...j[M],...n});const x=d.activeEnemies||[],T=x.findIndex(ne=>ne.id===s&&ne.type==="player");let Z=x;T!==-1&&(Z=[...x],Z[T]={...Z[T],...n}),I({members:j,activeEnemies:Z})}var z=gi(),E=ie(z),L=a(E),Se=a(L),Ne=a(Se),Ve=a(Ne),ke=a(Ve);Fa(ke,{size:14,class:"text-indigo-500"});var lt=r(ke,2);{var Mt=s=>{var n=Br(),d=a(n,!0);t(n),D(()=>p(d,e(P).length)),l(s,n)};k(lt,s=>{e(P).length>0&&s(Mt)})}t(Ve);var It=r(Ve,2);It.__click=()=>S(R,!e(R));var Pt=a(It,!0);t(It),t(Ne);var Ke=r(Ne,2);{var ht=s=>{var n=Gr(),d=a(n),b=r(a(d),2),M=a(b);t(b),t(d);var j=r(d,2);ge(j,17,()=>e(V),x=>x.id,(x,T)=>{var Z=qr(),ne=a(Z),X=a(ne),ve=a(X,!0);t(X),le(2),t(ne);var oe=r(ne,2),he=a(oe);he.__click=()=>Pe(e(T).id);var He=a(he);ma(He,{size:14}),t(he);var De=r(he,2);De.__click=()=>Ue(e(T).id);var at=a(De);Xt(at,{size:14}),t(De),t(oe),t(Z),D(()=>p(ve,e(T).name)),l(x,Z)}),le(2),t(n),D(()=>p(M,`Aguardando Aprovação (${e(V).length??""})`)),l(s,n)};k(Ke,s=>{e(V).length>0&&s(ht)})}var We=r(Ke,2),Ot=a(We),Le=a(Ot);ge(Le,17,()=>e(P),s=>s.id,(s,n)=>{const d=re(()=>_t(e(n))),b=re(()=>e(w).includes(e(n).id));var M=Jr(),j=a(M),x=r(j,2),T=a(x),Z=a(T,!0);t(T);var ne=r(T,2),X=a(ne);{var ve=Ce=>{var Ht=Qr();l(Ce,Ht)};k(X,Ce=>{e(b)&&Ce(ve)})}var oe=r(X);t(ne),t(x);var he=r(x,2),He=a(he);He.__click=()=>me(e(n).id);var De=a(He);{var at=Ce=>{Ua(Ce,{size:14})},Qt=Ce=>{Ut(Ce,{size:14})};k(De,Ce=>{e(b)?Ce(at):Ce(Qt,!1)})}t(He);var Dt=r(He,2);Dt.__click=()=>Oe(e(n).id);var bt=a(Dt);Xt(bt,{size:14}),t(Dt),t(he),t(M),D(()=>{ce(M,1,`p-2.5 rounded-xl border flex items-center gap-3 transition-all ${e(d)?"bg-indigo-900/10 border-indigo-500/20":"bg-slate-900/50 border-slate-800"} ${e(d)||e(b)?"opacity-100":"opacity-40"} hover:border-indigo-500/40 group shadow-sm`),ce(j,1,`w-2 h-2 rounded-full ${e(d)?"bg-green-500 shadow-[0_0_8px_rgba(74,222,128,0.4)]":"bg-slate-700"}`),ce(T,1,`font-bold text-sm ${e(d)?"text-white":"text-slate-500"} group-hover:text-indigo-300 transition-colors`),p(Z,e(n).name),p(oe,` Lvl ${e(n).level??""} • ${e(n).ancestry??""}`),ce(He,1,`p-1.5 rounded-lg transition-all ${e(b)?"text-amber-400 hover:bg-amber-400/10":"text-slate-500 hover:text-indigo-400 hover:bg-indigo-400/10"}`),Ft(He,"title",e(b)?"Remover da Sessão":"Adicionar à Sessão")}),l(s,M)});var dt=r(Le,2);{var $e=s=>{var n=Wr();l(s,n)};k(dt,s=>{e(P).length===0&&s($e)})}t(Ot),t(We);var Ye=r(We,2),Nt=a(Ye);{var jt=s=>{var n=Zr(),d=ie(n);d.__click=()=>I({isPublished:!0});var b=a(d);ir(b,{size:14}),le(),t(d),le(2),l(s,n)},Be=s=>{var n=Yr(),d=ie(n),b=a(d),M=a(b),j=a(M);Va(j,{size:10,class:"animate-pulse"}),le(),t(M),t(b);var x=r(b,2);x.__click=()=>S(H,!e(H));var T=a(x);xr(T,{size:14}),t(x),t(d);var Z=r(d,2);{var ne=bt=>{var Ce=Xr(),Ht=a(Ce);t(Ce),D(Zt=>Ft(Ht,"src",Zt),[()=>`https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent(e(J))}`]),l(bt,Ce)};k(Z,bt=>{e(H)&&bt(ne)})}var X=r(Z,2),ve=a(X),oe=a(ve);oe.__click=K;var he=a(oe,!0);t(oe);var He=r(oe,2);He.__click=K;var De=a(He);{var at=bt=>{var Ce=Kr(),Ht=a(Ce);ma(Ht,{size:10,class:"inline mr-1"}),le(),t(Ce),l(bt,Ce)};k(De,bt=>{e(A)&&bt(at)})}var Qt=r(De,2);vr(Qt,{size:14}),t(He),t(ve),t(X);var Dt=r(X,2);Dt.__click=()=>I({isPublished:!1}),D(()=>p(he,e(J))),l(s,n)};k(Nt,s=>{i.campaign?.isPublished?s(Be,!1):s(jt)})}t(Ye),t(Se);var gt=r(Se,2),St=a(gt),pt=a(St);pt.__click=()=>S(de,"enemies");var Tt=a(pt);ia(Tt,{size:14}),le(),t(pt);var At=r(pt,2);At.__click=()=>S(de,"encounters");var Kt=a(At);Ia(Kt,{size:14}),le(),t(At),t(St);var Vt=r(St,2),Yt=a(Vt);{var Wt=s=>{var n=ai(),d=ie(n);ge(d,1,O,j=>j.id,(j,x)=>{var T=ei(),Z=a(T),ne=a(Z);br(ne,{size:12,class:"text-slate-600 cursor-grab"});var X=r(ne,2),ve=a(X),oe=a(ve,!0);t(ve);var he=r(ve,2),He=a(he);t(he),t(X),t(Z);var De=r(Z,2);De.__click=()=>it(e(x));var at=a(De);Ut(at,{size:16}),t(De),t(T),D(()=>{p(oe,e(x).name),p(He,`Dif ${e(x).difficulty??""}`)}),l(j,T)});var b=r(d,2);{var M=j=>{var x=ti();l(j,x)};k(b,j=>{O().length===0&&j(M)})}l(s,n)},c=s=>{var n=si(),d=ie(n);ge(d,1,o,j=>j.id,(j,x)=>{var T=ri(),Z=a(T),ne=a(Z),X=a(ne,!0);t(ne);var ve=r(ne,2),oe=a(ve);t(ve),t(Z);var he=r(Z,2);he.__click=()=>ft(e(x));var He=a(he);Ea(He,{size:14}),t(he),t(T),D(De=>{p(X,e(x).name),p(oe,`${De??""} Inimigos`)},[()=>e(x).enemies?.reduce((De,at)=>De+at.count,0)||0]),l(j,T)});var b=r(d,2);{var M=j=>{var x=ii();l(j,x)};k(b,j=>{o().length===0&&j(M)})}l(s,n)};k(Yt,s=>{e(de)==="enemies"?s(Wt):s(c,!1)})}t(Vt),t(gt),t(L);var m=r(L,2),W=a(m),ee=a(W),Re=a(ee);{var h=s=>{var n=ni();n.__click=st;var d=a(n);Na(d,{size:20}),le(),t(n),l(s,n)},N=s=>{var n=oi(),d=a(n);d.__click=Fe;var b=a(d);Ca(b,{size:20}),t(d);var M=r(d,2),j=r(a(M)),x=a(j,!0);t(j),t(M);var T=r(M,2);T.__click=nt;var Z=a(T);gr(Z,{size:16}),le(),t(T);var ne=r(T,4);ne.__click=()=>Y(),t(n),D(()=>p(x,e(C).round)),l(s,n)};k(Re,s=>{e(C).active?s(N,!1):s(h)})}t(ee),t(W);var Q=r(W,2),te=a(Q);ge(te,25,()=>e(mt),s=>s.type==="player"?s.id:s.instanceId,(s,n)=>{var d=li(),b=a(d);Fr(b,{get entity(){return e(n)},updateEnemy:Je,removeFromCombat:Qe,updatePlayer:xt}),t(d),Ha(d,()=>Vr,()=>({duration:300})),l(s,d)});var ze=r(te,2);{var ae=s=>{var n=di();l(s,n)};k(ze,s=>{e(mt).length===0&&s(ae)})}t(Q),t(m),le(2),t(E);var G=r(E,2);{var Ee=s=>{var n=ui();n.__click=X=>{X.target===X.currentTarget&&S(U,!1)};var d=a(n),b=a(d),M=a(b),j=a(M);Ga(j,{size:24}),t(M),le(2),t(b);var x=r(b,2);ge(x,21,()=>e(ue),Ge,(X,ve)=>{var oe=ci(),he=a(oe),He=a(he);ia(He,{size:14,class:"text-slate-500"});var De=r(He);t(he);var at=r(he,2);ge(at,21,()=>e(ve).effects,Ge,(Qt,Dt)=>{var bt=vi(),Ce=a(bt),Ht=a(Ce);t(Ce);var Zt=r(Ce,2),ja=a(Zt,!0);t(Zt),t(bt),D(()=>{p(Ht,`${e(Dt).name??""}:`),p(ja,e(Dt).desc)}),l(Qt,bt)}),t(at),t(oe),D(()=>p(De,` ${e(ve).name??""}`)),l(X,oe)}),t(x);var T=r(x,2),Z=a(T);Z.__click=()=>S(U,!1);var ne=r(Z,2);ne.__click=we,t(T),t(d),t(n),l(s,n)};k(G,s=>{e(U)&&s(Ee)})}var fe=r(G,2),Me=a(fe),et=a(Me);Ba(et,{size:16}),le(),t(Me);var xe=r(Me,2);xe.__click=()=>tt(20);var Ie=r(xe,2);Ie.__click=()=>tt(6);var qe=r(Ie,2);qe.__click=()=>tt(6,2);var vt=r(qe,2);vt.__click=()=>tt(6,3),t(fe);var Ae=r(fe,2);{let s=re(()=>e(be).sides===20?"Boons / Banes":"Modificador Fixo");qa(Ae,{get isOpen(){return e(be).isOpen},get title(){return`Rolagem Rápida (${e(be).count??""}d${e(be).sides??""})`},get label(){return e(s)},onClose:()=>e(be).isOpen=!1,onRoll:Ze,initialModifier:0})}var Te=r(Ae,2);{var _e=s=>{var n=xi();n.__click=X=>{X.target===X.currentTarget&&S(R,!1)};var d=a(n),b=a(d),M=r(a(b),2);M.__click=()=>S(R,!1);var j=a(M);ea(j,{size:16}),t(M),t(b);var x=r(b,2),T=a(x);ge(T,17,()=>e(pe),Ge,(X,ve)=>{var oe=bi();oe.__click=()=>me(e(ve).id);var he=a(oe),He=a(he,!0);t(he);var De=r(he,2),at=a(De),Qt=a(at,!0);t(at);var Dt=r(at,2),bt=a(Dt);t(Dt),t(De);var Ce=r(De,2),Ht=a(Ce);Ut(Ht,{size:16}),t(Ce),t(oe),D(Zt=>{p(He,Zt),p(Qt,e(ve).name),p(bt,`Nível ${e(ve).level??""} • ${e(ve).ancestry??""}`)},[()=>e(ve).name.charAt(0)]),l(X,oe)});var Z=r(T,2);{var ne=X=>{var ve=fi(),oe=a(ve),he=a(oe);ia(he,{size:24}),t(oe),le(4),t(ve),l(X,ve)};k(Z,X=>{e(pe).length===0&&X(ne)})}t(x),t(d),t(n),l(s,n)};k(Te,s=>{e(R)&&s(_e)})}var ct=r(Te,2);ka(ct,{get isOpen(){return y()},onClose:()=>Jt.set(!1)});var ut=r(ct,2);ha(ut,{get isOpen(){return e($).isOpen},get title(){return e($).title},get message(){return e($).message},get onConfirm(){return e($).onConfirm},onCancel:()=>e($).isOpen=!1}),D(()=>{p(Pt,e(R)?"Fechar":"Adicionar"),ce(pt,1,`flex-1 text-xs font-bold py-1.5 rounded flex items-center justify-center gap-2 transition-colors ${e(de)==="enemies"?"bg-indigo-600 text-white":"text-slate-500 hover:text-white"}`),ce(At,1,`flex-1 text-xs font-bold py-1.5 rounded flex items-center justify-center gap-2 transition-colors ${e(de)==="encounters"?"bg-indigo-600 text-white":"text-slate-500 hover:text-white"}`)}),l(_,z),qt(),g()}Gt(["click"]);var mi=v('<div class="space-y-4"><div class="flex items-center gap-4"><div class="relative group cursor-pointer"><div class="w-16 h-16 rounded-xl overflow-hidden border border-slate-700"><!></div> <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-xl"><!></div></div> <div class="flex-1"><label for="enemy-name" class="text-xs text-slate-500 uppercase font-bold block mb-1">Nome</label> <input id="enemy-name" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white font-bold text-lg"/></div></div> <div class="grid grid-cols-2 gap-4"><div><label for="enemy-diff" class="text-xs text-slate-500 uppercase font-bold block mb-1">Dificuldade</label><input id="enemy-diff" type="number" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white"/></div> <div><label for="enemy-size" class="text-xs text-slate-500 uppercase font-bold block mb-1">Tamanho (Size)</label><input id="enemy-size" type="number" step="0.5" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white"/></div></div> <div><label for="enemy-desc" class="text-xs text-slate-500 uppercase font-bold block mb-1">Descrição</label> <textarea id="enemy-desc" class="w-full bg-slate-900 border border-slate-700 rounded p-3 text-white text-sm min-h-[100px] resize-none focus:border-indigo-500 focus:outline-none transition-colors" placeholder="Breve descrição ou notas sobre a criatura..."></textarea></div> <div class="grid grid-cols-1"><div><label for="enemy-speed" class="text-xs text-slate-500 uppercase font-bold block mb-1">Speed</label><input id="enemy-speed" type="number" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white"/></div></div></div>'),_i=v('<div class="bg-slate-900 p-2 rounded border border-slate-700 text-center"><label class="text-[10px] text-slate-500 uppercase font-bold block mb-1"> </label> <input type="number" class="w-full bg-transparent text-center font-bold text-white text-xl focus:outline-none mb-1"/> <div> </div></div>'),hi=v('<div class="space-y-6"><div><h4 class="text-indigo-400 font-bold text-sm uppercase mb-3">Atributos Principais</h4> <div class="grid grid-cols-4 gap-3"></div></div> <div class="space-y-3"><div><label for="enemy-senses" class="text-xs text-slate-500 uppercase font-bold block mb-1">Sentidos</label><input id="enemy-senses" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Ex: Visão no escuro"/></div> <div><label for="enemy-langs" class="text-xs text-slate-500 uppercase font-bold block mb-1">Idiomas</label><input id="enemy-langs" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Ex: Comum, Élfico"/></div> <div><label for="enemy-immune" class="text-xs text-slate-500 uppercase font-bold block mb-1">Imunidades</label><input id="enemy-immune" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Ex: Fogo, Veneno"/></div></div></div>'),yi=v('<div class="flex gap-2 items-start animate-in fade-in slide-in-from-left-2"><div class="flex-1 space-y-1"><input class="w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm font-bold placeholder-slate-600 focus:border-indigo-500 focus:outline-none" placeholder="Nome"/> <textarea class="w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm placeholder-slate-600 resize-none focus:border-indigo-500 focus:outline-none" rows="2" placeholder="Descrição..."></textarea></div> <button class="mt-1 text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded"><!></button></div>'),wi=v('<div class="text-xs text-slate-600 italic text-center py-4 border-2 border-dashed border-slate-800 rounded">Vazio</div>'),ki=v('<div><div class="flex justify-between items-center mb-3"><h4> </h4> <button class="text-xs bg-slate-800 px-2 py-1 rounded hover:bg-slate-700 text-white flex items-center gap-1 border border-slate-700"><!> Adicionar</button></div> <div class="space-y-3"><!> <!></div></div>'),Ci=v('<div class="space-y-6"></div>'),zi=v('<div class="w-16 h-16 rounded-lg overflow-hidden border border-slate-700 shadow-lg flex-shrink-0"><!></div>'),Ei=v('<div class="bg-slate-950 p-2 rounded border border-slate-800"><div class="text-[10px] text-slate-500 uppercase font-bold mb-1"> </div> <div class="text-white font-bold"> <span> </span></div></div>'),Mi=v('<div class="flex gap-2"><span class="font-bold text-slate-500 uppercase">Sentidos:</span> <span class="text-white"> </span></div>'),Ii=v('<div class="flex gap-2"><span class="font-bold text-slate-500 uppercase">Idiomas:</span> <span class="text-white"> </span></div>'),Oi=v('<div class="flex gap-2"><span class="font-bold text-slate-500 uppercase">Imunidades:</span> <span class="text-white"> </span></div>'),Ni=v('<div class="mb-2 pl-3 border-l-2 border-indigo-900"><span class="font-bold text-white"> </span> <span class="text-slate-300"> </span></div>'),ji=v('<div><h4 class="font-bold text-indigo-400 uppercase text-xs mb-2 tracking-wider">Traços</h4> <!></div>'),Si=v('<div class="mb-2 pl-3 border-l-2 border-red-900/50"><span class="font-bold text-white"> </span> <span class="text-slate-300"> </span></div>'),$i=v('<div><h4 class="font-bold text-red-500 uppercase text-xs mb-2 tracking-wider">Ações</h4> <!></div>'),Ri=v('<div class="mb-2 pl-3 border-l-2 border-orange-900/50"><span class="font-bold text-white"> </span> <span class="text-slate-300"> </span></div>'),Ai=v('<div><h4 class="font-bold text-orange-400 uppercase text-xs mb-2 tracking-wider">Reações</h4> <!></div>'),Di=v('<div class="mb-2 pl-3 border-l-2 border-yellow-900/50"><span class="font-bold text-white"> </span> <span class="text-slate-300"> </span></div>'),Pi=v('<div><h4 class="font-bold text-yellow-500 uppercase text-xs mb-2 tracking-wider">Fim da Rodada</h4> <!></div>'),Ti=v('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4" role="button" aria-label="Fechar modal" tabindex="-1"><div class="bg-slate-800 rounded-xl w-full max-w-6xl h-[90vh] border border-slate-700 shadow-2xl overflow-hidden flex flex-col lg:flex-row" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="w-full lg:w-1/2 flex flex-col h-full border-r border-slate-700"><div class="p-4 border-b border-slate-700 bg-slate-900 flex justify-between items-center"><h3 id="modal-title" class="font-bold text-white text-lg">Editor de Inimigo</h3> <button class="lg:hidden text-slate-400 hover:text-white"><!></button></div> <div class="flex border-b border-slate-700 bg-slate-900/50"><button>Geral</button> <button>Atributos</button> <button>Habilidades</button></div> <div class="flex-1 overflow-y-auto p-6 custom-scrollbar bg-slate-800/50"><!></div> <div class="p-4 border-t border-slate-700 bg-slate-900 flex justify-end gap-3"><button class="px-6 py-2 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold transition-colors">Cancelar</button> <button class="px-6 py-2 rounded bg-indigo-600 hover:bg-indigo-500 text-white font-bold flex items-center gap-2 transition-colors"><!> Salvar</button></div></div> <div class="hidden lg:flex w-1/2 bg-slate-950 flex-col border-l border-slate-800"><div class="p-4 border-b border-slate-800 bg-slate-950"><h3 class="font-bold text-slate-500 text-xs uppercase flex items-center gap-2"><!> Pré-visualização</h3></div> <div class="flex-1 p-8 overflow-y-auto flex items-center justify-center bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-slate-950"><div class="w-full max-w-md bg-slate-900 border border-slate-700 rounded-xl p-5 shadow-2xl relative"><div class="absolute -top-3 -right-3 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg border border-red-400"> </div> <div class="flex items-center gap-3 mb-4"><!> <div class="flex-1 min-w-0"><h2 class="text-2xl font-bold text-white mb-1 font-serif tracking-wide truncate"> </h2> <div class="h-1 w-20 bg-red-600 rounded-full"></div></div></div> <div class="grid grid-cols-2 gap-4 mb-4 text-sm"><div class="bg-slate-950 p-2 rounded border border-slate-800 flex justify-between items-center"><span class="text-slate-500 uppercase font-bold text-[10px]">Defesa</span> <span class="text-white font-mono font-bold text-lg"> </span></div> <div class="bg-slate-950 p-2 rounded border border-slate-800 flex justify-between items-center"><span class="text-slate-500 uppercase font-bold text-[10px]">Vida</span> <span class="text-white font-mono font-bold text-lg"> </span></div> <div class="bg-slate-950 p-2 rounded border border-slate-800 flex justify-between items-center"><span class="text-slate-500 uppercase font-bold text-[10px]">Tamanho</span> <span class="text-white font-mono font-bold"> </span></div> <div class="bg-slate-950 p-2 rounded border border-slate-800 flex justify-between items-center"><span class="text-slate-500 uppercase font-bold text-[10px]">Speed</span> <span class="text-white font-mono font-bold"> </span></div></div> <div class="grid grid-cols-4 gap-2 mb-6 text-center font-mono text-slate-300"></div> <div class="mb-6 space-y-2 text-xs"><!> <!> <!></div> <div class="space-y-5 text-sm"><!> <!> <!> <!></div></div></div></div></div></div> <input type="file" hidden="" accept="image/*"/> <!>',1);function Hi(_,i){Bt(i,!0);let f=Rt(i,"isOpen",3,!1),O=Rt(i,"initialData",3,"{}"),o=ye(Lt(se())),y=ye("stats"),u=ye(!1),g=ye(""),R=ye(void 0);function A(w){const C=w.target.files;if(C&&C.length>0){const F=C[0],B=new FileReader;B.onload=()=>{S(g,B.result,!0),S(u,!0)},B.readAsDataURL(F)}w.target&&(w.target.value="")}async function H(w){try{const C=await Ja(w);e(o).imageUrl=C,S(u,!1)}catch(C){console.error(C),alert(C.message||"Erro ao salvar imagem")}}function se(){return{name:"",difficulty:1,defense:10,health:10,damage:0,size:1,speed:10,description:"",senses:"",languages:"",immune:"",imageUrl:"",stats:{str:10,agi:10,int:10,wil:10},traits:[],actions:[],reactions:[],endOfRound:[]}}va(()=>{if(f()&&O())try{const w=JSON.parse(O());Object.keys(w).length===0?S(o,se(),!0):S(o,{...se(),...w},!0)}catch{S(o,se(),!0)}});function de(w){e(o)[w]=[...e(o)[w],{name:"",desc:""}]}function U(w,C){e(o)[w]=e(o)[w].filter((F,B)=>B!==C)}function ue(w){w.target===w.currentTarget&&i.onClose()}var $=je(),J=ie($);{var K=w=>{var C=Ti(),F=ie(C);F.__click=ue;var B=a(F),q=a(B),P=a(q),V=r(a(P),2);V.__click=function(...h){i.onClose?.apply(this,h)};var pe=a(V);ea(pe,{size:20}),t(V),t(P);var I=r(P,2),me=a(I);me.__click=()=>S(y,"stats");var Pe=r(me,2);Pe.__click=()=>S(y,"attributes");var Ue=r(Pe,2);Ue.__click=()=>S(y,"abilities"),t(I);var Oe=r(I,2),it=a(Oe);{var ft=h=>{var N=mi(),Q=a(N),te=a(Q);te.__click=()=>e(R)?.click();var ze=a(te),ae=a(ze);za(ae,()=>e(o).imageUrl,s=>{da(s,{get hash(){return e(o).imageUrl},get alt(){return e(o).name},size:"custom",fallbackText:"?"})}),t(ze);var G=r(ze,2),Ee=a(G);Wa(Ee,{size:20,class:"text-white"}),t(G),t(te);var fe=r(te,2),Me=r(a(fe),2);yt(Me),t(fe),t(Q);var et=r(Q,2),xe=a(et),Ie=r(a(xe));yt(Ie),t(xe);var qe=r(xe,2),vt=r(a(qe));yt(vt),t(qe),t(et);var Ae=r(et,2),Te=r(a(Ae),2);ua(Te),t(Ae);var _e=r(Ae,2),ct=a(_e),ut=r(a(ct));yt(ut),t(ct),t(_e),t(N),$t(Me,()=>e(o).name,s=>e(o).name=s),$t(Ie,()=>e(o).difficulty,s=>e(o).difficulty=s),$t(vt,()=>e(o).size,s=>e(o).size=s),$t(Te,()=>e(o).description,s=>e(o).description=s),$t(ut,()=>e(o).speed,s=>e(o).speed=s),l(h,N)},st=h=>{var N=je(),Q=ie(N);{var te=ae=>{var G=hi(),Ee=a(G),fe=r(a(Ee),2);ge(fe,20,()=>["str","agi","int","wil"],Ge,(Te,_e)=>{var ct=_i(),ut=a(ct),s=a(ut,!0);t(ut);var n=r(ut,2);yt(n);var d=r(n,2),b=a(d);t(d),t(ct),D(()=>{Ft(ut,"for",`attr-${_e??""}`),p(s,_e),Ft(n,"id",`attr-${_e??""}`),ce(d,1,`text-xs font-bold ${e(o).stats[_e]-10>=0?"text-green-500":"text-red-500"}`),p(b,`${e(o).stats[_e]-10>=0?"+":""}${e(o).stats[_e]-10}`)}),$t(n,()=>e(o).stats[_e],M=>e(o).stats[_e]=M),l(Te,ct)}),t(fe),t(Ee);var Me=r(Ee,2),et=a(Me),xe=r(a(et));yt(xe),t(et);var Ie=r(et,2),qe=r(a(Ie));yt(qe),t(Ie);var vt=r(Ie,2),Ae=r(a(vt));yt(Ae),t(vt),t(Me),t(G),$t(xe,()=>e(o).senses,Te=>e(o).senses=Te),$t(qe,()=>e(o).languages,Te=>e(o).languages=Te),$t(Ae,()=>e(o).immune,Te=>e(o).immune=Te),l(ae,G)},ze=ae=>{var G=je(),Ee=ie(G);{var fe=Me=>{var et=Ci();ge(et,20,()=>[{key:"traits",title:"Traços (Traits)",color:"text-indigo-400",border:"border-indigo-500/30"},{key:"actions",title:"Ações",color:"text-red-400",border:"border-red-500/30"},{key:"reactions",title:"Reações",color:"text-orange-400",border:"border-orange-500/30"},{key:"endOfRound",title:"Fim da Rodada",color:"text-yellow-400",border:"border-yellow-500/30"}],Ge,(xe,Ie)=>{var qe=ki(),vt=a(qe),Ae=a(vt),Te=a(Ae,!0);t(Ae);var _e=r(Ae,2);_e.__click=()=>de(Ie.key);var ct=a(_e);Ut(ct,{size:12}),le(),t(_e),t(vt);var ut=r(vt,2),s=a(ut);ge(s,17,()=>e(o)[Ie.key],Ge,(b,M,j)=>{var x=yi(),T=a(x),Z=a(T);yt(Z);var ne=r(Z,2);ua(ne),t(T);var X=r(T,2);X.__click=()=>U(Ie.key,j);var ve=a(X);Xt(ve,{size:16}),t(X),t(x),$t(Z,()=>e(M).name,oe=>e(M).name=oe),$t(ne,()=>e(M).desc,oe=>e(M).desc=oe),l(b,x)});var n=r(s,2);{var d=b=>{var M=wi();l(b,M)};k(n,b=>{e(o)[Ie.key].length===0&&b(d)})}t(ut),t(qe),D(()=>{ce(qe,1,`p-4 bg-slate-900 rounded border ${Ie.border??""}`),ce(Ae,1,`font-bold text-sm uppercase ${Ie.color??""}`),p(Te,Ie.title)}),l(xe,qe)}),t(et),l(Me,et)};k(Ee,Me=>{e(y)==="abilities"&&Me(fe)},!0)}l(ae,G)};k(Q,ae=>{e(y)==="attributes"?ae(te):ae(ze,!1)},!0)}l(h,N)};k(it,h=>{e(y)==="stats"?h(ft):h(st,!1)})}t(Oe);var nt=r(Oe,2),we=a(nt);we.__click=function(...h){i.onClose?.apply(this,h)};var Y=r(we,2);Y.__click=()=>i.onSave(e(o));var Qe=a(Y);Oa(Qe,{size:18}),le(),t(Y),t(nt),t(q);var Je=r(q,2),Fe=a(Je),be=a(Fe),tt=a(be);cr(tt,{size:14}),le(),t(be),t(Fe);var Ze=r(Fe,2),ot=a(Ze),Xe=a(ot),mt=a(Xe);t(Xe);var _t=r(Xe,2),xt=a(_t);{var z=h=>{var N=zi(),Q=a(N);da(Q,{get hash(){return e(o).imageUrl},get alt(){return e(o).name},size:"custom"}),t(N),l(h,N)};k(xt,h=>{e(o).imageUrl&&h(z)})}var E=r(xt,2),L=a(E),Se=a(L,!0);t(L),le(2),t(E),t(_t);var Ne=r(_t,2),Ve=a(Ne),ke=r(a(Ve),2),lt=a(ke,!0);t(ke),t(Ve);var Mt=r(Ve,2),It=r(a(Mt),2),Pt=a(It,!0);t(It),t(Mt);var Ke=r(Mt,2),ht=r(a(Ke),2),We=a(ht,!0);t(ht),t(Ke);var Ot=r(Ke,2),Le=r(a(Ot),2),dt=a(Le,!0);t(Le),t(Ot),t(Ne);var $e=r(Ne,2);ge($e,20,()=>["str","agi","int","wil"],Ge,(h,N)=>{var Q=Ei(),te=a(Q),ze=a(te,!0);t(te);var ae=r(te,2),G=a(ae),Ee=r(G),fe=a(Ee);t(Ee),t(ae),t(Q),D(()=>{p(ze,N),p(G,`${e(o).stats[N]??""} `),ce(Ee,1,`text-xs ${e(o).stats[N]-10>=0?"text-green-500":"text-red-500"}`),p(fe,`(${e(o).stats[N]-10>=0?"+":""}${e(o).stats[N]-10})`)}),l(h,Q)}),t($e);var Ye=r($e,2),Nt=a(Ye);{var jt=h=>{var N=Mi(),Q=r(a(N),2),te=a(Q,!0);t(Q),t(N),D(()=>p(te,e(o).senses)),l(h,N)};k(Nt,h=>{e(o).senses&&h(jt)})}var Be=r(Nt,2);{var gt=h=>{var N=Ii(),Q=r(a(N),2),te=a(Q,!0);t(Q),t(N),D(()=>p(te,e(o).languages)),l(h,N)};k(Be,h=>{e(o).languages&&h(gt)})}var St=r(Be,2);{var pt=h=>{var N=Oi(),Q=r(a(N),2),te=a(Q,!0);t(Q),t(N),D(()=>p(te,e(o).immune)),l(h,N)};k(St,h=>{e(o).immune&&h(pt)})}t(Ye);var Tt=r(Ye,2),At=a(Tt);{var Kt=h=>{var N=ji(),Q=r(a(N),2);ge(Q,17,()=>e(o).traits,Ge,(te,ze)=>{var ae=Ni(),G=a(ae),Ee=a(G);t(G);var fe=r(G,2),Me=a(fe,!0);t(fe),t(ae),D(()=>{p(Ee,`${e(ze).name??""}:`),p(Me,e(ze).desc)}),l(te,ae)}),t(N),l(h,N)};k(At,h=>{e(o).traits.length>0&&h(Kt)})}var Vt=r(At,2);{var Yt=h=>{var N=$i(),Q=r(a(N),2);ge(Q,17,()=>e(o).actions,Ge,(te,ze)=>{var ae=Si(),G=a(ae),Ee=a(G);t(G);var fe=r(G,2),Me=a(fe,!0);t(fe),t(ae),D(()=>{p(Ee,`${e(ze).name??""}:`),p(Me,e(ze).desc)}),l(te,ae)}),t(N),l(h,N)};k(Vt,h=>{e(o).actions.length>0&&h(Yt)})}var Wt=r(Vt,2);{var c=h=>{var N=Ai(),Q=r(a(N),2);ge(Q,17,()=>e(o).reactions,Ge,(te,ze)=>{var ae=Ri(),G=a(ae),Ee=a(G);t(G);var fe=r(G,2),Me=a(fe,!0);t(fe),t(ae),D(()=>{p(Ee,`${e(ze).name??""}:`),p(Me,e(ze).desc)}),l(te,ae)}),t(N),l(h,N)};k(Wt,h=>{e(o).reactions.length>0&&h(c)})}var m=r(Wt,2);{var W=h=>{var N=Pi(),Q=r(a(N),2);ge(Q,17,()=>e(o).endOfRound,Ge,(te,ze)=>{var ae=Di(),G=a(ae),Ee=a(G);t(G);var fe=r(G,2),Me=a(fe,!0);t(fe),t(ae),D(()=>{p(Ee,`${e(ze).name??""}:`),p(Me,e(ze).desc)}),l(te,ae)}),t(N),l(h,N)};k(m,h=>{e(o).endOfRound.length>0&&h(W)})}t(Tt),t(ot),t(Ze),t(Je),t(B),t(F);var ee=r(F,2);ee.__change=A,nr(ee,h=>S(R,h),()=>e(R));var Re=r(ee,2);Qa(Re,{get isOpen(){return e(u)},get imageUrl(){return e(g)},onClose:()=>S(u,!1),onCrop:H}),D(()=>{ce(me,1,`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${e(y)==="stats"?"border-indigo-500 text-indigo-400 bg-slate-800":"border-transparent text-slate-500 hover:text-white"}`),ce(Pe,1,`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${e(y)==="attributes"?"border-indigo-500 text-indigo-400 bg-slate-800":"border-transparent text-slate-500 hover:text-white"}`),ce(Ue,1,`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${e(y)==="abilities"?"border-indigo-500 text-indigo-400 bg-slate-800":"border-transparent text-slate-500 hover:text-white"}`),p(mt,`Dificuldade ${e(o).difficulty??""}`),p(Se,e(o).name||"Inimigo"),p(lt,e(o).defense),p(Pt,e(o).health),p(We,e(o).size),p(dt,e(o).speed)}),l(w,C)};k(J,w=>{f()&&w(K)})}l(_,$),qt()}Gt(["click","change"]);var Fi=v('<div class="flex justify-between items-center bg-slate-800 p-2 rounded border border-slate-700"><div class="flex-1"><div class="text-sm font-bold text-white"> </div> <div class="text-[10px] text-slate-400"> </div></div> <div class="flex items-center gap-2"><input type="number" min="1" class="w-12 bg-slate-900 border border-slate-600 rounded text-center text-white"/> <button class="text-red-400 hover:text-red-300"><!></button></div></div>'),Vi=v('<div class="text-center text-slate-600 italic text-sm py-4">Nenhum inimigo adicionado.</div>'),Li=v('<div class="flex justify-between items-center bg-slate-950 p-2 rounded border border-slate-800 hover:border-indigo-500/30 transition-colors"><div><div class="text-sm font-bold text-white max-w-[120px] truncate"> </div> <div class="text-[10px] text-slate-500"> </div></div> <button class="text-indigo-400 hover:text-white p-1 bg-slate-900 rounded border border-slate-800"><!></button></div>'),Ui=v('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4" role="button" aria-label="Fechar" tabindex="-1"><div class="bg-slate-800 rounded-xl w-full max-w-2xl p-6 border border-slate-700 shadow-2xl flex flex-col max-h-[90vh]" role="dialog" aria-modal="true" aria-labelledby="encounter-modal-title"><div class="flex justify-between items-center mb-6"><h3 id="encounter-modal-title" class="text-xl font-bold text-white">Criar/Editar Encontro</h3> <button class="text-slate-400 hover:text-white"><!></button></div> <div class="space-y-4 mb-6"><div><label for="encounter-name" class="text-xs text-slate-500 uppercase font-bold block mb-1">Nome do Encontro</label> <input id="encounter-name" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white outline-hidden focus:border-indigo-500" placeholder="Ex: Emboscada na Cripta"/></div></div> <div class="flex-1 flex gap-4 min-h-0"><div class="flex-1 bg-slate-900 border border-slate-800 rounded-lg p-3 flex flex-col"><h4 class="text-xs text-slate-500 uppercase font-bold mb-2">Inimigos no Encontro</h4> <div class="flex-1 overflow-y-auto space-y-2 custom-scrollbar"><!> <!></div></div> <div class="flex-1 bg-slate-900 border border-slate-800 rounded-lg p-3 flex flex-col"><h4 class="text-xs text-slate-500 uppercase font-bold mb-2">Adicionar Inimigos</h4> <div class="flex-1 overflow-y-auto space-y-2 custom-scrollbar"></div></div></div> <div class="flex gap-3 mt-6 pt-4 border-t border-slate-700"><button class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded font-bold">Cancelar</button> <button class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded font-bold flex items-center justify-center gap-2"><!> Salvar Encontro</button></div></div></div>');function Bi(_,i){Bt(i,!0);const f=()=>wt(ca,"$liveEnemies",O),[O,o]=ta();let y=Rt(i,"isOpen",3,!1),u=Rt(i,"initialData",3,"{}"),g=ye(Lt({name:"",enemies:[]}));va(()=>{if(y()&&u())try{const $=JSON.parse(u());S(g,{name:$.name||"",enemies:$.enemies||[]},!0)}catch{S(g,{name:"",enemies:[]},!0)}});function R($){e(g).enemies.find(K=>K.enemyId===$)?e(g).enemies=e(g).enemies.map(K=>K.enemyId===$?{...K,count:K.count+1}:K):e(g).enemies=[...e(g).enemies,{enemyId:$,count:1}]}function A($){e(g).enemies=e(g).enemies.filter((J,K)=>K!==$)}function H($,J){const K=Math.max(1,parseInt(J)||1);e(g).enemies[$].count=K}function se($){$.target===$.currentTarget&&i.onClose()}var de=je(),U=ie(de);{var ue=$=>{var J=Ui();J.__click=se;var K=a(J),w=a(K),C=r(a(w),2);C.__click=function(...Y){i.onClose?.apply(this,Y)};var F=a(C);ea(F,{size:20}),t(C),t(w);var B=r(w,2),q=a(B),P=r(a(q),2);yt(P),t(q),t(B);var V=r(B,2),pe=a(V),I=r(a(pe),2),me=a(I);ge(me,17,()=>e(g).enemies,Ge,(Y,Qe,Je)=>{const Fe=re(()=>f().find(L=>L.id===e(Qe).enemyId));var be=Fi(),tt=a(be),Ze=a(tt),ot=a(Ze,!0);t(Ze);var Xe=r(Ze,2),mt=a(Xe);t(Xe),t(tt);var _t=r(tt,2),xt=a(_t);yt(xt),xt.__input=L=>H(Je,L.target.value);var z=r(xt,2);z.__click=()=>A(Je);var E=a(z);Xt(E,{size:16}),t(z),t(_t),t(be),D(()=>{p(ot,e(Fe)?e(Fe).name:"Desconhecido"),p(mt,`Dif ${(e(Fe)?e(Fe).difficulty:"?")??""}`),la(xt,e(Qe).count)}),l(Y,be)});var Pe=r(me,2);{var Ue=Y=>{var Qe=Vi();l(Y,Qe)};k(Pe,Y=>{e(g).enemies.length===0&&Y(Ue)})}t(I),t(pe);var Oe=r(pe,2),it=r(a(Oe),2);ge(it,5,f,Y=>Y.id,(Y,Qe)=>{var Je=Li(),Fe=a(Je),be=a(Fe),tt=a(be,!0);t(be);var Ze=r(be,2),ot=a(Ze);t(Ze),t(Fe);var Xe=r(Fe,2);Xe.__click=()=>R(e(Qe).id);var mt=a(Xe);Ut(mt,{size:16}),t(Xe),t(Je),D(()=>{p(tt,e(Qe).name),p(ot,`Dif ${e(Qe).difficulty??""}`)}),l(Y,Je)}),t(it),t(Oe),t(V);var ft=r(V,2),st=a(ft);st.__click=function(...Y){i.onClose?.apply(this,Y)};var nt=r(st,2);nt.__click=()=>i.onSave(e(g));var we=a(nt);Oa(we,{size:18}),le(),t(nt),t(ft),t(K),t(J),$t(P,()=>e(g).name,Y=>e(g).name=Y),l($,J)};k(U,$=>{y()&&$(ue)})}l(_,de),qt(),o()}Gt(["click","input"]);var qi=v('<div class="text-[10px] text-slate-400 flex items-center gap-1.5 bg-slate-950 p-1 px-1.5 rounded-lg border border-slate-800/50"><span class="text-indigo-400 font-black"> </span> <span class="font-medium truncate max-w-[80px]"> </span></div>'),Gi=v('<div class="text-[10px] text-slate-600 italic">Vazio</div>'),Qi=v('<div class="bg-slate-900 border border-slate-800 rounded-2xl p-4 transition-all hover:border-indigo-500/30 group relative flex flex-col justify-between shadow-lg hover:shadow-indigo-500/10" role="region"><div class="flex-1"><div class="font-bold text-white text-base mb-2 group-hover:text-indigo-400 transition-colors uppercase tracking-tight truncate"> </div> <div class="flex flex-wrap gap-1"><!> <!></div></div> <div class="flex gap-2 mt-3 pt-3 border-t border-slate-800/50"><button class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-1.5 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg shadow-indigo-900/20"><!> Iniciar</button> <button class="p-1.5 text-slate-400 hover:text-white bg-slate-800/50 rounded-lg border border-slate-800 transition-all" title="Editar"><!></button> <button class="p-1.5 text-slate-400 hover:text-red-400 bg-slate-800/50 rounded-lg border border-slate-800 hover:border-red-900/30 transition-all"><!></button></div></div>'),Ji=v('<button class="text-[10px] font-bold text-indigo-400 hover:text-indigo-300 mt-1 uppercase tracking-wider"> </button>'),Wi=v('<div class="mb-4 flex-1"><p> </p> <!></div>'),Zi=v('<div class="mb-4 flex-1 text-[10px] text-slate-600 italic">Sem descrição.</div>'),Xi=v('<div class="bg-slate-900 border border-slate-800 rounded-2xl p-5 hover:border-indigo-500/30 transition-all relative group cursor-move hover:shadow-lg hover:shadow-indigo-500/10 active:scale-[0.98] flex flex-col" draggable="true" role="listitem"><div class="flex justify-between items-start mb-3"><h3 class="font-bold text-lg text-white group-hover:text-indigo-400 transition-colors"> </h3> <span class="text-[10px] font-black bg-indigo-500/10 text-indigo-400 border border-indigo-400/20 px-2 py-1 rounded-lg uppercase"> </span></div> <!> <div class="mt-auto flex gap-2 pt-4 border-t border-slate-800/50"><button class="flex-1 bg-slate-800/50 hover:bg-slate-800 text-white py-2 rounded-xl text-xs font-bold border border-slate-800 transition-all">Editar</button> <button class="bg-slate-800/50 hover:bg-red-900/20 text-slate-500 hover:text-red-400 px-3 rounded-xl border border-slate-800 hover:border-red-900/30 transition-all"><!></button></div></div>'),Ki=v('<div class="text-center text-slate-500 italic col-span-3">Nenhum inimigo cadastrado.</div>'),Yi=v('<div><div class="mb-12"><div class="flex justify-between items-center mb-6"><h3 class="text-sm font-black text-indigo-400 uppercase tracking-widest flex items-center gap-2"><!> Encontros Prontos</h3></div> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><button class="min-h-[120px] border-2 border-dashed border-slate-800 rounded-2xl flex flex-col items-center justify-center text-slate-500 hover:border-indigo-500 hover:text-indigo-400 transition-all hover:bg-indigo-500/5 gap-2 group"><!> <span class="font-bold text-sm">Novo Encontro</span></button> <!></div></div> <div class="mb-6"><h3 class="text-sm font-black text-indigo-400 uppercase tracking-widest flex items-center gap-2 mb-6"><!> Biblioteca de Inimigos</h3></div> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><button class="min-h-[180px] border-2 border-dashed border-slate-800 rounded-2xl flex flex-col items-center justify-center text-slate-500 hover:border-indigo-500 hover:text-indigo-400 transition-all hover:bg-indigo-500/5 gap-2 group"><!> <span class="font-bold text-sm">Novo Inimigo</span></button> <!> <!></div> <!> <!> <!></div>');function es(_,i){Bt(i,!0);const f=()=>wt(ca,"$liveEnemies",y),O=()=>wt(ya,"$liveEncounters",y),o=()=>wt(_a,"$page",y),[y,u]=ta();let g=ye(!1),R=ye(null),A=ye("{}"),H=ye(!1),se=ye(null),de=ye("{}"),U=ye(Lt({isOpen:!1,title:"",message:"",onConfirm:()=>{}}));function ue(){return{name:"",difficulty:1,defense:10,health:10,damage:0,size:1,speed:10,description:"",senses:"",languages:"",immune:"",stats:{str:10,agi:10,int:10,wil:10},traits:[],actions:[],reactions:[],endOfRound:[]}}function $(z=null){S(R,z?z.id:null,!0),S(A,JSON.stringify(z||ue()),!0),S(g,!0)}let J=Lt(new Set);function K(z){J.has(z)?J.delete(z):J.add(z)}function w(z){const E=e(R)||pa();ga.set(E,{...z,id:E}),S(g,!1)}function C(z){const E=f().find(L=>L.id===z);S(U,{isOpen:!0,title:"Excluir Inimigo",message:`Tem certeza que deseja excluir permanentemente o inimigo "${E?.name||"este inimigo"}"?`,onConfirm:()=>{ga.delete(z),e(U).isOpen=!1}},!0)}function F(z=null){S(se,z?z.id:null,!0),S(de,JSON.stringify(z||{name:"",enemies:[]}),!0),S(H,!0)}function B(z){const E=e(se)||pa();na.set(E,{...z,id:E}),S(H,!1)}function q(z){const E=O().find(L=>L.id===z);S(U,{isOpen:!0,title:"Excluir Encontro",message:`Tem certeza que deseja excluir permanentemente o encontro "${E?.name||"este encontro"}"?`,onConfirm:()=>{na.delete(z),e(U).isOpen=!1}},!0)}function P(z){const E=o().params.id;if(!E||!rt.has(E))return;const L=rt.get(E),Se=L.activeEnemies||[];let Ne=[];z.enemies.forEach(Ve=>{const ke=f().find(lt=>lt.id===Ve.enemyId);if(ke)for(let lt=0;lt<Ve.count;lt++)Ne.push({...ke,instanceId:`e_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,damage:0,currentHealth:ke.health,afflictions:[],acted:!1,initiative:!1})}),rt.set(E,{...L,activeEnemies:[...Se,...Ne]})}function V(z,E){z.dataTransfer.setData("text/plain",E.id),z.dataTransfer.effectAllowed="copy"}function pe(z){return z.preventDefault(),!1}function I(z,E){z.preventDefault();const L=z.dataTransfer.getData("text/plain");if(!L)return;const Se=E.enemies||[],Ne=Se.find(ke=>ke.enemyId===L);let Ve;Ne?Ve=Se.map(ke=>ke.enemyId===L?{...ke,count:ke.count+1}:ke):Ve=[...Se,{enemyId:L,count:1}],na.set(E.id,{...E,enemies:Ve})}var me=Yi(),Pe=a(me),Ue=a(Pe),Oe=a(Ue),it=a(Oe);Ia(it,{size:16}),le(),t(Oe),t(Ue);var ft=r(Ue,2),st=a(ft);st.__click=()=>F();var nt=a(st);Ut(nt,{size:28,class:"group-hover:scale-110 transition-transform"}),le(2),t(st);var we=r(st,2);ge(we,1,O,z=>z.id,(z,E)=>{var L=Qi(),Se=a(L),Ne=a(Se),Ve=a(Ne,!0);t(Ne);var ke=r(Ne,2),lt=a(ke);ge(lt,17,()=>e(E).enemies||[],Ge,($e,Ye)=>{const Nt=re(()=>f().find(Tt=>Tt.id===e(Ye).enemyId));var jt=qi(),Be=a(jt),gt=a(Be);t(Be);var St=r(Be,2),pt=a(St,!0);t(St),t(jt),D(()=>{p(gt,`${e(Ye).count??""}x`),p(pt,e(Nt)?e(Nt).name:"...")}),l($e,jt)});var Mt=r(lt,2);{var It=$e=>{var Ye=Gi();l($e,Ye)};k(Mt,$e=>{e(E).enemies?.length||$e(It)})}t(ke),t(Se);var Pt=r(Se,2),Ke=a(Pt);Ke.__click=()=>P(e(E));var ht=a(Ke);Ea(ht,{size:12,fill:"currentColor"}),le(),t(Ke);var We=r(Ke,2);We.__click=()=>F(e(E));var Ot=a(We);tr(Ot,{size:14}),t(We);var Le=r(We,2);Le.__click=()=>q(e(E).id);var dt=a(Le);Xt(dt,{size:14}),t(Le),t(Pt),t(L),D(()=>{Ft(L,"aria-label",`Encontro ${e(E).name??""}`),p(Ve,e(E).name)}),sa("dragover",L,pe),sa("drop",L,$e=>I($e,e(E))),l(z,L)}),t(ft),t(Pe);var Y=r(Pe,2),Qe=a(Y),Je=a(Qe);ia(Je,{size:16}),le(),t(Qe),t(Y);var Fe=r(Y,2),be=a(Fe);be.__click=()=>$();var tt=a(be);Ut(tt,{size:32,class:"group-hover:scale-110 transition-transform"}),le(2),t(be);var Ze=r(be,2);ge(Ze,1,f,z=>z.id,(z,E)=>{var L=Xi(),Se=a(L),Ne=a(Se),Ve=a(Ne,!0);t(Ne);var ke=r(Ne,2),lt=a(ke);t(ke),t(Se);var Mt=r(Se,2);{var It=Le=>{var dt=Wi(),$e=a(dt),Ye=a($e,!0);t($e);var Nt=r($e,2);{var jt=Be=>{var gt=Ji();gt.__click=()=>K(e(E).id);var St=a(gt,!0);t(gt),D(pt=>p(St,pt),[()=>J.has(e(E).id)?"Ver menos":"Ver mais..."]),l(Be,gt)};k(Nt,Be=>{e(E).description.length>120&&Be(jt)})}t(dt),D(Be=>{ce($e,1,`text-xs text-slate-400 leading-relaxed ${Be??""}`),p(Ye,e(E).description)},[()=>J.has(e(E).id)?"":"line-clamp-3"]),l(Le,dt)},Pt=Le=>{var dt=Zi();l(Le,dt)};k(Mt,Le=>{e(E).description?Le(It):Le(Pt,!1)})}var Ke=r(Mt,2),ht=a(Ke);ht.__click=()=>$(e(E));var We=r(ht,2);We.__click=()=>C(e(E).id);var Ot=a(We);Xt(Ot,{size:14}),t(We),t(Ke),t(L),D(()=>{p(Ve,e(E).name),p(lt,`Nível ${e(E).difficulty??""}`)}),sa("dragstart",L,Le=>V(Le,e(E))),l(z,L)});var ot=r(Ze,2);{var Xe=z=>{var E=Ki();l(z,E)};k(ot,z=>{f().length===0&&z(Xe)})}t(Fe);var mt=r(Fe,2);Hi(mt,{get isOpen(){return e(g)},get initialData(){return e(A)},onClose:()=>S(g,!1),onSave:w});var _t=r(mt,2);Bi(_t,{get isOpen(){return e(H)},get initialData(){return e(de)},onClose:()=>S(H,!1),onSave:B});var xt=r(_t,2);ha(xt,{get isOpen(){return e(U).isOpen},get title(){return e(U).title},get message(){return e(U).message},get onConfirm(){return e(U).onConfirm},onCancel:()=>e(U).isOpen=!1}),t(me),l(_,me),qt(),u()}Gt(["click"]);var ts=v('<span class="absolute -top-1 -right-1 flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500 border border-slate-900"></span></span>'),as=v('<header class="bg-slate-900/80 backdrop-blur-md border-b border-white/5 sticky top-0 z-40 shadow-2xl"><div class="max-w-7xl mx-auto px-2 sm:px-4 py-2 sm:py-3"><div class="flex items-center justify-between gap-2 sm:gap-4"><div class="flex items-center gap-1 sm:gap-3 shrink-0"><button class="p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-all flex items-center gap-1 group" aria-label="Voltar para Dashboard" title="Voltar para Dashboard"><!> <!></button> <div class="flex flex-col"><h1 class="text-sm sm:text-base font-bold text-white leading-tight truncate max-w-[120px] sm:max-w-none"> </h1> <span class="text-[10px] text-indigo-400 font-mono font-bold uppercase tracking-wider"> </span></div></div> <div class="flex bg-slate-950/50 p-1 rounded-xl border border-white/5"><button><!> <span class="hidden min-[400px]:block">Sessão</span></button> <button><!> <span class="hidden min-[400px]:block">Bestiário</span></button></div> <div class="flex items-center gap-1 sm:gap-2"><button class="p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-all" aria-label="Configurações da Campanha" title="Configurações"><!></button> <button class="p-2 bg-indigo-600/10 text-indigo-400 border border-indigo-400/20 rounded-lg hover:bg-indigo-600 hover:text-white transition-all relative" aria-label="Toggle Histórico" title="Histórico"><!> <!></button></div></div></div></header>');function rs(_,i){Bt(i,!0);const f=()=>wt(Jt,"$isHistoryOpen",o),O=()=>wt(Aa,"$rollHistory",o),[o,y]=ta();let u=Rt(i,"campaignName",3,""),g=Rt(i,"gmName",3,"Mestre"),R=Rt(i,"activeSubTab",3,"session"),A=Rt(i,"onTabChange",3,()=>{}),H=Rt(i,"onOpenSettings",3,()=>{});var se=as(),de=a(se),U=a(de),ue=a(U),$=a(ue);$.__click=()=>or(wa("/"));var J=a($);Ca(J,{size:20,class:"group-hover:-translate-x-0.5 transition-transform"});var K=r(J,2);Za(K,{size:18,class:"hidden sm:block opacity-50"}),t($);var w=r($,2),C=a(w),F=a(C,!0);t(C);var B=r(C,2),q=a(B,!0);t(B),t(w),t(ue);var P=r(ue,2),V=a(P);V.__click=()=>A()("session");var pe=a(V);{let we=re(()=>R()==="session"?"opacity-100":"opacity-50");Xa(pe,{size:14,get class(){return e(we)}})}le(2),t(V);var I=r(V,2);I.__click=()=>A()("bestiary");var me=a(I);{let we=re(()=>R()==="bestiary"?"opacity-100":"opacity-50");fr(me,{size:14,get class(){return e(we)}})}le(2),t(I),t(P);var Pe=r(P,2),Ue=a(Pe);Ue.__click=function(...we){H()?.apply(this,we)};var Oe=a(Ue);ar(Oe,{size:18}),t(Ue);var it=r(Ue,2);it.__click=()=>Jt.update(we=>!we);var ft=a(it);Ka(ft,{size:18});var st=r(ft,2);{var nt=we=>{var Y=ts();l(we,Y)};k(st,we=>{O()&&O().length>0&&we(nt)})}t(it),t(Pe),t(U),t(de),t(se),D(()=>{p(F,u()),p(q,g()),ce(V,1,`flex items-center gap-2 px-3 sm:px-4 py-1.5 rounded-lg text-xs font-black transition-all ${R()==="session"?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"text-slate-500 hover:text-slate-300"}`),Ft(V,"aria-pressed",R()==="session"),ce(I,1,`flex items-center gap-2 px-3 sm:px-4 py-1.5 rounded-lg text-xs font-black transition-all ${R()==="bestiary"?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"text-slate-500 hover:text-slate-300"}`),Ft(I,"aria-pressed",R()==="bestiary"),Ft(it,"aria-pressed",f())}),l(_,se),qt(),y()}Gt(["click"]);var is=v('<!> <!> <main class="max-w-7xl mx-auto p-4 md:p-8 animate-in slide-in-from-bottom-4 duration-500"><!></main>',1),ss=v('<div class="flex flex-col items-center justify-center min-h-screen p-4 text-center"><div class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ghost"><path d="M9 10h.01"></path><path d="M15 10h.01"></path><path d="M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"></path></svg></div> <h1 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">Campanha Não Encontrada</h1> <p class="text-slate-400 mb-8 max-w-md">Esta campanha não existe na sua base local ou foi removida. Crie uma nova campanha através da página inicial.</p> <button class="bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded-xl font-bold transition-all flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"></path><path d="19 12H5"></path></svg> Voltar</button></div>'),ns=v('<div class="flex items-center justify-center min-h-screen"><div class="relative w-16 h-16"><div class="absolute inset-0 border-4 border-indigo-500/20 rounded-full"></div> <div class="absolute inset-0 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div></div></div>'),os=v('<div class="min-h-screen bg-slate-950 text-slate-100 font-sans pb-20"><!> <!></div>');function Is(_,i){Bt(i,!0);const f=()=>wt(_a,"$page",y),O=()=>wt(Pa,"$liveCampaigns",y),o=()=>wt(Jt,"$isHistoryOpen",y),[y,u]=ta();let g=ye("session"),R=ye(!1),A=re(()=>f().params.id),H=re(()=>O().find(w=>w.id===e(A))),se=re(()=>!!e(H));function de(w){if(!e(A)||!e(H))return;const C={...e(H),...w};rt.set(e(A),C),oa(e(A),{name:C.name,gmName:C.gmName}),S(R,!1)}var U=os(),ue=a(U);{var $=w=>{var C=is(),F=ie(C);rs(F,{get campaignName(){return e(H).name},get gmName(){return e(H).gmName},get activeSubTab(){return e(g)},onTabChange:I=>S(g,I,!0),onOpenSettings:()=>S(R,!0)});var B=r(F,2);{let I=re(()=>JSON.stringify(e(H)));sr(B,{get isOpen(){return e(R)},get initialData(){return e(I)},onClose:()=>S(R,!1),onSave:de})}var q=r(B,2),P=a(q);{var V=I=>{pi(I,{get campaign(){return e(H)}})},pe=I=>{var me=je(),Pe=ie(me);{var Ue=Oe=>{es(Oe,{})};k(Pe,Oe=>{e(g)==="bestiary"&&Oe(Ue)},!0)}l(I,me)};k(P,I=>{e(g)==="session"?I(V):I(pe,!1)})}t(q),l(w,C)},J=w=>{var C=je(),F=ie(C);{var B=P=>{var V=ss(),pe=r(a(V),6);pe.__click=()=>window.history.back(),t(V),l(P,V)},q=P=>{var V=ns();l(P,V)};k(F,P=>{e(se)&&!e(H)?P(B):P(q,!1)},!0)}l(w,C)};k(ue,w=>{e(se)&&e(H)?w($):w(J,!1)})}var K=r(ue,2);ka(K,{get isOpen(){return o()},onClose:()=>Jt.set(!1)}),t(U),l(_,U),qt(),u()}Gt(["click"]);export{Is as component};
