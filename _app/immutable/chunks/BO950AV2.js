import{J as ct,O as jn,aL as jt,T as Qe,h as K,aa as Jn,a as zn,g as it,a0 as Wn,Q as Qn,R as er,S as Et,U as Te,L as Re,al as tr,aG as nr,ar as Pt,F as oe,K as Ce,N as rr,m as sr,W as Ct,aE as Jt,aM as zt,aN as Wt,aO as Qt,G as en,I as ar,aP as or,aQ as et,ak as tn,aR as cr,aA as ir,aS as fr,aT as lr,aD as ur,H as Xe,aU as nn,aI as gt,aV as dr,aW as vr,f as hr,aX as bt,aY as rn,aZ as yr,a_ as pr,a$ as gr,b0 as br,b1 as mr,b2 as wr,b3 as _r,b4 as Ar,b5 as Sr,aK as kr,q as sn,ai as an}from"./BlobBfBu.js";import{i as Tr,c as Er,d as Pr,n as Cr,a as Lr}from"./OaA2MUvX.js";let He=null;function Xs(e){He=e}function qs(e,t){return t}function xr(e,t,n){for(var r=[],s=t.length,a=0;a<s;a++)fr(t[a].e,r,!0);lr(r,()=>{var c=r.length===0&&n!==null;if(c){var u=n,i=u.parentNode;ur(i),i.append(u),e.items.clear(),j(e,t[0].prev,t[s-1].next)}for(var v=0;v<s;v++){var l=t[v];c||(e.items.delete(l.k),j(e,l.prev,l.next)),Xe(l.e,!c)}e.first===t[0]&&(e.first=t[0].prev)})}function Fs(e,t,n,r,s,a=null){var c=e,u=new Map,i=null,v=(t&jt)!==0,l=(t&Wt)!==0,f=(t&Qt)!==0;if(v){var o=e;c=K?Qe(Jn(o)):o.appendChild(ct())}K&&zn();var h=null,m=Wn(()=>{var k=n();return zt(k)?k:k==null?[]:Jt(k)}),S,y=!0;function w(){Nr(N,S,c,t,r),h!==null&&(S.length===0?(h.fragment?(c.before(h.fragment),h.fragment=null):en(h.effect),L.first=h.effect):ar(h.effect,()=>{h=null}))}var L=jn(()=>{S=it(m);var k=S.length;let X=!1;if(K){var T=Qn(c)===er;T!==(k===0)&&(c=Et(),Qe(c),Te(!1),X=!0)}for(var P=new Set,C=oe,I=null,M=rr(),D=0;D<k;D+=1){K&&Re.nodeType===tr&&Re.data===nr&&(c=Re,X=!0,Te(!1));var d=S[D],p=r(d,D),_=y?null:u.get(p);_?(l&&Pt(_.v,d),f?Pt(_.i,D):_.i=D,M&&C.skipped_effects.delete(_.e)):(_=Or(y?c:null,I,d,p,D,s,t,n),y&&(_.o=!0,I===null?i=_:I.next=_,I=_),u.set(p,_)),P.add(p)}if(k===0&&a&&!h)if(y)h={fragment:null,effect:Ce(()=>a(c))};else{var E=document.createDocumentFragment(),x=ct();E.append(x),h={fragment:E,effect:Ce(()=>a(x))}}if(K&&k>0&&Qe(Et()),!y)if(M){for(const[b,A]of u)P.has(b)||C.skipped_effects.add(A.e);C.oncommit(w),C.ondiscard(()=>{})}else w();X&&Te(!0),it(m)}),N={effect:L,items:u,first:i};y=!1,K&&(c=Re)}function Nr(e,t,n,r,s){var a=(r&cr)!==0,c=t.length,u=e.items,i=e.first,v,l=null,f,o=[],h=[],m,S,y,w;if(a)for(w=0;w<c;w+=1)m=t[w],S=s(m,w),y=u.get(S),y.o&&(y.a?.measure(),(f??=new Set).add(y));for(w=0;w<c;w+=1){if(m=t[w],S=s(m,w),y=u.get(S),e.first??=y,!y.o){y.o=!0;var L=l?l.next:i;j(e,l,y),j(e,y,L),tt(y,L,n),l=y,o=[],h=[],i=l.next;continue}if((y.e.f&et)!==0&&(en(y.e),a&&(y.a?.unfix(),(f??=new Set).delete(y))),y!==i){if(v!==void 0&&v.has(y)){if(o.length<h.length){var N=h[0],k;l=N.prev;var X=o[0],T=o[o.length-1];for(k=0;k<o.length;k+=1)tt(o[k],N,n);for(k=0;k<h.length;k+=1)v.delete(h[k]);j(e,X.prev,T.next),j(e,l,X),j(e,T,N),i=N,l=T,w-=1,o=[],h=[]}else v.delete(y),tt(y,i,n),j(e,y.prev,y.next),j(e,y,l===null?e.first:l.next),j(e,l,y),l=y;continue}for(o=[],h=[];i!==null&&i.k!==S;)(i.e.f&et)===0&&(v??=new Set).add(i),h.push(i),i=i.next;if(i===null)continue;y=i}o.push(y),l=y,i=y.next}let P=u.size>c;if(i!==null||v!==void 0){for(var C=v===void 0?[]:Jt(v);i!==null;)(i.e.f&et)===0&&C.push(i),i=i.next;var I=C.length;if(P=u.size-I>c,I>0){var M=(r&jt)!==0&&c===0?n:null;if(a){for(w=0;w<I;w+=1)C[w].a?.measure();for(w=0;w<I;w+=1)C[w].a?.fix()}xr(e,C,M)}}if(P)for(const D of u.values())D.o||(j(e,l,D),l=D);e.effect.last=l&&l.e,a&&tn(()=>{if(f!==void 0)for(y of f)y.a?.apply()})}function Or(e,t,n,r,s,a,c,u){var i=He,v=(c&Wt)!==0,l=(c&or)===0,f=v?l?sr(n,!1,!1):Ct(n):n,o=(c&Qt)===0?s:Ct(s),h={i:o,v:f,k:r,a:null,e:null,o:!1,prev:t,next:null};He=h;try{if(e===null){var m=document.createDocumentFragment();m.append(e=ct())}return h.e=Ce(()=>a(e,f,o,u)),t!==null&&(t.next=h),h}finally{He=i}}function tt(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,a=e.e.nodes_start;a!==null&&a!==r;){var c=ir(a);s.before(a),a=c}}function j(e,t,n){t===null?(e.first=n,e.effect.first=n&&n.e):(t.e.next&&(t.e.next.prev=null),t.next=n,t.e.next=n&&n.e),n!==null&&(n.e.prev&&(n.e.prev.next=null),n.prev=t,n.e.prev=t&&t.e)}function Mr(e,t){var n=void 0,r;nn(()=>{n!==(n=t())&&(r&&(Xe(r),r=null),n&&(r=Ce(()=>{gt(()=>n(e))})))})}function on(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=on(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Rr(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=on(e))&&(r&&(r+=" "),r+=t);return r}function Ir(e){return typeof e=="object"?Rr(e):e??""}const Lt=[...` 	
\r\fÂ \v\uFEFF`];function Ur(e,t,n){var r=e==null?"":""+e;if(n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var a=s.length,c=0;(c=r.indexOf(s,c))>=0;){var u=c+a;(c===0||Lt.includes(r[c-1]))&&(u===r.length||Lt.includes(r[u]))?r=(c===0?"":r.substring(0,c))+r.substring(u+1):c=u}}return r===""?null:r}function xt(e,t=!1){var n=t?" !important;":";",r="";for(var s in e){var a=e[s];a!=null&&a!==""&&(r+=" "+s+": "+a+n)}return r}function nt(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Br(e,t){if(t){var n="",r,s;if(Array.isArray(t)?(r=t[0],s=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,c=0,u=!1,i=[];r&&i.push(...Object.keys(r).map(nt)),s&&i.push(...Object.keys(s).map(nt));var v=0,l=-1;const S=e.length;for(var f=0;f<S;f++){var o=e[f];if(u?o==="/"&&e[f-1]==="*"&&(u=!1):a?a===o&&(a=!1):o==="/"&&e[f+1]==="*"?u=!0:o==='"'||o==="'"?a=o:o==="("?c++:o===")"&&c--,!u&&a===!1&&c===0){if(o===":"&&l===-1)l=f;else if(o===";"||f===S-1){if(l!==-1){var h=nt(e.substring(v,l).trim());if(!i.includes(h)){o!==";"&&f++;var m=e.substring(v,f).trim();n+=" "+m+";"}}v=f+1,l=-1}}}}return r&&(n+=xt(r)),s&&(n+=xt(s,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function Dr(e,t,n,r,s,a){var c=e.__className;if(K||c!==n||c===void 0){var u=Ur(n,r,a);(!K||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):t?e.className=u:e.setAttribute("class",u)),e.__className=n}else if(a&&s!==a)for(var i in a){var v=!!a[i];(s==null||v!==!!s[i])&&e.classList.toggle(i,v)}return a}function rt(e,t={},n,r){for(var s in n){var a=n[s];t[s]!==a&&(n[s]==null?e.style.removeProperty(s):e.style.setProperty(s,a,r))}}function Hr(e,t,n,r){var s=e.__style;if(K||s!==t){var a=Br(t,r);(!K||a!==e.getAttribute("style"))&&(a==null?e.removeAttribute("style"):e.style.cssText=a),e.__style=t}else r&&(Array.isArray(r)?(rt(e,n?.[0],r[0]),rt(e,n?.[1],r[1],"important")):rt(e,n,r));return r}function qe(e,t,n=!1){if(e.multiple){if(t==null)return;if(!zt(t))return dr();for(var r of e.options)r.selected=t.includes(Ee(r));return}for(r of e.options){var s=Ee(r);if(vr(s,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function cn(e){var t=new MutationObserver(()=>{qe(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),hr(()=>{t.disconnect()})}function Gs(e,t,n=t){var r=new WeakSet,s=!0;bt(e,"change",a=>{var c=a?"[selected]":":checked",u;if(e.multiple)u=[].map.call(e.querySelectorAll(c),Ee);else{var i=e.querySelector(c)??e.querySelector("option:not([disabled])");u=i&&Ee(i)}n(u),oe!==null&&r.add(oe)}),gt(()=>{var a=t();if(e===document.activeElement){var c=rn??oe;if(r.has(c))return}if(qe(e,a,s),s&&a===void 0){var u=e.querySelector(":checked");u!==null&&(a=Ee(u),n(a))}e.__value=a,s=!1}),cn(e)}function Ee(e){return"__value"in e?e.__value:e.value}const we=Symbol("class"),_e=Symbol("style"),fn=Symbol("is custom element"),ln=Symbol("is html");function $r(e){if(K){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;Fe(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var s=e.checked;Fe(e,"checked",null),e.checked=s}}};e.__on_r=n,tn(n),mr()}}function js(e,t){var n=mt(e);n.value===(n.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function Vr(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Fe(e,t,n,r){var s=mt(e);K&&(s[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||s[t]!==(s[t]=n)&&(t==="loading"&&(e[Ar]=n),n==null?e.removeAttribute(t):typeof n!="string"&&un(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Kr(e,t,n,r,s=!1,a=!1){if(K&&s&&e.tagName==="INPUT"){var c=e,u=c.type==="checkbox"?"defaultChecked":"defaultValue";u in n||$r(c)}var i=mt(e),v=i[fn],l=!i[ln];let f=K&&v;f&&Te(!1);var o=t||{},h=e.tagName==="OPTION";for(var m in t)m in n||(n[m]=null);n.class?n.class=Ir(n.class):n[we]&&(n.class=null),n[_e]&&(n.style??=null);var S=un(e);for(const T in n){let P=n[T];if(h&&T==="value"&&P==null){e.value=e.__value="",o[T]=P;continue}if(T==="class"){var y=e.namespaceURI==="http://www.w3.org/1999/xhtml";Dr(e,y,P,r,t?.[we],n[we]),o[T]=P,o[we]=n[we];continue}if(T==="style"){Hr(e,P,t?.[_e],n[_e]),o[T]=P,o[_e]=n[_e];continue}var w=o[T];if(!(P===w&&!(P===void 0&&e.hasAttribute(T)))){o[T]=P;var L=T[0]+T[1];if(L!=="$$")if(L==="on"){const C={},I="$$"+T;let M=T.slice(2);var N=Lr(M);if(Tr(M)&&(M=M.slice(0,-7),C.capture=!0),!N&&w){if(P!=null)continue;e.removeEventListener(M,o[I],C),o[I]=null}if(P!=null)if(N)e[`__${M}`]=P,Pr([M]);else{let D=function(d){o[T].call(this,d)};o[I]=Er(M,e,D,C)}else N&&(e[`__${M}`]=void 0)}else if(T==="style")Fe(e,T,P);else if(T==="autofocus")gr(e,!!P);else if(!v&&(T==="__value"||T==="value"&&P!=null))e.value=e.__value=P;else if(T==="selected"&&h)Vr(e,P);else{var k=T;l||(k=Cr(k));var X=k==="defaultValue"||k==="defaultChecked";if(P==null&&!v&&!X)if(i[T]=null,k==="value"||k==="checked"){let C=e;const I=t===void 0;if(k==="value"){let M=C.defaultValue;C.removeAttribute(k),C.defaultValue=M,C.value=C.__value=I?M:null}else{let M=C.defaultChecked;C.removeAttribute(k),C.defaultChecked=M,C.checked=I?M:!1}}else e.removeAttribute(T);else X||S.includes(k)&&(v||typeof P!="string")?(e[k]=P,k in i&&(i[k]=br)):typeof P!="function"&&Fe(e,k,P)}}}return f&&Te(!0),o}function Js(e,t,n=[],r=[],s=[],a,c=!1,u=!1){yr(s,n,r,i=>{var v=void 0,l={},f=e.nodeName==="SELECT",o=!1;if(nn(()=>{var m=t(...i.map(it)),S=Kr(e,v,m,a,c,u);o&&f&&"value"in m&&qe(e,m.value);for(let w of Object.getOwnPropertySymbols(l))m[w]||Xe(l[w]);for(let w of Object.getOwnPropertySymbols(m)){var y=m[w];w.description===pr&&(!v||y!==v[w])&&(l[w]&&Xe(l[w]),l[w]=Ce(()=>Mr(e,()=>y))),S[w]=y}v=S}),f){var h=e;gt(()=>{qe(h,v.value,!0),cn(h)})}o=!0})}function mt(e){return e.__attributes??={[fn]:e.nodeName.includes("-"),[ln]:e.namespaceURI===wr}}var Nt=new Map;function un(e){var t=e.getAttribute("is")||e.nodeName,n=Nt.get(t);if(n)return n;Nt.set(t,n=[]);for(var r,s=e,a=Element.prototype;a!==s;){r=Sr(s);for(var c in r)r[c].set&&n.push(c);s=_r(s)}return n}function zs(e,t,n=t){var r=new WeakSet;bt(e,"input",async s=>{var a=s?e.defaultValue:e.value;if(a=st(e)?at(a):a,n(a),oe!==null&&r.add(oe),await kr(),a!==(a=t())){var c=e.selectionStart,u=e.selectionEnd,i=e.value.length;if(e.value=a??"",u!==null){var v=e.value.length;c===u&&u===i&&v>i?(e.selectionStart=v,e.selectionEnd=v):(e.selectionStart=c,e.selectionEnd=Math.min(u,v))}}}),(K&&e.defaultValue!==e.value||sn(t)==null&&e.value)&&(n(st(e)?at(e.value):e.value),oe!==null&&r.add(oe)),an(()=>{var s=t();if(e===document.activeElement){var a=rn??oe;if(r.has(a))return}st(e)&&s===at(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Ws(e,t,n=t){bt(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),(K&&e.defaultChecked!==e.checked||sn(t)==null)&&n(e.checked),an(()=>{var r=t();e.checked=!!r})}function st(e){var t=e.type;return t==="number"||t==="range"}function at(e){return e===""?null:+e}const dn={p:0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,n:0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,h:1n,a:0n,b:7n,Gx:0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy:0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n},{p:ie,n:Me,Gx:Yr,Gy:Zr,b:vn}=dn,G=32,Le=64,ft={publicKey:G+1,publicKeyUncompressed:Le+1,seed:G+G/2},Xr=(...e)=>{"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(...e)},U=(e="")=>{const t=new Error(e);throw Xr(t,U),t},qr=e=>typeof e=="bigint",Fr=e=>typeof e=="string",Gr=e=>e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array",z=(e,t,n="")=>{const r=Gr(e),s=e?.length,a=t!==void 0;if(!r||a&&s!==t){const c=n&&`"${n}" `,u=a?` of length ${t}`:"",i=r?`length=${s}`:`type=${typeof e}`;U(c+"expected Uint8Array"+u+", got "+i)}return e},xe=e=>new Uint8Array(e),hn=(e,t)=>e.toString(16).padStart(t,"0"),yn=e=>Array.from(z(e)).map(t=>hn(t,2)).join(""),re={_0:48,_9:57,A:65,F:70,a:97,f:102},Ot=e=>{if(e>=re._0&&e<=re._9)return e-re._0;if(e>=re.A&&e<=re.F)return e-(re.A-10);if(e>=re.a&&e<=re.f)return e-(re.a-10)},pn=e=>{const t="hex invalid";if(!Fr(e))return U(t);const n=e.length,r=n/2;if(n%2)return U(t);const s=xe(r);for(let a=0,c=0;a<r;a++,c+=2){const u=Ot(e.charCodeAt(c)),i=Ot(e.charCodeAt(c+1));if(u===void 0||i===void 0)return U(t);s[a]=u*16+i}return s},gn=()=>globalThis?.crypto,Mt=()=>gn()?.subtle??U("crypto.subtle must be defined, consider polyfill"),be=(...e)=>{const t=xe(e.reduce((r,s)=>r+z(s).length,0));let n=0;return e.forEach(r=>{t.set(r,n),n+=r.length}),t},wt=(e=G)=>gn().getRandomValues(xe(e)),Ge=BigInt,de=(e,t,n,r="bad number: out of range")=>qr(e)&&t<=e&&e<n?e:U(r),g=(e,t=ie)=>{const n=e%t;return n>=0n?n:t+n},We=e=>g(e,Me),jr=(e,t)=>{(e===0n||t<=0n)&&U("no inverse n="+e+" mod="+t);let n=g(e,t),r=t,s=0n,a=1n;for(;n!==0n;){const c=r/n,u=r%n,i=s-a*c;r=n,n=u,s=a,a=i}return r===1n?g(s,t):U("no inverse")},Jr=e=>{const t=_n[e];return typeof t!="function"&&U("hashes."+e+" not set"),t},ot=e=>e instanceof F?e:U("Point expected"),bn=e=>g(g(e*e)*e+vn),Rt=e=>de(e,0n,ie),$e=e=>de(e,1n,ie),zr=e=>de(e,1n,Me),me=e=>(e&1n)===0n,mn=e=>Uint8Array.of(e),Wr=e=>mn(me(e)?2:3),wn=e=>{const t=bn($e(e));let n=1n;for(let r=t,s=(ie+1n)/4n;s>0n;s>>=1n)s&1n&&(n=n*r%ie),r=r*r%ie;return g(n*n)===t?n:U("sqrt invalid")};class F{static BASE;static ZERO;X;Y;Z;constructor(t,n,r){this.X=Rt(t),this.Y=$e(n),this.Z=Rt(r),Object.freeze(this)}static CURVE(){return dn}static fromAffine(t){const{x:n,y:r}=t;return n===0n&&r===0n?le:new F(n,r,1n)}static fromBytes(t){z(t);const{publicKey:n,publicKeyUncompressed:r}=ft;let s;const a=t.length,c=t[0],u=t.subarray(1),i=je(u,0,G);if(a===n&&(c===2||c===3)){let v=wn(i);const l=me(v);me(Ge(c))!==l&&(v=g(-v)),s=new F(i,v,1n)}return a===r&&c===4&&(s=new F(i,je(u,G,Le),1n)),s?s.assertValidity():U("bad point: not on curve")}static fromHex(t){return F.fromBytes(pn(t))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(t){const{X:n,Y:r,Z:s}=this,{X:a,Y:c,Z:u}=ot(t),i=g(n*u),v=g(a*s),l=g(r*u),f=g(c*s);return i===v&&l===f}is0(){return this.equals(le)}negate(){return new F(this.X,g(-this.Y),this.Z)}double(){return this.add(this)}add(t){const{X:n,Y:r,Z:s}=this,{X:a,Y:c,Z:u}=ot(t),i=0n,v=vn;let l=0n,f=0n,o=0n;const h=g(v*3n);let m=g(n*a),S=g(r*c),y=g(s*u),w=g(n+r),L=g(a+c);w=g(w*L),L=g(m+S),w=g(w-L),L=g(n+s);let N=g(a+u);return L=g(L*N),N=g(m+y),L=g(L-N),N=g(r+s),l=g(c+u),N=g(N*l),l=g(S+y),N=g(N-l),o=g(i*L),l=g(h*y),o=g(l+o),l=g(S-o),o=g(S+o),f=g(l*o),S=g(m+m),S=g(S+m),y=g(i*y),L=g(h*L),S=g(S+y),y=g(m-y),y=g(i*y),L=g(L+y),m=g(S*L),f=g(f+m),m=g(N*L),l=g(w*l),l=g(l-m),m=g(w*S),o=g(N*o),o=g(o+m),new F(l,f,o)}subtract(t){return this.add(ot(t).negate())}multiply(t,n=!0){if(!n&&t===0n)return le;if(zr(t),t===1n)return this;if(this.equals(ve))return ls(t).p;let r=le,s=ve;for(let a=this;t>0n;a=a.double(),t>>=1n)t&1n?r=r.add(a):n&&(s=s.add(a));return r}multiplyUnsafe(t){return this.multiply(t,!1)}toAffine(){const{X:t,Y:n,Z:r}=this;if(this.equals(le))return{x:0n,y:0n};if(r===1n)return{x:t,y:n};const s=jr(r,ie);return g(r*s)!==1n&&U("inverse invalid"),{x:g(t*s),y:g(n*s)}}assertValidity(){const{x:t,y:n}=this.toAffine();return $e(t),$e(n),g(n*n)===bn(t)?this:U("bad point: not on curve")}toBytes(t=!0){const{x:n,y:r}=this.assertValidity().toAffine(),s=W(n);return t?be(Wr(r),s):be(mn(4),s,W(r))}toHex(t){return yn(this.toBytes(t))}}const ve=new F(Yr,Zr,1n),le=new F(0n,1n,0n);F.BASE=ve;F.ZERO=le;const Qr=(e,t,n)=>ve.multiply(t,!1).add(e.multiply(n,!1)).assertValidity(),he=e=>Ge("0x"+(yn(e)||"0")),je=(e,t,n)=>he(e.subarray(t,n)),es=2n**256n,W=e=>pn(hn(de(e,0n,es),Le)),ts=e=>{const t=he(z(e,G,"secret key"));return de(t,1n,Me,"invalid secret key: outside of range")},It="SHA-256",_n={hmacSha256Async:async(e,t)=>{const n=Mt(),r="HMAC",s=await n.importKey("raw",e,{name:r,hash:{name:It}},!1,["sign"]);return xe(await n.sign(r,s,t))},hmacSha256:void 0,sha256Async:async e=>xe(await Mt().digest(It,e)),sha256:void 0},ns=(e=wt(ft.seed))=>{z(e),(e.length<ft.seed||e.length>1024)&&U("expected 40-1024b");const t=g(he(e),Me-1n);return W(t+1n)},rs=e=>t=>{const n=ns(t);return{secretKey:n,publicKey:e(n)}},An=e=>Uint8Array.from("BIP0340/"+e,t=>t.charCodeAt(0)),Sn="aux",kn="nonce",Tn="challenge",lt=(e,...t)=>{const n=Jr("sha256"),r=n(An(e));return n(be(r,r,...t))},ut=async(e,...t)=>{const n=_n.sha256Async,r=await n(An(e));return await n(be(r,r,...t))},_t=e=>{const t=ts(e),n=ve.multiply(t),{x:r,y:s}=n.assertValidity().toAffine(),a=me(s)?t:We(-t),c=W(r);return{d:a,px:c}},At=e=>We(he(e)),En=(...e)=>At(lt(Tn,...e)),Pn=async(...e)=>At(await ut(Tn,...e)),Cn=e=>_t(e).px,ss=rs(Cn),Ln=(e,t,n)=>{const{px:r,d:s}=_t(t);return{m:z(e),px:r,d:s,a:z(n,G)}},xn=e=>{const t=At(e);t===0n&&U("sign failed: k is zero");const{px:n,d:r}=_t(W(t));return{rx:n,k:r}},Nn=(e,t,n,r)=>be(t,W(We(e+n*r))),On="invalid signature produced",as=(e,t,n=wt(G))=>{const{m:r,px:s,d:a,a:c}=Ln(e,t,n),u=lt(Sn,c),i=W(a^he(u)),v=lt(kn,i,s,r),{rx:l,k:f}=xn(v),o=En(l,s,r),h=Nn(f,l,o,a);return Rn(h,r,s)||U(On),h},os=async(e,t,n=wt(G))=>{const{m:r,px:s,d:a,a:c}=Ln(e,t,n),u=await ut(Sn,c),i=W(a^he(u)),v=await ut(kn,i,s,r),{rx:l,k:f}=xn(v),o=await Pn(l,s,r),h=Nn(f,l,o,a);return await In(h,r,s)||U(On),h},cs=(e,t)=>e instanceof Promise?e.then(t):t(e),Mn=(e,t,n,r)=>{const s=z(e,Le,"signature"),a=z(t,void 0,"message"),c=z(n,G,"publicKey");try{const u=he(c),i=wn(u),v=me(i)?i:g(-i),l=new F(u,v,1n).assertValidity(),f=W(l.toAffine().x),o=je(s,0,G);de(o,1n,ie);const h=je(s,G,Le);de(h,1n,Me);const m=be(W(o),f,a);return cs(r(m),S=>{const{x:y,y:w}=Qr(l,h,We(-S)).toAffine();return!(!me(w)||y!==o)})}catch{return!1}},Rn=(e,t,n)=>Mn(e,t,n,En),In=async(e,t,n)=>Mn(e,t,n,Pn),Un={keygen:ss,getPublicKey:Cn,sign:as,verify:Rn,signAsync:os,verifyAsync:In},Je=8,is=256,Bn=Math.ceil(is/Je)+1,dt=2**(Je-1),fs=()=>{const e=[];let t=ve,n=t;for(let r=0;r<Bn;r++){n=t,e.push(n);for(let s=1;s<dt;s++)n=n.add(t),e.push(n);t=n.double()}return e};let Ut;const Bt=(e,t)=>{const n=t.negate();return e?n:t},ls=e=>{const t=Ut||(Ut=fs());let n=le,r=ve;const s=2**Je,a=s,c=Ge(s-1),u=Ge(Je);for(let i=0;i<Bn;i++){let v=Number(e&c);e>>=u,v>dt&&(v-=a,e+=1n);const l=i*dt,f=l,o=l+Math.abs(v)-1,h=i%2!==0,m=v<0;v===0?r=r.add(Bt(h,t[f])):n=n.add(Bt(m,t[o]))}return e!==0n&&U("invalid wnaf"),{p:n,f:r}},{floor:vt,random:us,sin:ds}=Math,Ne="Trystero",Oe=(e,t)=>Array(e).fill().map(t),Dt="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",ht=e=>Oe(e,()=>Dt[vt(us()*Dt.length)]).join(""),pe=ht(20),ue=Promise.all.bind(Promise),Dn=typeof window<"u",{entries:Ht,fromEntries:vs,keys:hs}=Object,se=()=>{},ae=e=>new Error(`${Ne}: ${e}`),ys=new TextEncoder,ps=new TextDecoder,ge=e=>ys.encode(e),Ve=e=>ps.decode(e),yt=e=>e.reduce((t,n)=>t+n.toString(16).padStart(2,"0"),""),Ie=(...e)=>e.join("@"),gs=(e,t)=>{const n=[...e],r=()=>{const a=ds(t++)*1e4;return a-vt(a)};let s=n.length;for(;s;){const a=vt(r()*s--);[n[s],n[a]]=[n[a],n[s]]}return n},bs=(e,t,n,r)=>(e.relayUrls||gs(t,Hn(e.appId))).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||n),ce=JSON.stringify,ze=JSON.parse,Hn=(e,t=Number.MAX_SAFE_INTEGER)=>e.split("").reduce((n,r)=>n+r.charCodeAt(0),0)%t,$t=3333,Ue={};let Pe=null,pt=null;const ms=()=>{Pe||(Pe=new Promise(e=>{pt=e}).finally(()=>{pt=null,Pe=null}))},ws=()=>pt?.(),_s=(e,t)=>{const n={},r=()=>{const s=new WebSocket(e);s.onclose=()=>{if(Pe){Pe.then(r);return}Ue[e]??=$t,setTimeout(r,Ue[e]),Ue[e]*=2},s.onmessage=a=>t(a.data),n.socket=s,n.url=s.url,n.ready=new Promise(a=>s.onopen=()=>{a(n),Ue[e]=$t}),n.send=a=>{s.readyState===1&&s.send(a)}};return r(),n},As=()=>{if(Dn){const e=new AbortController;return addEventListener("online",ws,{signal:e.signal}),addEventListener("offline",ms,{signal:e.signal}),()=>e.abort()}return se},St="AES-GCM",Ss={},ks=e=>btoa(String.fromCharCode.apply(null,new Uint8Array(e))),Ts=e=>{const t=atob(e);return new Uint8Array(t.length).map((n,r)=>t.charCodeAt(r)).buffer},$n=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,ge(t))),Be=async e=>Ss[e]||=Array.from(await $n("SHA-1",e)).map(t=>t.toString(36)).join(""),Es=async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},ge(`${e}:${t}:${n}`)),{name:St},!1,["encrypt","decrypt"]),Vn="$",Kn=",",Ps=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));return n.join(Kn)+Vn+ks(await crypto.subtle.encrypt({name:St,iv:n},await e,ge(t)))},Cs=async(e,t)=>{const[n,r]=t.split(Vn);return Ve(await crypto.subtle.decrypt({name:St,iv:new Uint8Array(n.split(Kn))},await e,Ts(r)))},Ls=5e3,Vt="icegatheringstatechange",Kt="offer",xs="answer",Yt=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:r})=>{const s=new(n||RTCPeerConnection)({iceServers:Ns.concat(r||[]),...t}),a={};let c=!1,u=!1,i=null;const v=f=>{f.binaryType="arraybuffer",f.bufferedAmountLowThreshold=65535,f.onmessage=o=>a.data?.(o.data),f.onopen=()=>a.connect?.(),f.onclose=()=>a.close?.(),f.onerror=o=>a.error?.(o)},l=f=>Promise.race([new Promise(o=>{const h=()=>{f.iceGatheringState==="complete"&&(f.removeEventListener(Vt,h),o())};f.addEventListener(Vt,h),h()}),new Promise(o=>setTimeout(o,Ls))]).then(()=>({type:f.localDescription.type,sdp:f.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return e?(i=s.createDataChannel("data"),v(i)):s.ondatachannel=({channel:f})=>{i=f,v(f)},s.onnegotiationneeded=async()=>{try{c=!0,await s.setLocalDescription();const f=await l(s);a.signal?.(f)}catch(f){a.error?.(f)}finally{c=!1}},s.onconnectionstatechange=()=>{["disconnected","failed","closed"].includes(s.connectionState)&&a.close?.()},s.ontrack=f=>{a.track?.(f.track,f.streams[0]),a.stream?.(f.streams[0])},s.onremovestream=f=>a.stream?.(f.stream),e&&(s.canTrickleIceCandidates||s.onnegotiationneeded()),{created:Date.now(),connection:s,get channel(){return i},get isDead(){return s.connectionState==="closed"},async signal(f){if(!(i?.readyState==="open"&&!f.sdp?.includes("a=rtpmap")))try{if(f.type===Kt){if(c||s.signalingState!=="stable"&&!u){if(e)return;await ue([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(f)])}else await s.setRemoteDescription(f);await s.setLocalDescription();const o=await l(s);return a.signal?.(o),o}else if(f.type===xs){u=!0;try{await s.setRemoteDescription(f)}finally{u=!1}}}catch(o){a.error?.(o)}},sendData:f=>i.send(f),destroy:()=>{i?.close(),s.close(),c=!1,u=!1},setHandlers:f=>Object.assign(a,f),offerPromise:e?new Promise(f=>a.signal=o=>{o.type===Kt&&f(o)}):Promise.resolve(),addStream:f=>f.getTracks().forEach(o=>s.addTrack(o,f)),removeStream:f=>s.getSenders().filter(o=>f.getTracks().includes(o.track)).forEach(o=>s.removeTrack(o)),addTrack:(f,o)=>s.addTrack(f,o),removeTrack:f=>{const o=s.getSenders().find(h=>h.track===f);o&&s.removeTrack(o)},replaceTrack:(f,o)=>{const h=s.getSenders().find(m=>m.track===f);if(h)return h.replaceTrack(o)}}},Ns=[...Oe(3,(e,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(e=>({urls:e})),Os=Object.getPrototypeOf(Uint8Array),Ke=12,Yn=0,Ye=Yn+Ke,Ze=Ye+1,Se=Ze+1,ke=Se+1,fe=16*2**10-ke,De=255,Zt="bufferedamountlow",ye=e=>"@_"+e,Ms=(e,t,n)=>{const r={},s={},a={},c={},u={},i={},v={},l={onPeerJoin:se,onPeerLeave:se,onPeerStream:se,onPeerTrack:se},f=(d,p)=>(d?Array.isArray(d)?d:[d]:hs(r)).flatMap(_=>{const E=r[_];return E?p(_,E):(console.warn(`${Ne}: no peer with id ${_} found`),[])}),o=d=>{r[d]&&(r[d].destroy(),delete r[d],delete c[d],delete u[d],l.onPeerLeave(d),t(d))},h=d=>{if(s[d])return a[d];if(!d)throw ae("action type argument is required");const p=ge(d);if(p.byteLength>Ke)throw ae(`action type string "${d}" (${p.byteLength}b) exceeds byte limit (${Ke}). Hint: choose a shorter name.`);const _=new Uint8Array(Ke);_.set(p);let E=0;return s[d]={onComplete:se,onProgress:se,setOnComplete:x=>s[d]={...s[d],onComplete:x},setOnProgress:x=>s[d]={...s[d],onProgress:x},send:async(x,b,A,R)=>{if(A&&typeof A!="object")throw ae("action meta argument must be an object");const q=typeof x;if(q==="undefined")throw ae("action data cannot be undefined");const H=q!=="string",Q=x instanceof Blob,O=Q||x instanceof ArrayBuffer||x instanceof Os;if(A&&!O)throw ae("action meta argument can only be used with binary data");const Y=O?new Uint8Array(Q?await x.arrayBuffer():x):ge(H?ce(x):x),J=A?ge(ce(A)):null,B=Math.ceil(Y.byteLength/fe)+(A?1:0)||1,$=Oe(B,(V,Z)=>{const ee=Z===B-1,te=A&&Z===0,ne=new Uint8Array(ke+(te?J.byteLength:ee?Y.byteLength-fe*(B-(A?2:1)):fe));return ne.set(_),ne.set([E],Ye),ne.set([ee|te<<1|O<<2|H<<3],Ze),ne.set([Math.round((Z+1)/B*De)],Se),ne.set(A?te?J:Y.subarray((Z-1)*fe,Z*fe):Y.subarray(Z*fe,(Z+1)*fe),ke),ne});return E=E+1&De,ue(f(b,async(V,Z)=>{const{channel:ee}=Z;let te=0;for(;te<B;){const ne=$[te];if(ee.bufferedAmount>ee.bufferedAmountLowThreshold&&await new Promise(Gn=>{const Tt=()=>{ee.removeEventListener(Zt,Tt),Gn()};ee.addEventListener(Zt,Tt)}),!r[V])break;Z.sendData(ne),te++,R?.(ne[Se]/De,V,A)}}))}},a[d]||=[s[d].send,s[d].setOnComplete,s[d].setOnProgress]},m=(d,p)=>{const _=new Uint8Array(p),E=Ve(_.subarray(Yn,Ye)).replaceAll("\0",""),[x]=_.subarray(Ye,Ze),[b]=_.subarray(Ze,Se),[A]=_.subarray(Se,ke),R=_.subarray(ke),q=!!(b&1),H=!!(b&2),Q=!!(b&4),O=!!(b&8);if(!s[E]){console.warn(`${Ne}: received message with unregistered type (${E})`);return}c[d]||={},c[d][E]||={};const Y=c[d][E][x]||={chunks:[]};if(H?Y.meta=ze(Ve(R)):Y.chunks.push(R),s[E].onProgress(A/De,d,Y.meta),!q)return;const J=new Uint8Array(Y.chunks.reduce((B,$)=>B+$.byteLength,0));if(Y.chunks.reduce((B,$)=>(J.set($,B),B+$.byteLength),0),delete c[d][E][x],Q)s[E].onComplete(J,d,Y.meta);else{const B=Ve(J);s[E].onComplete(O?ze(B):B,d)}},S=async()=>{await M(""),await new Promise(d=>setTimeout(d,99)),Ht(r).forEach(([d,p])=>{p.destroy(),delete r[d]}),n()},[y,w]=h(ye("ping")),[L,N]=h(ye("pong")),[k,X]=h(ye("signal")),[T,P]=h(ye("stream")),[C,I]=h(ye("track")),[M,D]=h(ye("leave"));return e((d,p)=>{r[p]||(r[p]=d,d.setHandlers({data:_=>m(p,_),stream:_=>{l.onPeerStream(_,p,i[p]),delete i[p]},track:(_,E)=>{l.onPeerTrack(_,E,p,v[p]),delete v[p]},signal:_=>k(_,p),close:()=>o(p),error:_=>{console.error(_),o(p)}}),l.onPeerJoin(p))}),w((d,p)=>L("",p)),N((d,p)=>{u[p]?.(),delete u[p]}),X((d,p)=>r[p]?.signal(d)),P((d,p)=>i[p]=d),I((d,p)=>v[p]=d),D((d,p)=>o(p)),Dn&&addEventListener("beforeunload",S),{makeAction:h,leave:S,ping:async d=>{if(!d)throw ae("ping() must be called with target peer ID");const p=Date.now();return y("",d),await new Promise(_=>u[d]=_),Date.now()-p},getPeers:()=>vs(Ht(r).map(([d,p])=>[d,p.connection])),addStream:(d,p,_)=>f(p,async(E,x)=>{_&&await T(_,E),x.addStream(d)}),removeStream:(d,p)=>f(p,(_,E)=>E.removeStream(d)),addTrack:(d,p,_,E)=>f(_,async(x,b)=>{E&&await C(E,x),b.addTrack(d,p)}),removeTrack:(d,p)=>f(p,(_,E)=>E.removeTrack(d)),replaceTrack:(d,p,_,E)=>f(_,async(x,b)=>{E&&await C(E,x),b.replaceTrack(d,p)}),onPeerJoin:d=>l.onPeerJoin=d,onPeerLeave:d=>l.onPeerLeave=d,onPeerStream:d=>l.onPeerStream=d,onPeerTrack:d=>l.onPeerTrack=d}},Rs=20,Is=5333,Xt=57333,Us=({init:e,subscribe:t,announce:n})=>{const r={};let s=!1,a,c,u,i;return(v,l,f)=>{const{appId:o}=v;if(r[o]?.[l])return r[o][l];const h={},m={},S=Ie(Ne,o,l),y=Be(S),w=Be(Ie(S,pe)),L=Es(v.password||"",o,l),N=b=>async A=>({type:A.type,sdp:await b(L,A.sdp)}),k=N(Cs),X=N(Ps),T=()=>Yt(!0,v),P=(b,A,R)=>{if(m[A]){m[A]!==b&&b.destroy();return}m[A]=b,x(b,A),h[A]?.forEach((q,H)=>{H!==R&&q.destroy()}),delete h[A]},C=(b,A)=>{m[A]===b&&delete m[A]},I=(b,A)=>{if(m[b])return;const R=h[b]?.[A];R&&(delete h[b][A],R.destroy())},M=b=>(c.push(...Oe(b,T)),ue(c.splice(0,b).map(A=>A.offerPromise.then(X).then(R=>({peer:A,offer:R}))))),D=(b,A)=>f?.({error:`incorrect password (${v.password}) when decrypting ${A}`,appId:o,peerId:b,roomId:l}),d=b=>async(A,R,q)=>{const[H,Q]=await ue([y,w]);if(A!==H&&A!==Q)return;const{peerId:O,offer:Y,answer:J,peer:B}=typeof R=="string"?ze(R):R;if(!(O===pe||m[O])){if(O&&!Y&&!J){if(h[O]?.[b])return;const[[{peer:$,offer:V}],Z]=await ue([M(1),Be(Ie(S,O))]);h[O]||=[],h[O][b]=$,setTimeout(()=>I(O,b),p[b]*.9),$.setHandlers({connect:()=>P($,O,b),close:()=>C($,O)}),q(Z,ce({peerId:pe,offer:V}))}else if(Y){if(h[O]?.[b]&&pe>O)return;const V=Yt(!1,v);V.setHandlers({connect:()=>P(V,O,b),close:()=>C(V,O)});let Z;try{Z=await k(Y)}catch{D(O,"offer");return}if(V.isDead)return;const[ee,te]=await ue([Be(Ie(S,O)),V.signal(Z)]);q(ee,ce({peerId:pe,answer:await X(te)}))}else if(J){let $;try{$=await k(J)}catch{D(O,"answer");return}if(B)B.setHandlers({connect:()=>P(B,O,b),close:()=>C(B,O)}),B.signal($);else{const V=h[O]?.[b];V&&!V.isDead&&V.signal($)}}}};if(!v)throw ae("requires a config map as the first argument");if(!o&&!v.firebaseApp)throw ae("config map is missing appId field");if(!l)throw ae("roomId argument required");if(!s){const b=e(v);c=Oe(Rs,T),a=Array.isArray(b)?b:[b],s=!0,u=setInterval(()=>c=c.filter(A=>{const R=Date.now()-A.created<Xt;return R||A.destroy(),R}),Xt*1.03),i=v.manualRelayReconnection?se:As()}const p=a.map(()=>Is),_=[],E=a.map(async(b,A)=>t(await b,await y,await w,d(A),M));ue([y,w]).then(([b,A])=>{const R=async(q,H)=>{const Q=await n(q,b,A);typeof Q=="number"&&(p[H]=Q),_[H]=setTimeout(()=>R(q,H),p[H])};E.forEach(async(q,H)=>{await q,R(await a[H],H)})});let x=se;return r[o]||={},r[o][l]=Ms(b=>x=b,b=>delete m[b],()=>{delete r[o][l],_.forEach(clearTimeout),E.forEach(async b=>(await b)()),clearInterval(u),i(),s=!1})}},Bs=5,Zn="x",Xn="EVENT",{secretKey:Ds,publicKey:Hs}=Un.keygen(),$s=yt(Hs),kt={},Ae={},Vs={},qn=()=>Math.floor(Date.now()/1e3),Fn=e=>Vs[e]??=Hn(e,1e4)+2e4,qt=async(e,t)=>{const n={kind:Fn(e),tags:[[Zn,e]],created_at:qn(),content:t,pubkey:$s},r=await $n("SHA-256",ce([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]));return ce([Xn,{...n,id:yt(r),sig:yt(await Un.signAsync(r,Ds))}])},Ft=(e,t)=>(kt[e]=t,ce(["REQ",e,{kinds:[Fn(t)],since:qn(),["#"+Zn]:[t]}])),Gt=e=>(delete kt[e],ce(["CLOSE",e])),Qs=Us({init:e=>bs(e,Ks,Bs).map(t=>{const n=_s(t,r=>{const[s,a,c,u]=ze(r);if(s!==Xn){const i=`${Ne}: relay failure from ${n.url} - `;s==="NOTICE"?console.warn(i+a):s==="OK"&&!c&&console.warn(i+u);return}Ae[a]?.(kt[a],c.content)});return n.ready}),subscribe:(e,t,n,r)=>{const s=ht(64),a=ht(64);return Ae[s]=Ae[a]=(c,u)=>r(c,u,async(i,v)=>e.send(await qt(i,v))),e.send(Ft(s,t)),e.send(Ft(a,n)),()=>{e.send(Gt(s)),e.send(Gt(a)),delete Ae[s],delete Ae[a]}},announce:async(e,t)=>e.send(await qt(t,ce({peerId:pe})))}),Ks=["black.nostrcity.club","ftp.halifax.rwth-aachen.de/nostr","nos.lol","nostr.cool110.xyz","nostr.data.haus","nostr.sathoarder.com","nostr.vulpem.com","relay.agorist.space","relay.binaryrobot.com","relay.damus.io","relay.fountain.fm","relay.mostro.network","relay.nostraddress.com","relay.nostrdice.com","relay.nostromo.social","relay.oldenburg.cool","relay.verified-nostr.com","yabu.me/v2"].map(e=>"wss://"+e);export{pe as a,zs as b,Fe as c,He as d,Fs as e,js as f,Hr as g,Gs as h,qs as i,Qs as j,Ws as k,Xs as l,Js as m,$r as r,Dr as s};
