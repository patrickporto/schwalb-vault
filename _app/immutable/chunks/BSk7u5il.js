import{aL as Ai,am as yc,v as Ci,ak as Ii,h as Di,ar as Xe,aM as bc}from"./CxNW0ivl.js";import{p as It,w as Nt,g as Kt}from"./CKry8u68.js";import{_ as Ps}from"./tmbrGeNw.js";function sf(e,t,n=t){var r=new WeakSet;Ai(e,"input",async s=>{var o=s?e.defaultValue:e.value;if(o=Dr(e)?Tr(o):o,n(o),Xe!==null&&r.add(Xe),await yc(),o!==(o=t())){var l=e.selectionStart,f=e.selectionEnd,d=e.value.length;if(e.value=o??"",f!==null){var g=e.value.length;l===f&&f===d&&g>d?(e.selectionStart=g,e.selectionEnd=g):(e.selectionStart=l,e.selectionEnd=Math.min(f,g))}}}),(Di&&e.defaultValue!==e.value||Ci(t)==null&&e.value)&&(n(Dr(e)?Tr(e.value):e.value),Xe!==null&&r.add(Xe)),Ii(()=>{var s=t();if(e===document.activeElement){var o=bc??Xe;if(r.has(o))return}Dr(e)&&s===Tr(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function of(e,t,n=t){Ai(e,"change",r=>{var s=r?e.defaultChecked:e.checked;n(s)}),(Di&&e.defaultChecked!==e.checked||Ci(t)==null)&&n(e.checked),Ii(()=>{var r=t();e.checked=!!r})}function Dr(e){var t=e.type;return t==="number"||t==="range"}function Tr(e){return e===""?null:+e}const Vs=globalThis||void 0||self,ft=()=>new Map,Gr=e=>{const t=ft();return e.forEach((n,r)=>{t.set(r,n)}),t},Gt=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},kc=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},Ec=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},ue=()=>new Set,Br=e=>e[e.length-1],_c=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Qt=Array.from,us=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},Ti=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},Sc=(e,t)=>{const n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n},ur=Array.isArray;class xc{constructor(){this._observers=ft()}on(t,n){return Gt(this._observers,t,ue).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Qt((this._observers.get(t)||ft()).values()).forEach(r=>r(...n))}destroy(){this._observers=ft()}}class Ac{constructor(){this._observers=ft()}on(t,n){Gt(this._observers,t,ue).add(n)}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Qt((this._observers.get(t)||ft()).values()).forEach(r=>r(...n))}destroy(){this._observers=ft()}}const vt=Math.floor,Pn=Math.abs,Bi=(e,t)=>e<t?e:t,pe=(e,t)=>e>t?e:t,Ui=e=>e!==0?e<0:1/e<0,js=1,Hs=2,Ur=4,Lr=8,an=32,qt=64,mt=128,hr=31,Jr=63,ae=127,Cc=2147483647,Xn=Number.MAX_SAFE_INTEGER,qs=Number.MIN_SAFE_INTEGER,Ic=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&vt(e)===e),Dc=String.fromCharCode,Tc=e=>e.toLowerCase(),Bc=/^\s*/g,Uc=e=>e.replace(Bc,""),Lc=/([A-Z])/g,Gs=(e,t)=>Uc(e.replace(Lc,n=>`${t}${Tc(n)}`)),Mc=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},un=typeof TextEncoder<"u"?new TextEncoder:null,Rc=e=>un.encode(e),vc=un?Rc:Mc;let cn=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});cn&&cn.decode(new Uint8Array).length===1&&(cn=null);const Oc=(e,t)=>Sc(t,()=>e).join("");class Sn{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const fr=()=>new Sn,Fc=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Rt=e=>{const t=new Uint8Array(Fc(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Nc=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(pe(n,t)*2),e.cpos=0)},nt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},zr=nt,O=(e,t)=>{for(;t>ae;)nt(e,mt|ae&t),t=vt(t/128);nt(e,ae&t)},hs=(e,t)=>{const n=Ui(t);for(n&&(t=-t),nt(e,(t>Jr?mt:0)|(n?qt:0)|Jr&t),t=vt(t/64);t>0;)nt(e,(t>ae?mt:0)|ae&t),t=vt(t/128)},Wr=new Uint8Array(3e4),$c=Wr.length/3,Pc=(e,t)=>{if(t.length<$c){const n=un.encodeInto(t,Wr).written||0;O(e,n);for(let r=0;r<n;r++)nt(e,Wr[r])}else pt(e,vc(t))},Vc=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;O(e,r);for(let s=0;s<r;s++)nt(e,n.codePointAt(s))},Ce=un&&un.encodeInto?Pc:Vc,dr=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Bi(n-r,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(pe(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},pt=(e,t)=>{O(e,t.byteLength),dr(e,t)},fs=(e,t)=>{Nc(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},jc=(e,t)=>fs(e,4).setFloat32(0,t,!1),Hc=(e,t)=>fs(e,8).setFloat64(0,t,!1),qc=(e,t)=>fs(e,8).setBigInt64(0,t,!1),Js=new DataView(new ArrayBuffer(4)),Gc=e=>(Js.setFloat32(0,e),Js.getFloat32(0)===e),hn=(e,t)=>{switch(typeof t){case"string":nt(e,119),Ce(e,t);break;case"number":Ic(t)&&Pn(t)<=Cc?(nt(e,125),hs(e,t)):Gc(t)?(nt(e,124),jc(e,t)):(nt(e,123),Hc(e,t));break;case"bigint":nt(e,122),qc(e,t);break;case"object":if(t===null)nt(e,126);else if(ur(t)){nt(e,117),O(e,t.length);for(let n=0;n<t.length;n++)hn(e,t[n])}else if(t instanceof Uint8Array)nt(e,116),pt(e,t);else{nt(e,118);const n=Object.keys(t);O(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];Ce(e,s),hn(e,t[s])}}break;case"boolean":nt(e,t?120:121);break;default:nt(e,127)}};class zs extends Sn{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&O(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Ws=e=>{e.count>0&&(hs(e.encoder,e.count===1?e.s:-e.s),e.count>1&&O(e.encoder,e.count-2))};class Vn{constructor(){this.encoder=new Sn,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ws(this),this.count=1,this.s=t)}toUint8Array(){return Ws(this),Rt(this.encoder)}}const Ys=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);hs(e.encoder,t),e.count>1&&O(e.encoder,e.count-2)}};class Mr{constructor(){this.encoder=new Sn,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Ys(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Ys(this),Rt(this.encoder)}}class Jc{constructor(){this.sarr=[],this.s="",this.lensE=new Vn}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Sn;return this.sarr.push(this.s),this.s="",Ce(t,this.sarr.join("")),dr(t,this.lensE.toUint8Array()),Rt(t)}}const Ct=e=>new Error(e),At=()=>{throw Ct("Method unimplemented")},_t=()=>{throw Ct("Unexpected case")},Li=Ct("Unexpected end of array"),Mi=Ct("Integer out of Range");class pr{constructor(t){this.arr=t,this.pos=0}}const Ve=e=>new pr(e),zc=e=>e.pos!==e.arr.length,Wc=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},gt=e=>Wc(e,B(e)),Re=e=>e.arr[e.pos++],B=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&ae)*n,n*=128,s<mt)return t;if(t>Xn)throw Mi}throw Li},ds=e=>{let t=e.arr[e.pos++],n=t&Jr,r=64;const s=(t&qt)>0?-1:1;if((t&mt)===0)return s*n;const o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&ae)*r,r*=128,t<mt)return s*n;if(n>Xn)throw Mi}throw Li},Yc=e=>{let t=B(e);if(t===0)return"";{let n=String.fromCodePoint(Re(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Re(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Kc=e=>cn.decode(gt(e)),Ie=cn?Kc:Yc,ps=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Xc=e=>ps(e,4).getFloat32(0,!1),Zc=e=>ps(e,8).getFloat64(0,!1),Qc=e=>ps(e,8).getBigInt64(0,!1),tl=[e=>{},e=>null,ds,Xc,Zc,Qc,e=>!1,e=>!0,Ie,e=>{const t=B(e),n={};for(let r=0;r<t;r++){const s=Ie(e);n[s]=fn(e)}return n},e=>{const t=B(e),n=[];for(let r=0;r<t;r++)n.push(fn(e));return n},gt],fn=e=>tl[127-Re(e)](e);class Ks extends pr{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),zc(this)?this.count=B(this)+1:this.count=-1),this.count--,this.s}}class jn extends pr{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=ds(this);const t=Ui(this.s);this.count=1,t&&(this.s=-this.s,this.count=B(this)+2)}return this.count--,this.s}}class Rr extends pr{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=ds(this),n=t&1;this.diff=vt(t/2),this.count=1,n&&(this.count=B(this)+2)}return this.s+=this.diff,this.count--,this.s}}class el{constructor(t){this.decoder=new jn(t),this.str=Ie(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const nl=crypto.getRandomValues.bind(crypto),Ri=()=>nl(new Uint32Array(1))[0],rl="10000000-1000-4000-8000"+-1e11,sl=()=>rl.replace(/[018]/g,e=>(e^Ri()&15>>e/4).toString(16)),ve=e=>new Promise(e);Promise.all.bind(Promise);var il={},gr={};gr.byteLength=ll;gr.toByteArray=ul;gr.fromByteArray=dl;var Mt=[],yt=[],ol=typeof Uint8Array<"u"?Uint8Array:Array,vr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ee=0,cl=vr.length;Ee<cl;++Ee)Mt[Ee]=vr[Ee],yt[vr.charCodeAt(Ee)]=Ee;yt[45]=62;yt[95]=63;function vi(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function ll(e){var t=vi(e),n=t[0],r=t[1];return(n+r)*3/4-r}function al(e,t,n){return(t+n)*3/4-n}function ul(e){var t,n=vi(e),r=n[0],s=n[1],o=new ol(al(e,r,s)),l=0,f=s>0?r-4:r,d;for(d=0;d<f;d+=4)t=yt[e.charCodeAt(d)]<<18|yt[e.charCodeAt(d+1)]<<12|yt[e.charCodeAt(d+2)]<<6|yt[e.charCodeAt(d+3)],o[l++]=t>>16&255,o[l++]=t>>8&255,o[l++]=t&255;return s===2&&(t=yt[e.charCodeAt(d)]<<2|yt[e.charCodeAt(d+1)]>>4,o[l++]=t&255),s===1&&(t=yt[e.charCodeAt(d)]<<10|yt[e.charCodeAt(d+1)]<<4|yt[e.charCodeAt(d+2)]>>2,o[l++]=t>>8&255,o[l++]=t&255),o}function hl(e){return Mt[e>>18&63]+Mt[e>>12&63]+Mt[e>>6&63]+Mt[e&63]}function fl(e,t,n){for(var r,s=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(e[o+2]&255),s.push(hl(r));return s.join("")}function dl(e){for(var t,n=e.length,r=n%3,s=[],o=16383,l=0,f=n-r;l<f;l+=o)s.push(fl(e,l,l+o>f?f:l+o));return r===1?(t=e[n-1],s.push(Mt[t>>2]+Mt[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],s.push(Mt[t>>10]+Mt[t>>4&63]+Mt[t<<2&63]+"=")),s.join("")}var gs={};gs.read=function(e,t,n,r,s){var o,l,f=s*8-r-1,d=(1<<f)-1,g=d>>1,u=-7,p=n?s-1:0,w=n?-1:1,b=e[t+p];for(p+=w,o=b&(1<<-u)-1,b>>=-u,u+=f;u>0;o=o*256+e[t+p],p+=w,u-=8);for(l=o&(1<<-u)-1,o>>=-u,u+=r;u>0;l=l*256+e[t+p],p+=w,u-=8);if(o===0)o=1-g;else{if(o===d)return l?NaN:(b?-1:1)*(1/0);l=l+Math.pow(2,r),o=o-g}return(b?-1:1)*l*Math.pow(2,o-r)};gs.write=function(e,t,n,r,s,o){var l,f,d,g=o*8-s-1,u=(1<<g)-1,p=u>>1,w=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=r?0:o-1,E=r?1:-1,S=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,l=u):(l=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-l))<1&&(l--,d*=2),l+p>=1?t+=w/d:t+=w*Math.pow(2,1-p),t*d>=2&&(l++,d/=2),l+p>=u?(f=0,l=u):l+p>=1?(f=(t*d-1)*Math.pow(2,s),l=l+p):(f=t*Math.pow(2,p-1)*Math.pow(2,s),l=0));s>=8;e[n+b]=f&255,b+=E,f/=256,s-=8);for(l=l<<s|f,g+=s;g>0;e[n+b]=l&255,b+=E,l/=256,g-=8);e[n+b-E]|=S*128};(function(e){const t=gr,n=gs,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=we,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s;const{Uint8Array:o,ArrayBuffer:l,SharedArrayBuffer:f}=globalThis;u.TYPED_ARRAY_SUPPORT=d(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{const a=new o(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,o.prototype),Object.setPrototypeOf(a,i),a.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function g(a){if(a>s)throw new RangeError('The value "'+a+'" is invalid for option "size"');const i=new o(a);return Object.setPrototypeOf(i,u.prototype),i}function u(a,i,c){if(typeof a=="number"){if(typeof i=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(a)}return p(a,i,c)}u.poolSize=8192;function p(a,i,c){if(typeof a=="string")return S(a,i);if(l.isView(a))return I(a);if(a==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(Dt(a,l)||a&&Dt(a.buffer,l)||typeof f<"u"&&(Dt(a,f)||a&&Dt(a.buffer,f)))return P(a,i,c);if(typeof a=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const h=a.valueOf&&a.valueOf();if(h!=null&&h!==a)return u.from(h,i,c);const m=it(a);if(m)return m;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof a[Symbol.toPrimitive]=="function")return u.from(a[Symbol.toPrimitive]("string"),i,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}u.from=function(a,i,c){return p(a,i,c)},Object.setPrototypeOf(u.prototype,o.prototype),Object.setPrototypeOf(u,o);function w(a){if(typeof a!="number")throw new TypeError('"size" argument must be of type number');if(a<0)throw new RangeError('The value "'+a+'" is invalid for option "size"')}function b(a,i,c){return w(a),a<=0?g(a):i!==void 0?typeof c=="string"?g(a).fill(i,c):g(a).fill(i):g(a)}u.alloc=function(a,i,c){return b(a,i,c)};function E(a){return w(a),g(a<0?0:St(a)|0)}u.allocUnsafe=function(a){return E(a)},u.allocUnsafeSlow=function(a){return E(a)};function S(a,i){if((typeof i!="string"||i==="")&&(i="utf8"),!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i);const c=ee(a,i)|0;let h=g(c);const m=h.write(a,i);return m!==c&&(h=h.slice(0,m)),h}function L(a){const i=a.length<0?0:St(a.length)|0,c=g(i);for(let h=0;h<i;h+=1)c[h]=a[h]&255;return c}function I(a){if(Dt(a,o)){const i=new o(a);return P(i.buffer,i.byteOffset,i.byteLength)}return L(a)}function P(a,i,c){if(i<0||a.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<i+(c||0))throw new RangeError('"length" is outside of buffer bounds');let h;return i===void 0&&c===void 0?h=new o(a):c===void 0?h=new o(a,i):h=new o(a,i,c),Object.setPrototypeOf(h,u.prototype),h}function it(a){if(u.isBuffer(a)){const i=St(a.length)|0,c=g(i);return c.length===0||a.copy(c,0,0,i),c}if(a.length!==void 0)return typeof a.length!="number"||Ir(a.length)?g(0):L(a);if(a.type==="Buffer"&&Array.isArray(a.data))return L(a.data)}function St(a){if(a>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return a|0}function we(a){return+a!=a&&(a=0),u.alloc(+a)}u.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==u.prototype},u.compare=function(i,c){if(Dt(i,o)&&(i=u.from(i,i.offset,i.byteLength)),Dt(c,o)&&(c=u.from(c,c.offset,c.byteLength)),!u.isBuffer(i)||!u.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===c)return 0;let h=i.length,m=c.length;for(let y=0,k=Math.min(h,m);y<k;++y)if(i[y]!==c[y]){h=i[y],m=c[y];break}return h<m?-1:m<h?1:0},u.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(i,c){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return u.alloc(0);let h;if(c===void 0)for(c=0,h=0;h<i.length;++h)c+=i[h].length;const m=u.allocUnsafe(c);let y=0;for(h=0;h<i.length;++h){let k=i[h];if(Dt(k,o))y+k.length>m.length?(u.isBuffer(k)||(k=u.from(k)),k.copy(m,y)):o.prototype.set.call(m,k,y);else if(u.isBuffer(k))k.copy(m,y);else throw new TypeError('"list" argument must be an Array of Buffers');y+=k.length}return m};function ee(a,i){if(u.isBuffer(a))return a.length;if(l.isView(a)||Dt(a,l))return a.byteLength;if(typeof a!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);const c=a.length,h=arguments.length>2&&arguments[2]===!0;if(!h&&c===0)return 0;let m=!1;for(;;)switch(i){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return Cr(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return $s(a).length;default:if(m)return h?-1:Cr(a).length;i=(""+i).toLowerCase(),m=!0}}u.byteLength=ee;function ne(a,i,c){let h=!1;if((i===void 0||i<0)&&(i=0),i>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,i>>>=0,c<=i))return"";for(a||(a="utf8");;)switch(a){case"hex":return xt(this,i,c);case"utf8":case"utf-8":return A(this,i,c);case"ascii":return ct(this,i,c);case"latin1":case"binary":return tt(this,i,c);case"base64":return V(this,i,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,i,c);default:if(h)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),h=!0}}u.prototype._isBuffer=!0;function ht(a,i,c){const h=a[i];a[i]=a[c],a[c]=h}u.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<i;c+=2)ht(this,c,c+1);return this},u.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<i;c+=4)ht(this,c,c+3),ht(this,c+1,c+2);return this},u.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<i;c+=8)ht(this,c,c+7),ht(this,c+1,c+6),ht(this,c+2,c+5),ht(this,c+3,c+4);return this},u.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?A(this,0,i):ne.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(i){if(!u.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:u.compare(this,i)===0},u.prototype.inspect=function(){let i="";const c=e.INSPECT_MAX_BYTES;return i=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(i+=" ... "),"<Buffer "+i+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(i,c,h,m,y){if(Dt(i,o)&&(i=u.from(i,i.offset,i.byteLength)),!u.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(c===void 0&&(c=0),h===void 0&&(h=i?i.length:0),m===void 0&&(m=0),y===void 0&&(y=this.length),c<0||h>i.length||m<0||y>this.length)throw new RangeError("out of range index");if(m>=y&&c>=h)return 0;if(m>=y)return-1;if(c>=h)return 1;if(c>>>=0,h>>>=0,m>>>=0,y>>>=0,this===i)return 0;let k=y-m,U=h-c;const J=Math.min(k,U),H=this.slice(m,y),z=i.slice(c,h);for(let N=0;N<J;++N)if(H[N]!==z[N]){k=H[N],U=z[N];break}return k<U?-1:U<k?1:0};function ye(a,i,c,h,m){if(a.length===0)return-1;if(typeof c=="string"?(h=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Ir(c)&&(c=m?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(m)return-1;c=a.length-1}else if(c<0)if(m)c=0;else return-1;if(typeof i=="string"&&(i=u.from(i,h)),u.isBuffer(i))return i.length===0?-1:re(a,i,c,h,m);if(typeof i=="number")return i=i&255,typeof o.prototype.indexOf=="function"?m?o.prototype.indexOf.call(a,i,c):o.prototype.lastIndexOf.call(a,i,c):re(a,[i],c,h,m);throw new TypeError("val must be string, number or Buffer")}function re(a,i,c,h,m){let y=1,k=a.length,U=i.length;if(h!==void 0&&(h=String(h).toLowerCase(),h==="ucs2"||h==="ucs-2"||h==="utf16le"||h==="utf-16le")){if(a.length<2||i.length<2)return-1;y=2,k/=2,U/=2,c/=2}function J(z,N){return y===1?z[N]:z.readUInt16BE(N*y)}let H;if(m){let z=-1;for(H=c;H<k;H++)if(J(a,H)===J(i,z===-1?0:H-z)){if(z===-1&&(z=H),H-z+1===U)return z*y}else z!==-1&&(H-=H-z),z=-1}else for(c+U>k&&(c=k-U),H=c;H>=0;H--){let z=!0;for(let N=0;N<U;N++)if(J(a,H+N)!==J(i,N)){z=!1;break}if(z)return H}return-1}u.prototype.includes=function(i,c,h){return this.indexOf(i,c,h)!==-1},u.prototype.indexOf=function(i,c,h){return ye(this,i,c,h,!0)},u.prototype.lastIndexOf=function(i,c,h){return ye(this,i,c,h,!1)};function be(a,i,c,h){c=Number(c)||0;const m=a.length-c;h?(h=Number(h),h>m&&(h=m)):h=m;const y=i.length;h>y/2&&(h=y/2);let k;for(k=0;k<h;++k){const U=parseInt(i.substr(k*2,2),16);if(Ir(U))return k;a[c+k]=U}return k}function _(a,i,c,h){return Un(Cr(i,a.length-c),a,c,h)}function x(a,i,c,h){return Un(pc(i),a,c,h)}function T(a,i,c,h){return Un($s(i),a,c,h)}function R(a,i,c,h){return Un(gc(i,a.length-c),a,c,h)}u.prototype.write=function(i,c,h,m){if(c===void 0)m="utf8",h=this.length,c=0;else if(h===void 0&&typeof c=="string")m=c,h=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(h)?(h=h>>>0,m===void 0&&(m="utf8")):(m=h,h=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const y=this.length-c;if((h===void 0||h>y)&&(h=y),i.length>0&&(h<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");m||(m="utf8");let k=!1;for(;;)switch(m){case"hex":return be(this,i,c,h);case"utf8":case"utf-8":return _(this,i,c,h);case"ascii":case"latin1":case"binary":return x(this,i,c,h);case"base64":return T(this,i,c,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,i,c,h);default:if(k)throw new TypeError("Unknown encoding: "+m);m=(""+m).toLowerCase(),k=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(a,i,c){return i===0&&c===a.length?t.fromByteArray(a):t.fromByteArray(a.slice(i,c))}function A(a,i,c){c=Math.min(a.length,c);const h=[];let m=i;for(;m<c;){const y=a[m];let k=null,U=y>239?4:y>223?3:y>191?2:1;if(m+U<=c){let J,H,z,N;switch(U){case 1:y<128&&(k=y);break;case 2:J=a[m+1],(J&192)===128&&(N=(y&31)<<6|J&63,N>127&&(k=N));break;case 3:J=a[m+1],H=a[m+2],(J&192)===128&&(H&192)===128&&(N=(y&15)<<12|(J&63)<<6|H&63,N>2047&&(N<55296||N>57343)&&(k=N));break;case 4:J=a[m+1],H=a[m+2],z=a[m+3],(J&192)===128&&(H&192)===128&&(z&192)===128&&(N=(y&15)<<18|(J&63)<<12|(H&63)<<6|z&63,N>65535&&N<1114112&&(k=N))}}k===null?(k=65533,U=1):k>65535&&(k-=65536,h.push(k>>>10&1023|55296),k=56320|k&1023),h.push(k),m+=U}return q(h)}const C=4096;function q(a){const i=a.length;if(i<=C)return String.fromCharCode.apply(String,a);let c="",h=0;for(;h<i;)c+=String.fromCharCode.apply(String,a.slice(h,h+=C));return c}function ct(a,i,c){let h="";c=Math.min(a.length,c);for(let m=i;m<c;++m)h+=String.fromCharCode(a[m]&127);return h}function tt(a,i,c){let h="";c=Math.min(a.length,c);for(let m=i;m<c;++m)h+=String.fromCharCode(a[m]);return h}function xt(a,i,c){const h=a.length;(!i||i<0)&&(i=0),(!c||c<0||c>h)&&(c=h);let m="";for(let y=i;y<c;++y)m+=mc[a[y]];return m}function F(a,i,c){const h=a.slice(i,c);let m="";for(let y=0;y<h.length-1;y+=2)m+=String.fromCharCode(h[y]+h[y+1]*256);return m}u.prototype.slice=function(i,c){const h=this.length;i=~~i,c=c===void 0?h:~~c,i<0?(i+=h,i<0&&(i=0)):i>h&&(i=h),c<0?(c+=h,c<0&&(c=0)):c>h&&(c=h),c<i&&(c=i);const m=this.subarray(i,c);return Object.setPrototypeOf(m,u.prototype),m};function v(a,i,c){if(a%1!==0||a<0)throw new RangeError("offset is not uint");if(a+i>c)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(i,c,h){i=i>>>0,c=c>>>0,h||v(i,c,this.length);let m=this[i],y=1,k=0;for(;++k<c&&(y*=256);)m+=this[i+k]*y;return m},u.prototype.readUintBE=u.prototype.readUIntBE=function(i,c,h){i=i>>>0,c=c>>>0,h||v(i,c,this.length);let m=this[i+--c],y=1;for(;c>0&&(y*=256);)m+=this[i+--c]*y;return m},u.prototype.readUint8=u.prototype.readUInt8=function(i,c){return i=i>>>0,c||v(i,1,this.length),this[i]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(i,c){return i=i>>>0,c||v(i,2,this.length),this[i]|this[i+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(i,c){return i=i>>>0,c||v(i,2,this.length),this[i]<<8|this[i+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(i,c){return i=i>>>0,c||v(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(i,c){return i=i>>>0,c||v(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},u.prototype.readBigUInt64LE=Yt(function(i){i=i>>>0,ke(i,"offset");const c=this[i],h=this[i+7];(c===void 0||h===void 0)&&Ke(i,this.length-8);const m=c+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,y=this[++i]+this[++i]*2**8+this[++i]*2**16+h*2**24;return BigInt(m)+(BigInt(y)<<BigInt(32))}),u.prototype.readBigUInt64BE=Yt(function(i){i=i>>>0,ke(i,"offset");const c=this[i],h=this[i+7];(c===void 0||h===void 0)&&Ke(i,this.length-8);const m=c*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],y=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+h;return(BigInt(m)<<BigInt(32))+BigInt(y)}),u.prototype.readIntLE=function(i,c,h){i=i>>>0,c=c>>>0,h||v(i,c,this.length);let m=this[i],y=1,k=0;for(;++k<c&&(y*=256);)m+=this[i+k]*y;return y*=128,m>=y&&(m-=Math.pow(2,8*c)),m},u.prototype.readIntBE=function(i,c,h){i=i>>>0,c=c>>>0,h||v(i,c,this.length);let m=c,y=1,k=this[i+--m];for(;m>0&&(y*=256);)k+=this[i+--m]*y;return y*=128,k>=y&&(k-=Math.pow(2,8*c)),k},u.prototype.readInt8=function(i,c){return i=i>>>0,c||v(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},u.prototype.readInt16LE=function(i,c){i=i>>>0,c||v(i,2,this.length);const h=this[i]|this[i+1]<<8;return h&32768?h|4294901760:h},u.prototype.readInt16BE=function(i,c){i=i>>>0,c||v(i,2,this.length);const h=this[i+1]|this[i]<<8;return h&32768?h|4294901760:h},u.prototype.readInt32LE=function(i,c){return i=i>>>0,c||v(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},u.prototype.readInt32BE=function(i,c){return i=i>>>0,c||v(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},u.prototype.readBigInt64LE=Yt(function(i){i=i>>>0,ke(i,"offset");const c=this[i],h=this[i+7];(c===void 0||h===void 0)&&Ke(i,this.length-8);const m=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(h<<24);return(BigInt(m)<<BigInt(32))+BigInt(c+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),u.prototype.readBigInt64BE=Yt(function(i){i=i>>>0,ke(i,"offset");const c=this[i],h=this[i+7];(c===void 0||h===void 0)&&Ke(i,this.length-8);const m=(c<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(m)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+h)}),u.prototype.readFloatLE=function(i,c){return i=i>>>0,c||v(i,4,this.length),n.read(this,i,!0,23,4)},u.prototype.readFloatBE=function(i,c){return i=i>>>0,c||v(i,4,this.length),n.read(this,i,!1,23,4)},u.prototype.readDoubleLE=function(i,c){return i=i>>>0,c||v(i,8,this.length),n.read(this,i,!0,52,8)},u.prototype.readDoubleBE=function(i,c){return i=i>>>0,c||v(i,8,this.length),n.read(this,i,!1,52,8)};function j(a,i,c,h,m,y){if(!u.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>m||i<y)throw new RangeError('"value" argument is out of bounds');if(c+h>a.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(i,c,h,m){if(i=+i,c=c>>>0,h=h>>>0,!m){const U=Math.pow(2,8*h)-1;j(this,i,c,h,U,0)}let y=1,k=0;for(this[c]=i&255;++k<h&&(y*=256);)this[c+k]=i/y&255;return c+h},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(i,c,h,m){if(i=+i,c=c>>>0,h=h>>>0,!m){const U=Math.pow(2,8*h)-1;j(this,i,c,h,U,0)}let y=h-1,k=1;for(this[c+y]=i&255;--y>=0&&(k*=256);)this[c+y]=i/k&255;return c+h},u.prototype.writeUint8=u.prototype.writeUInt8=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,1,255,0),this[c]=i&255,c+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,2,65535,0),this[c]=i&255,this[c+1]=i>>>8,c+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,2,65535,0),this[c]=i>>>8,this[c+1]=i&255,c+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,4,4294967295,0),this[c+3]=i>>>24,this[c+2]=i>>>16,this[c+1]=i>>>8,this[c]=i&255,c+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,4,4294967295,0),this[c]=i>>>24,this[c+1]=i>>>16,this[c+2]=i>>>8,this[c+3]=i&255,c+4};function G(a,i,c,h,m){Ns(i,h,m,a,c,7);let y=Number(i&BigInt(4294967295));a[c++]=y,y=y>>8,a[c++]=y,y=y>>8,a[c++]=y,y=y>>8,a[c++]=y;let k=Number(i>>BigInt(32)&BigInt(4294967295));return a[c++]=k,k=k>>8,a[c++]=k,k=k>>8,a[c++]=k,k=k>>8,a[c++]=k,c}function K(a,i,c,h,m){Ns(i,h,m,a,c,7);let y=Number(i&BigInt(4294967295));a[c+7]=y,y=y>>8,a[c+6]=y,y=y>>8,a[c+5]=y,y=y>>8,a[c+4]=y;let k=Number(i>>BigInt(32)&BigInt(4294967295));return a[c+3]=k,k=k>>8,a[c+2]=k,k=k>>8,a[c+1]=k,k=k>>8,a[c]=k,c+8}u.prototype.writeBigUInt64LE=Yt(function(i,c=0){return G(this,i,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Yt(function(i,c=0){return K(this,i,c,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(i,c,h,m){if(i=+i,c=c>>>0,!m){const J=Math.pow(2,8*h-1);j(this,i,c,h,J-1,-J)}let y=0,k=1,U=0;for(this[c]=i&255;++y<h&&(k*=256);)i<0&&U===0&&this[c+y-1]!==0&&(U=1),this[c+y]=(i/k>>0)-U&255;return c+h},u.prototype.writeIntBE=function(i,c,h,m){if(i=+i,c=c>>>0,!m){const J=Math.pow(2,8*h-1);j(this,i,c,h,J-1,-J)}let y=h-1,k=1,U=0;for(this[c+y]=i&255;--y>=0&&(k*=256);)i<0&&U===0&&this[c+y+1]!==0&&(U=1),this[c+y]=(i/k>>0)-U&255;return c+h},u.prototype.writeInt8=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,1,127,-128),i<0&&(i=255+i+1),this[c]=i&255,c+1},u.prototype.writeInt16LE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,2,32767,-32768),this[c]=i&255,this[c+1]=i>>>8,c+2},u.prototype.writeInt16BE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,2,32767,-32768),this[c]=i>>>8,this[c+1]=i&255,c+2},u.prototype.writeInt32LE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,4,2147483647,-2147483648),this[c]=i&255,this[c+1]=i>>>8,this[c+2]=i>>>16,this[c+3]=i>>>24,c+4},u.prototype.writeInt32BE=function(i,c,h){return i=+i,c=c>>>0,h||j(this,i,c,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[c]=i>>>24,this[c+1]=i>>>16,this[c+2]=i>>>8,this[c+3]=i&255,c+4},u.prototype.writeBigInt64LE=Yt(function(i,c=0){return G(this,i,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Yt(function(i,c=0){return K(this,i,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function X(a,i,c,h,m,y){if(c+h>a.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function et(a,i,c,h,m){return i=+i,c=c>>>0,m||X(a,i,c,4),n.write(a,i,c,h,23,4),c+4}u.prototype.writeFloatLE=function(i,c,h){return et(this,i,c,!0,h)},u.prototype.writeFloatBE=function(i,c,h){return et(this,i,c,!1,h)};function wt(a,i,c,h,m){return i=+i,c=c>>>0,m||X(a,i,c,8),n.write(a,i,c,h,52,8),c+8}u.prototype.writeDoubleLE=function(i,c,h){return wt(this,i,c,!0,h)},u.prototype.writeDoubleBE=function(i,c,h){return wt(this,i,c,!1,h)},u.prototype.copy=function(i,c,h,m){if(!u.isBuffer(i))throw new TypeError("argument should be a Buffer");if(h||(h=0),!m&&m!==0&&(m=this.length),c>=i.length&&(c=i.length),c||(c=0),m>0&&m<h&&(m=h),m===h||i.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(h<0||h>=this.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("sourceEnd out of bounds");m>this.length&&(m=this.length),i.length-c<m-h&&(m=i.length-c+h);const y=m-h;return this===i&&typeof o.prototype.copyWithin=="function"?this.copyWithin(c,h,m):o.prototype.set.call(i,this.subarray(h,m),c),y},u.prototype.fill=function(i,c,h,m){if(typeof i=="string"){if(typeof c=="string"?(m=c,c=0,h=this.length):typeof h=="string"&&(m=h,h=this.length),m!==void 0&&typeof m!="string")throw new TypeError("encoding must be a string");if(typeof m=="string"&&!u.isEncoding(m))throw new TypeError("Unknown encoding: "+m);if(i.length===1){const k=i.charCodeAt(0);(m==="utf8"&&k<128||m==="latin1")&&(i=k)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(c<0||this.length<c||this.length<h)throw new RangeError("Out of range index");if(h<=c)return this;c=c>>>0,h=h===void 0?this.length:h>>>0,i||(i=0);let y;if(typeof i=="number")for(y=c;y<h;++y)this[y]=i;else{const k=u.isBuffer(i)?i:u.from(i,m),U=k.length;if(U===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(y=0;y<h-c;++y)this[y+c]=k[y%U]}return this};const lt={};function dt(a,i,c){lt[a]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:i.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${a}]`,this.stack,delete this.name}get code(){return a}set code(m){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:m,writable:!0})}toString(){return`${this.name} [${a}]: ${this.message}`}}}dt("ERR_BUFFER_OUT_OF_BOUNDS",function(a){return a?`${a} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),dt("ERR_INVALID_ARG_TYPE",function(a,i){return`The "${a}" argument must be of type number. Received type ${typeof i}`},TypeError),dt("ERR_OUT_OF_RANGE",function(a,i,c){let h=`The value of "${a}" is out of range.`,m=c;return Number.isInteger(c)&&Math.abs(c)>2**32?m=Tn(String(c)):typeof c=="bigint"&&(m=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(m=Tn(m)),m+="n"),h+=` It must be ${i}. Received ${m}`,h},RangeError);function Tn(a){let i="",c=a.length;const h=a[0]==="-"?1:0;for(;c>=h+4;c-=3)i=`_${a.slice(c-3,c)}${i}`;return`${a.slice(0,c)}${i}`}function Bn(a,i,c){ke(i,"offset"),(a[i]===void 0||a[i+c]===void 0)&&Ke(i,a.length-(c+1))}function Ns(a,i,c,h,m,y){if(a>c||a<i){const k=typeof i=="bigint"?"n":"";let U;throw i===0||i===BigInt(0)?U=`>= 0${k} and < 2${k} ** ${(y+1)*8}${k}`:U=`>= -(2${k} ** ${(y+1)*8-1}${k}) and < 2 ** ${(y+1)*8-1}${k}`,new lt.ERR_OUT_OF_RANGE("value",U,a)}Bn(h,m,y)}function ke(a,i){if(typeof a!="number")throw new lt.ERR_INVALID_ARG_TYPE(i,"number",a)}function Ke(a,i,c){throw Math.floor(a)!==a?(ke(a,c),new lt.ERR_OUT_OF_RANGE("offset","an integer",a)):i<0?new lt.ERR_BUFFER_OUT_OF_BOUNDS:new lt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${i}`,a)}const fc=/[^+/0-9A-Za-z-_]/g;function dc(a){if(a=a.split("=")[0],a=a.trim().replace(fc,""),a.length<2)return"";for(;a.length%4!==0;)a=a+"=";return a}function Cr(a,i){i=i||1/0;let c;const h=a.length;let m=null;const y=[];for(let k=0;k<h;++k){if(c=a.charCodeAt(k),c>55295&&c<57344){if(!m){if(c>56319){(i-=3)>-1&&y.push(239,191,189);continue}else if(k+1===h){(i-=3)>-1&&y.push(239,191,189);continue}m=c;continue}if(c<56320){(i-=3)>-1&&y.push(239,191,189),m=c;continue}c=(m-55296<<10|c-56320)+65536}else m&&(i-=3)>-1&&y.push(239,191,189);if(m=null,c<128){if((i-=1)<0)break;y.push(c)}else if(c<2048){if((i-=2)<0)break;y.push(c>>6|192,c&63|128)}else if(c<65536){if((i-=3)<0)break;y.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((i-=4)<0)break;y.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return y}function pc(a){const i=[];for(let c=0;c<a.length;++c)i.push(a.charCodeAt(c)&255);return i}function gc(a,i){let c,h,m;const y=[];for(let k=0;k<a.length&&!((i-=2)<0);++k)c=a.charCodeAt(k),h=c>>8,m=c%256,y.push(m),y.push(h);return y}function $s(a){return t.toByteArray(dc(a))}function Un(a,i,c,h){let m;for(m=0;m<h&&!(m+c>=i.length||m>=a.length);++m)i[m+c]=a[m];return m}function Dt(a,i){return a instanceof i||a!=null&&a.constructor!=null&&a.constructor.name!=null&&a.constructor.name===i.name}function Ir(a){return a!==a}const mc=(function(){const a="0123456789abcdef",i=new Array(256);for(let c=0;c<16;++c){const h=c*16;for(let m=0;m<16;++m)i[h+m]=a[c]+a[m]}return i})();function Yt(a){return typeof BigInt>"u"?wc:a}function wc(){throw new Error("BigInt not supported")}})(il);function pl(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Oi={exports:{}},W=Oi.exports={},Ut,Lt;function Yr(){throw new Error("setTimeout has not been defined")}function Kr(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ut=setTimeout:Ut=Yr}catch{Ut=Yr}try{typeof clearTimeout=="function"?Lt=clearTimeout:Lt=Kr}catch{Lt=Kr}})();function Fi(e){if(Ut===setTimeout)return setTimeout(e,0);if((Ut===Yr||!Ut)&&setTimeout)return Ut=setTimeout,setTimeout(e,0);try{return Ut(e,0)}catch{try{return Ut.call(null,e,0)}catch{return Ut.call(this,e,0)}}}function gl(e){if(Lt===clearTimeout)return clearTimeout(e);if((Lt===Kr||!Lt)&&clearTimeout)return Lt=clearTimeout,clearTimeout(e);try{return Lt(e)}catch{try{return Lt.call(null,e)}catch{return Lt.call(this,e)}}}var Ht=[],De=!1,le,Hn=-1;function ml(){!De||!le||(De=!1,le.length?Ht=le.concat(Ht):Hn=-1,Ht.length&&Ni())}function Ni(){if(!De){var e=Fi(ml);De=!0;for(var t=Ht.length;t;){for(le=Ht,Ht=[];++Hn<t;)le&&le[Hn].run();Hn=-1,t=Ht.length}le=null,De=!1,gl(e)}}W.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Ht.push(new $i(e,t)),Ht.length===1&&!De&&Fi(Ni)};function $i(e,t){this.fun=e,this.array=t}$i.prototype.run=function(){this.fun.apply(null,this.array)};W.title="browser";W.browser=!0;W.env={};W.argv=[];W.version="";W.versions={};function Jt(){}W.on=Jt;W.addListener=Jt;W.once=Jt;W.off=Jt;W.removeListener=Jt;W.removeAllListeners=Jt;W.emit=Jt;W.prependListener=Jt;W.prependOnceListener=Jt;W.listeners=function(e){return[]};W.binding=function(e){throw new Error("process.binding is not supported")};W.cwd=function(){return"/"};W.chdir=function(e){throw new Error("process.chdir is not supported")};W.umask=function(){return 0};var wl=Oi.exports;const ie=pl(wl),Xs=e=>e===void 0?null:e;class yl{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Pi=new yl,bl=!0;try{typeof localStorage<"u"&&localStorage&&(Pi=localStorage,bl=!1)}catch{}const kl=Pi,dn=Symbol("Equality"),Vi=(e,t)=>e===t||!!e?.[dn]?.(t)||!1,El=e=>typeof e=="object",_l=Object.assign,Sl=Object.keys,xl=(e,t)=>{for(const n in e)t(e[n],n)},Zn=e=>Sl(e).length,Al=e=>{for(const t in e)return!1;return!0},xn=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},ms=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Cl=(e,t)=>e===t||Zn(e)===Zn(t)&&xn(e,(n,r)=>(n!==void 0||ms(t,r))&&Vi(t[r],n)),Il=Object.freeze,ji=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&ji(e[t])}return Il(e)},ws=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&ws(e,t,n+1)}},Dl=e=>e,qn=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(e[dn]!=null)return e[dn](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!qn(e.get(n),t.get(n)))return!1;break}case void 0:case Object:if(Zn(e)!==Zn(t))return!1;for(const n in e)if(!ms(e,n)||!qn(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!qn(e[n],t[n]))return!1;break;default:return!1}return!0},Tl=(e,t)=>t.includes(e);var Hi={};const pn=typeof ie<"u"&&ie.release&&/node|io\.js/.test(ie.release.name)&&Object.prototype.toString.call(typeof ie<"u"?ie:0)==="[object process]";let Tt;const Bl=()=>{if(Tt===void 0)if(pn){Tt=ft();const e=ie.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Tt.set(t,""),t=r):t!==null&&(Tt.set(t,r),t=null)}t!==null&&Tt.set(t,"")}else typeof location=="object"?(Tt=ft(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Tt.set(`--${Gs(t,"-")}`,n),Tt.set(`-${Gs(t,"-")}`,n)}})):Tt=ft();return Tt},Xr=e=>Bl().has(e),Qn=e=>Xs(pn?Hi[e.toUpperCase().replaceAll("-","_")]:kl.getItem(e)),qi=e=>Xr("--"+e)||Qn(e)!==null,Ul=qi("production"),Ll=pn&&Tl(Hi.FORCE_COLOR,["true","1","2"]),Ml=Ll||!Xr("--no-colors")&&!qi("no-color")&&(!pn||ie.stdout.isTTY)&&(!pn||Xr("--color")||Qn("COLORTERM")!==null||(Qn("TERM")||"").includes("color")),Rl=e=>new Uint8Array(e),vl=e=>{const t=Rl(e.byteLength);return t.set(e),t};class Ol{constructor(t,n){this.left=t,this.right=n}}const $t=(e,t)=>new Ol(e,t),Zs=e=>e.next()>=.5,Or=(e,t,n)=>vt(e.next()*(n+1-t)+t),Gi=(e,t,n)=>vt(e.next()*(n+1-t)+t),ys=(e,t,n)=>Gi(e,t,n),Fl=e=>Dc(ys(e,97,122)),Nl=(e,t=0,n=20)=>{const r=ys(e,t,n);let s="";for(let o=0;o<r;o++)s+=Fl(e);return s},Fr=(e,t)=>t[ys(e,0,t.length-1)],$l=Symbol("0schema");class Pl{constructor(){this._rerrs=[]}extend(t,n,r,s=null){this._rerrs.push({path:t,expected:n,has:r,message:s})}toString(){const t=[];for(let n=this._rerrs.length-1;n>0;n--){const r=this._rerrs[n];t.push(Oc(" ",(this._rerrs.length-n)*2)+`${r.path!=null?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return t.join(`
`)}}const Zr=(e,t)=>e===t?!0:e==null||t==null||e.constructor!==t.constructor?!1:e[dn]?Vi(e,t):ur(e)?us(e,n=>Ti(t,r=>Zr(n,r))):El(e)?xn(e,(n,r)=>Zr(n,t[r])):!1;class ut{static _dilutes=!1;extends(t){let[n,r]=[this.shape,t.shape];return this.constructor._dilutes&&([r,n]=[n,r]),Zr(n,r)}equals(t){return this.constructor===t.constructor&&qn(this.shape,t.shape)}[$l](){return!0}[dn](t){return this.equals(t)}validate(t){return this.check(t)}check(t,n){At()}get nullable(){return je(this,kr)}get optional(){return new Wi(this)}cast(t){return Qs(t,this),t}expect(t){return Qs(t,this),t}}class bs extends ut{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n=void 0){const r=t?.constructor===this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name,t?.constructor!==this.shape?"Constructor match failed":"Check failed"),r}}const Y=(e,t=null)=>new bs(e,t);Y(bs);class ks extends ut{constructor(t){super(),this.shape=t}check(t,n){const r=this.shape(t);return!r&&n?.extend(null,"custom prop",t?.constructor.name,"failed to check custom prop"),r}}const st=e=>new ks(e);Y(ks);class mr extends ut{constructor(t){super(),this.shape=t}check(t,n){const r=this.shape.some(s=>s===t);return!r&&n?.extend(null,this.shape.join(" | "),t.toString()),r}}const wr=(...e)=>new mr(e),Ji=Y(mr),Vl=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,t=>"\\"+t)),zi=e=>{if(Oe.check(e))return[Vl(e)];if(Ji.check(e))return e.shape.map(t=>t+"");if(ro.check(e))return["[+-]?\\d+.?\\d*"];if(so.check(e))return[".*"];if(tr.check(e))return e.shape.map(zi).flat(1);_t()};class jl extends ut{constructor(t){super(),this.shape=t,this._r=new RegExp("^"+t.map(zi).map(n=>`(${n.join("|")})`).join("")+"$")}check(t,n){const r=this._r.exec(t)!=null;return!r&&n?.extend(null,this._r.toString(),t.toString(),"String doesn't match string template."),r}}Y(jl);const Hl=Symbol("optional");class Wi extends ut{constructor(t){super(),this.shape=t}check(t,n){const r=t===void 0||this.shape.check(t);return!r&&n?.extend(null,"undefined (optional)","()"),r}get[Hl](){return!0}}const ql=Y(Wi);class Gl extends ut{check(t,n){return n?.extend(null,"never",typeof t),!1}}Y(Gl);class yr extends ut{constructor(t,n=!1){super(),this.shape=t,this._isPartial=n}static _dilutes=!0;get partial(){return new yr(this.shape,!0)}check(t,n){return t==null?(n?.extend(null,"object","null"),!1):xn(this.shape,(r,s)=>{const o=this._isPartial&&!ms(t,s)||r.check(t[s],n);return!o&&n?.extend(s.toString(),r.toString(),typeof t[s],"Object property does not match"),o})}}const Jl=e=>new yr(e),zl=Y(yr),Wl=st(e=>e!=null&&(e.constructor===Object||e.constructor==null));class Yi extends ut{constructor(t,n){super(),this.shape={keys:t,values:n}}check(t,n){return t!=null&&xn(t,(r,s)=>{const o=this.shape.keys.check(s,n);return!o&&n?.extend(s+"","Record",typeof t,o?"Key doesn't match schema":"Value doesn't match value"),o&&this.shape.values.check(r,n)})}}const Ki=(e,t)=>new Yi(e,t),Yl=Y(Yi);class Xi extends ut{constructor(t){super(),this.shape=t}check(t,n){return t!=null&&xn(this.shape,(r,s)=>{const o=r.check(t[s],n);return!o&&n?.extend(s.toString(),"Tuple",typeof r),o})}}const Kl=(...e)=>new Xi(e);Y(Xi);class Zi extends ut{constructor(t){super(),this.shape=t.length===1?t[0]:new Es(t)}check(t,n){const r=ur(t)&&us(t,s=>this.shape.check(s));return!r&&n?.extend(null,"Array",""),r}}const Qi=(...e)=>new Zi(e),Xl=Y(Zi),Zl=st(e=>ur(e));class to extends ut{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n){const r=t instanceof this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name),r}}const Ql=(e,t=null)=>new to(e,t);Y(to);const ta=Ql(ut);class ea extends ut{constructor(t){super(),this.len=t.length-1,this.args=Kl(...t.slice(-1)),this.res=t[this.len]}check(t,n){const r=t.constructor===Function&&t.length<=this.len;return!r&&n?.extend(null,"function",typeof t),r}}const na=Y(ea),ra=st(e=>typeof e=="function");class sa extends ut{constructor(t){super(),this.shape=t}check(t,n){const r=us(this.shape,s=>s.check(t,n));return!r&&n?.extend(null,"Intersectinon",typeof t),r}}Y(sa,e=>e.shape.length>0);class Es extends ut{static _dilutes=!0;constructor(t){super(),this.shape=t}check(t,n){const r=Ti(this.shape,s=>s.check(t,n));return n?.extend(null,"Union",typeof t),r}}const je=(...e)=>e.findIndex(t=>tr.check(t))>=0?je(...e.map(t=>gn(t)).map(t=>tr.check(t)?t.shape:[t]).flat(1)):e.length===1?e[0]:new Es(e),tr=Y(Es),eo=()=>!0,er=st(eo),ia=Y(ks,e=>e.shape===eo),_s=st(e=>typeof e=="bigint"),oa=st(e=>e===_s),no=st(e=>typeof e=="symbol");st(e=>e===no);const Te=st(e=>typeof e=="number"),ro=st(e=>e===Te),Oe=st(e=>typeof e=="string"),so=st(e=>e===Oe),br=st(e=>typeof e=="boolean"),ca=st(e=>e===br),io=wr(void 0);Y(mr,e=>e.shape.length===1&&e.shape[0]===void 0);wr(void 0);const kr=wr(null),la=Y(mr,e=>e.shape.length===1&&e.shape[0]===null);Y(Uint8Array);Y(bs,e=>e.shape===Uint8Array);const aa=je(Te,Oe,kr,io,_s,br,no);(()=>{const e=Qi(er),t=Ki(Oe,er),n=je(Te,Oe,kr,br,e,t);return e.shape=n,t.shape.values=n,n})();const gn=e=>{if(ta.check(e))return e;if(Wl.check(e)){const t={};for(const n in e)t[n]=gn(e[n]);return Jl(t)}else{if(Zl.check(e))return je(...e.map(gn));if(aa.check(e))return wr(e);if(ra.check(e))return Y(e)}_t()},Qs=Ul?()=>{}:(e,t)=>{const n=new Pl;if(!t.check(e,n))throw Ct(`Expected value to be of type ${t.constructor.name}.
${n.toString()}`)};class ua{constructor(t){this.patterns=[],this.$state=t}if(t,n){return this.patterns.push({if:gn(t),h:n}),this}else(t){return this.if(er,t)}done(){return(t,n)=>{for(let r=0;r<this.patterns.length;r++){const s=this.patterns[r];if(s.if.check(t))return s.h(t,n)}throw Ct("Unhandled pattern")}}}const ha=e=>new ua(e),oo=ha(er).if(ro,(e,t)=>Or(t,qs,Xn)).if(so,(e,t)=>Nl(t)).if(ca,(e,t)=>Zs(t)).if(oa,(e,t)=>BigInt(Or(t,qs,Xn))).if(tr,(e,t)=>_e(t,Fr(t,e.shape))).if(zl,(e,t)=>{const n={};for(const r in e.shape){let s=e.shape[r];if(ql.check(s)){if(Zs(t))continue;s=s.shape}n[r]=oo(s,t)}return n}).if(Xl,(e,t)=>{const n=[],r=Gi(t,0,42);for(let s=0;s<r;s++)n.push(_e(t,e.shape));return n}).if(Ji,(e,t)=>Fr(t,e.shape)).if(la,(e,t)=>null).if(na,(e,t)=>{const n=_e(t,e.res);return()=>n}).if(ia,(e,t)=>_e(t,Fr(t,[Te,Oe,kr,io,_s,br,Qi(Te),Ki(je("a","b","c"),Te)]))).if(Yl,(e,t)=>{const n={},r=Or(t,0,3);for(let s=0;s<r;s++){const o=_e(t,e.shape.keys),l=_e(t,e.shape.values);n[o]=l}return n}).done(),_e=(e,t)=>oo(gn(t),e),Er=typeof document<"u"?document:{};st(e=>e.nodeType===ma);typeof DOMParser<"u"&&new DOMParser;st(e=>e.nodeType===da);st(e=>e.nodeType===pa);const fa=e=>kc(e,(t,n)=>`${n}:${t};`).join(""),da=Er.ELEMENT_NODE,pa=Er.TEXT_NODE,ga=Er.DOCUMENT_NODE,ma=Er.DOCUMENT_FRAGMENT_NODE;st(e=>e.nodeType===ga);const zt=Symbol,co=zt(),lo=zt(),wa=zt(),ya=zt(),ba=zt(),ao=zt(),ka=zt(),Ss=zt(),Ea=zt(),_a=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},Sa={[co]:$t("font-weight","bold"),[lo]:$t("font-weight","normal"),[wa]:$t("color","blue"),[ba]:$t("color","green"),[ya]:$t("color","grey"),[ao]:$t("color","red"),[ka]:$t("color","purple"),[Ss]:$t("color","orange"),[Ea]:$t("color","black")},xa=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[],r=ft();let s=[],o=0;for(;o<e.length;o++){const l=e[o],f=Sa[l];if(f!==void 0)r.set(f.left,f.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const d=fa(r);o>0||d.length>0?(t.push("%c"+l),n.push(d)):t.push(l)}else break}}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){const l=e[o];l instanceof Symbol||s.push(l)}return s},uo=Ml?xa:_a,Aa=(...e)=>{console.log(...uo(e)),ho.forEach(t=>t.print(e))},Ca=(...e)=>{console.warn(...uo(e)),e.unshift(Ss),ho.forEach(t=>t.print(e))},ho=ue(),fo=e=>({[Symbol.iterator](){return this},next:e}),Ia=(e,t)=>fo(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Nr=(e,t)=>fo(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class xs{constructor(t,n){this.clock=t,this.len=n}}class An{constructor(){this.clients=new Map}}const po=(e,t,n)=>t.clients.forEach((r,s)=>{const o=e.doc.store.clients.get(s);if(o!=null){const l=o[o.length-1],f=l.id.clock+l.length;for(let d=0,g=r[d];d<r.length&&g.clock<f;g=r[++d])Ao(e,o,g.clock,g.len,n)}}),Da=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=vt((n+r)/2),o=e[s],l=o.clock;if(l<=t){if(t<l+o.len)return s;n=s+1}else r=s-1}return null},go=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Da(n,t.clock)!==null},As=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],o=t[n];s.clock+s.len>=o.clock?s.len=pe(s.len,o.clock+o.len-s.clock):(r<n&&(t[r]=o),r++)}t.length=r})},Ta=e=>{const t=new An;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const o=r.slice();for(let l=n+1;l<e.length;l++)_c(o,e[l].clients.get(s)||[]);t.clients.set(s,o)}});return As(t),t},nr=(e,t,n,r)=>{Gt(e.clients,t,()=>[]).push(new xs(n,r))},Ba=()=>new An,Ua=e=>{const t=Ba();return e.clients.forEach((n,r)=>{const s=[];for(let o=0;o<n.length;o++){const l=n[o];if(l.deleted){const f=l.id.clock;let d=l.length;if(o+1<n.length)for(let g=n[o+1];o+1<n.length&&g.deleted;g=n[++o+1])d+=g.length;s.push(new xs(f,d))}}s.length>0&&t.clients.set(r,s)}),t},He=(e,t)=>{O(e.restEncoder,t.clients.size),Qt(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),O(e.restEncoder,n);const s=r.length;O(e.restEncoder,s);for(let o=0;o<s;o++){const l=r[o];e.writeDsClock(l.clock),e.writeDsLen(l.len)}})},Cs=e=>{const t=new An,n=B(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=B(e.restDecoder),o=B(e.restDecoder);if(o>0){const l=Gt(t.clients,s,()=>[]);for(let f=0;f<o;f++)l.push(new xs(e.readDsClock(),e.readDsLen()))}}return t},ti=(e,t,n)=>{const r=new An,s=B(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();const l=B(e.restDecoder),f=B(e.restDecoder),d=n.clients.get(l)||[],g=rt(n,l);for(let u=0;u<f;u++){const p=e.readDsClock(),w=p+e.readDsLen();if(p<g){g<w&&nr(r,l,g,w-g);let b=Ot(d,p),E=d[b];for(!E.deleted&&E.id.clock<p&&(d.splice(b+1,0,ar(t,E,p-E.id.clock)),b++);b<d.length&&(E=d[b++],E.id.clock<w);)E.deleted||(w<E.id.clock+E.length&&d.splice(b,0,ar(t,E,w-E.id.clock)),E.delete(t))}else nr(r,l,p,w-p)}}if(r.clients.size>0){const o=new he;return O(o.restEncoder,0),He(o,r),o.toUint8Array()}return null},mo=Ri;class qe extends xc{constructor({guid:t=sl(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:l=!1,shouldLoad:f=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=mo(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new So,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=f,this.autoLoad=l,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=ve(g=>{this.on("load",()=>{this.isLoaded=!0,g(this)})});const d=()=>ve(g=>{const u=p=>{(p===void 0||p===!0)&&(this.off("sync",u),g())};this.on("sync",u)});this.on("sync",g=>{g===!1&&this.isSynced&&(this.whenSynced=d()),this.isSynced=g===void 0||g===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=d()}load(){const t=this._item;t!==null&&!this.shouldLoad&&$(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Qt(this.subdocs).map(t=>t.guid))}transact(t,n=null){return $(this,t,n)}get(t,n=ot){const r=Gt(this.share,t,()=>{const o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==ot&&s!==n)if(s===ot){const o=new n;o._map=r._map,r._map.forEach(l=>{for(;l!==null;l=l.left)l.parent=o}),o._start=r._start;for(let l=o._start;l!==null;l=l.right)l.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ue)}getText(t=""){return this.get(t,$e)}getMap(t=""){return this.get(t,Ne)}getXmlElement(t=""){return this.get(t,Pe)}getXmlFragment(t=""){return this.get(t,fe)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Qt(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new qe({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,$(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class wo{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return B(this.restDecoder)}readDsLen(){return B(this.restDecoder)}}class yo extends wo{readLeftID(){return M(B(this.restDecoder),B(this.restDecoder))}readRightID(){return M(B(this.restDecoder),B(this.restDecoder))}readClient(){return B(this.restDecoder)}readInfo(){return Re(this.restDecoder)}readString(){return Ie(this.restDecoder)}readParentInfo(){return B(this.restDecoder)===1}readTypeRef(){return B(this.restDecoder)}readLen(){return B(this.restDecoder)}readAny(){return fn(this.restDecoder)}readBuf(){return vl(gt(this.restDecoder))}readJSON(){return JSON.parse(Ie(this.restDecoder))}readKey(){return Ie(this.restDecoder)}}class La{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=B(this.restDecoder),this.dsCurrVal}readDsLen(){const t=B(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Fe extends La{constructor(t){super(t),this.keys=[],B(t),this.keyClockDecoder=new Rr(gt(t)),this.clientDecoder=new jn(gt(t)),this.leftClockDecoder=new Rr(gt(t)),this.rightClockDecoder=new Rr(gt(t)),this.infoDecoder=new Ks(gt(t),Re),this.stringDecoder=new el(gt(t)),this.parentInfoDecoder=new Ks(gt(t),Re),this.typeRefDecoder=new jn(gt(t)),this.lenDecoder=new jn(gt(t))}readLeftID(){return new Be(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Be(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fn(this.restDecoder)}readBuf(){return gt(this.restDecoder)}readJSON(){return fn(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Ma{constructor(){this.restEncoder=fr()}toUint8Array(){return Rt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){O(this.restEncoder,t)}writeDsLen(t){O(this.restEncoder,t)}}class Cn extends Ma{writeLeftID(t){O(this.restEncoder,t.client),O(this.restEncoder,t.clock)}writeRightID(t){O(this.restEncoder,t.client),O(this.restEncoder,t.clock)}writeClient(t){O(this.restEncoder,t)}writeInfo(t){zr(this.restEncoder,t)}writeString(t){Ce(this.restEncoder,t)}writeParentInfo(t){O(this.restEncoder,t?1:0)}writeTypeRef(t){O(this.restEncoder,t)}writeLen(t){O(this.restEncoder,t)}writeAny(t){hn(this.restEncoder,t)}writeBuf(t){pt(this.restEncoder,t)}writeJSON(t){Ce(this.restEncoder,JSON.stringify(t))}writeKey(t){Ce(this.restEncoder,t)}}class Ra{constructor(){this.restEncoder=fr(),this.dsCurrVal=0}toUint8Array(){return Rt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,O(this.restEncoder,n)}writeDsLen(t){t===0&&_t(),O(this.restEncoder,t-1),this.dsCurrVal+=t}}class he extends Ra{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Mr,this.clientEncoder=new Vn,this.leftClockEncoder=new Mr,this.rightClockEncoder=new Mr,this.infoEncoder=new zs(zr),this.stringEncoder=new Jc,this.parentInfoEncoder=new zs(zr),this.typeRefEncoder=new Vn,this.lenEncoder=new Vn}toUint8Array(){const t=fr();return O(t,0),pt(t,this.keyClockEncoder.toUint8Array()),pt(t,this.clientEncoder.toUint8Array()),pt(t,this.leftClockEncoder.toUint8Array()),pt(t,this.rightClockEncoder.toUint8Array()),pt(t,Rt(this.infoEncoder)),pt(t,this.stringEncoder.toUint8Array()),pt(t,Rt(this.parentInfoEncoder)),pt(t,this.typeRefEncoder.toUint8Array()),pt(t,this.lenEncoder.toUint8Array()),dr(t,Rt(this.restEncoder)),Rt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){hn(this.restEncoder,t)}writeBuf(t){pt(this.restEncoder,t)}writeJSON(t){hn(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const va=(e,t,n,r)=>{r=pe(r,t[0].id.clock);const s=Ot(t,r);O(e.restEncoder,t.length-s),e.writeClient(n),O(e.restEncoder,r);const o=t[s];o.write(e,r-o.id.clock);for(let l=s+1;l<t.length;l++)t[l].write(e,0)},Is=(e,t,n)=>{const r=new Map;n.forEach((s,o)=>{rt(t,o)>s&&r.set(o,s)}),Ds(t).forEach((s,o)=>{n.has(o)||r.set(o,0)}),O(e.restEncoder,r.size),Qt(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{va(e,t.clients.get(s),s,o)})},Oa=(e,t)=>{const n=ft(),r=B(e.restDecoder);for(let s=0;s<r;s++){const o=B(e.restDecoder),l=new Array(o),f=e.readClient();let d=B(e.restDecoder);n.set(f,{i:0,refs:l});for(let g=0;g<o;g++){const u=e.readInfo();switch(hr&u){case 0:{const p=e.readLen();l[g]=new kt(M(f,d),p),d+=p;break}case 10:{const p=B(e.restDecoder);l[g]=new Et(M(f,d),p),d+=p;break}default:{const p=(u&(qt|mt))===0,w=new Z(M(f,d),null,(u&mt)===mt?e.readLeftID():null,null,(u&qt)===qt?e.readRightID():null,p?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,p&&(u&an)===an?e.readString():null,qo(e,u));l[g]=w,d+=w.length}}}}return n},Fa=(e,t,n)=>{const r=[];let s=Qt(n.keys()).sort((b,E)=>b-E);if(s.length===0)return null;const o=()=>{if(s.length===0)return null;let b=n.get(s[s.length-1]);for(;b.refs.length===b.i;)if(s.pop(),s.length>0)b=n.get(s[s.length-1]);else return null;return b};let l=o();if(l===null)return null;const f=new So,d=new Map,g=(b,E)=>{const S=d.get(b);(S==null||S>E)&&d.set(b,E)};let u=l.refs[l.i++];const p=new Map,w=()=>{for(const b of r){const E=b.id.client,S=n.get(E);S?(S.i--,f.clients.set(E,S.refs.slice(S.i)),n.delete(E),S.i=0,S.refs=[]):f.clients.set(E,[b]),s=s.filter(L=>L!==E)}r.length=0};for(;;){if(u.constructor!==Et){const E=Gt(p,u.id.client,()=>rt(t,u.id.client))-u.id.clock;if(E<0)r.push(u),g(u.id.client,u.id.clock-1),w();else{const S=u.getMissing(e,t);if(S!==null){r.push(u);const L=n.get(S)||{refs:[],i:0};if(L.refs.length===L.i)g(S,rt(t,S)),w();else{u=L.refs[L.i++];continue}}else(E===0||E<u.length)&&(u.integrate(e,E),p.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(l!==null&&l.i<l.refs.length)u=l.refs[l.i++];else{if(l=o(),l===null)break;u=l.refs[l.i++]}}if(f.clients.size>0){const b=new he;return Is(b,f,new Map),O(b.restEncoder,0),{missing:d,update:b.toUint8Array()}}return null},Na=(e,t)=>Is(e,t.doc.store,t.beforeState),$a=(e,t,n,r=new Fe(e))=>$(t,s=>{s.local=!1;let o=!1;const l=s.doc,f=l.store,d=Oa(r,l),g=Fa(s,f,d),u=f.pendingStructs;if(u){for(const[w,b]of u.missing)if(b<rt(f,w)){o=!0;break}if(g){for(const[w,b]of g.missing){const E=u.missing.get(w);(E==null||E>b)&&u.missing.set(w,b)}u.update=rr([u.update,g.update])}}else f.pendingStructs=g;const p=ti(r,s,f);if(f.pendingDs){const w=new Fe(Ve(f.pendingDs));B(w.restDecoder);const b=ti(w,s,f);p&&b?f.pendingDs=rr([p,b]):f.pendingDs=p||b}else f.pendingDs=p;if(o){const w=f.pendingStructs.update;f.pendingStructs=null,bo(s.doc,w)}},n,!1),bo=(e,t,n,r=Fe)=>{const s=Ve(t);$a(s,e,n,new r(s))},Pa=(e,t,n)=>bo(e,t,n,yo),Va=(e,t,n=new Map)=>{Is(e,t.store,n),He(e,Ua(t.store))},ja=(e,t=new Uint8Array([0]),n=new he)=>{const r=Eo(t);Va(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(tu(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Cn)return Za(s.map((o,l)=>l===0?o:nu(o)));if(n.constructor===he)return rr(s)}return s[0]},ko=(e,t)=>ja(e,t,new Cn),Ha=e=>{const t=new Map,n=B(e.restDecoder);for(let r=0;r<n;r++){const s=B(e.restDecoder),o=B(e.restDecoder);t.set(s,o)}return t},Eo=e=>Ha(new wo(Ve(e)));class qa{constructor(){this.l=[]}}const ei=()=>new qa,ni=(e,t)=>e.l.push(t),ri=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},_o=(e,t,n)=>ws(e.l,[t,n]);class Be{constructor(t,n){this.client=t,this.clock=n}}const Ln=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,M=(e,t)=>new Be(e,t),Ga=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw _t()},xe=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!go(t.ds,e.id),Qr=(e,t)=>{const n=Gt(e.meta,Qr,ue),r=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<rt(r,o)&&te(e,M(o,s))}),po(e,t.ds,s=>{}),n.add(t))};class So{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ds=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},rt=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},xo=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw _t()}n.push(t)},Ot=(e,t)=>{let n=0,r=e.length-1,s=e[r],o=s.id.clock;if(o===t)return r;let l=vt(t/(o+s.length-1)*r);for(;n<=r;){if(s=e[l],o=s.id.clock,o<=t){if(t<o+s.length)return l;n=l+1}else r=l-1;l=vt((n+r)/2)}throw _t()},Ja=(e,t)=>{const n=e.clients.get(t.client);return n[Ot(n,t.clock)]},$r=Ja,ts=(e,t,n)=>{const r=Ot(t,n),s=t[r];return s.id.clock<n&&s instanceof Z?(t.splice(r+1,0,ar(e,s,n-s.id.clock)),r+1):r},te=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[ts(e,n,t.clock)]},si=(e,t,n)=>{const r=t.clients.get(n.client),s=Ot(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==kt&&r.splice(s+1,0,ar(e,o,n.clock-o.id.clock+1)),o},za=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Ot(r,t.id.clock)]=n},Ao=(e,t,n,r,s)=>{if(r===0)return;const o=n+r;let l=ts(e,t,n),f;do f=t[l++],o<f.id.clock+f.length&&ts(e,t,o),s(f);while(l<t.length&&t[l].id.clock<o)};class Wa{constructor(t,n,r){this.doc=t,this.deleteSet=new An,this.beforeState=Ds(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ii=(e,t)=>t.deleteSet.clients.size===0&&!Ec(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(As(t.deleteSet),Na(e,t),He(e,t.deleteSet),!0),oi=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Gt(e.changed,t,ue).add(n)},Gn=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Z&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const o=t-s;return o&&e.splice(t+1-o,o),o},Ya=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const o=t.clients.get(r);for(let l=s.length-1;l>=0;l--){const f=s[l],d=f.clock+f.len;for(let g=Ot(o,f.clock),u=o[g];g<o.length&&u.id.clock<d;u=o[++g]){const p=o[g];if(f.clock+f.len<=p.id.clock)break;p instanceof Z&&p.deleted&&!p.keep&&n(p)&&p.gc(t,!1)}}}},Ka=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let o=n.length-1;o>=0;o--){const l=n[o],f=Bi(s.length-1,1+Ot(s,l.clock+l.len-1));for(let d=f,g=s[d];d>0&&g.id.clock>=l.clock;g=s[d])d-=1+Gn(s,d)}})},Co=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,o=n.deleteSet,l=n._mergeStructs;try{As(o),n.afterState=Ds(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const f=[];n.changed.forEach((d,g)=>f.push(()=>{(g._item===null||!g._item.deleted)&&g._callObserver(n,d)})),f.push(()=>{n.changedParentTypes.forEach((d,g)=>{g._dEH.l.length>0&&(g._item===null||!g._item.deleted)&&(d=d.filter(u=>u.target._item===null||!u.target._item.deleted),d.forEach(u=>{u.currentTarget=g,u._path=null}),d.sort((u,p)=>u.path.length-p.path.length),_o(g._dEH,d,n))})}),f.push(()=>r.emit("afterTransaction",[n,r])),ws(f,[]),n._needFormattingCleanup&&mu(n)}finally{r.gc&&Ya(o,s,r.gcFilter),Ka(o,s),n.afterState.forEach((u,p)=>{const w=n.beforeState.get(p)||0;if(w!==u){const b=s.clients.get(p),E=pe(Ot(b,w),1);for(let S=b.length-1;S>=E;)S-=1+Gn(b,S)}});for(let u=l.length-1;u>=0;u--){const{client:p,clock:w}=l[u].id,b=s.clients.get(p),E=Ot(b,w);E+1<b.length&&Gn(b,E+1)>1||E>0&&Gn(b,E)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Aa(Ss,co,"[yjs] ",lo,ao,"Changed the client-id because another client seems to be using it."),r.clientID=mo()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Cn;ii(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new he;ii(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:f,subdocsLoaded:d,subdocsRemoved:g}=n;(f.size>0||g.size>0||d.size>0)&&(f.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),g.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:d,added:f,removed:g},r,n]),g.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Co(e,t+1)}}},$=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let o=!1,l=null;e._transaction===null&&(o=!0,e._transaction=new Wa(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{l=t(e._transaction)}finally{if(o){const f=e._transaction===s[0];e._transaction=null,f&&Co(s,0)}}return l};function*Xa(e){const t=B(e.restDecoder);for(let n=0;n<t;n++){const r=B(e.restDecoder),s=e.readClient();let o=B(e.restDecoder);for(let l=0;l<r;l++){const f=e.readInfo();if(f===10){const d=B(e.restDecoder);yield new Et(M(s,o),d),o+=d}else if((hr&f)!==0){const d=(f&(qt|mt))===0,g=new Z(M(s,o),null,(f&mt)===mt?e.readLeftID():null,null,(f&qt)===qt?e.readRightID():null,d?e.readParentInfo()?e.readString():e.readLeftID():null,d&&(f&an)===an?e.readString():null,qo(e,f));yield g,o+=g.length}else{const d=e.readLen();yield new kt(M(s,o),d),o+=d}}}}class Ts{constructor(t,n){this.gen=Xa(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Et);return this.curr}}class Bs{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Za=e=>rr(e,yo,Cn),Qa=(e,t)=>{if(e.constructor===kt){const{client:n,clock:r}=e.id;return new kt(M(n,r+t),e.length-t)}else if(e.constructor===Et){const{client:n,clock:r}=e.id;return new Et(M(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new Z(M(r,s+t),null,M(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},rr=(e,t=Fe,n=he)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Ve(u)));let s=r.map(u=>new Ts(u,!0)),o=null;const l=new n,f=new Bs(l);for(;s=s.filter(w=>w.curr!==null),s.sort((w,b)=>{if(w.curr.id.client===b.curr.id.client){const E=w.curr.id.clock-b.curr.id.clock;return E===0?w.curr.constructor===b.curr.constructor?0:w.curr.constructor===Et?1:-1:E}else return b.curr.id.client-w.curr.id.client}),s.length!==0;){const u=s[0],p=u.curr.id.client;if(o!==null){let w=u.curr,b=!1;for(;w!==null&&w.id.clock+w.length<=o.struct.id.clock+o.struct.length&&w.id.client>=o.struct.id.client;)w=u.next(),b=!0;if(w===null||w.id.client!==p||b&&w.id.clock>o.struct.id.clock+o.struct.length)continue;if(p!==o.struct.id.client)Xt(f,o.struct,o.offset),o={struct:w,offset:0},u.next();else if(o.struct.id.clock+o.struct.length<w.id.clock)if(o.struct.constructor===Et)o.struct.length=w.id.clock+w.length-o.struct.id.clock;else{Xt(f,o.struct,o.offset);const E=w.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Et(M(p,o.struct.id.clock+o.struct.length),E),offset:0}}else{const E=o.struct.id.clock+o.struct.length-w.id.clock;E>0&&(o.struct.constructor===Et?o.struct.length-=E:w=Qa(w,E)),o.struct.mergeWith(w)||(Xt(f,o.struct,o.offset),o={struct:w,offset:0},u.next())}}else o={struct:u.curr,offset:0},u.next();for(let w=u.curr;w!==null&&w.id.client===p&&w.id.clock===o.struct.id.clock+o.struct.length&&w.constructor!==Et;w=u.next())Xt(f,o.struct,o.offset),o={struct:w,offset:0}}o!==null&&(Xt(f,o.struct,o.offset),o=null),Us(f);const d=r.map(u=>Cs(u)),g=Ta(d);return He(l,g),l.toUint8Array()},tu=(e,t,n=Fe,r=he)=>{const s=Eo(t),o=new r,l=new Bs(o),f=new n(Ve(e)),d=new Ts(f,!1);for(;d.curr;){const u=d.curr,p=u.id.client,w=s.get(p)||0;if(d.curr.constructor===Et){d.next();continue}if(u.id.clock+u.length>w)for(Xt(l,u,pe(w-u.id.clock,0)),d.next();d.curr&&d.curr.id.client===p;)Xt(l,d.curr,0),d.next();else for(;d.curr&&d.curr.id.client===p&&d.curr.id.clock+d.curr.length<=w;)d.next()}Us(l);const g=Cs(f);return He(o,g),o.toUint8Array()},Io=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Rt(e.encoder.restEncoder)}),e.encoder.restEncoder=fr(),e.written=0)},Xt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Io(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),O(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Us=e=>{Io(e);const t=e.encoder.restEncoder;O(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];O(t,r.written),dr(t,r.restEncoder)}},eu=(e,t,n,r)=>{const s=new n(Ve(e)),o=new Ts(s,!1),l=new r,f=new Bs(l);for(let g=o.curr;g!==null;g=o.next())Xt(f,t(g),0);Us(f);const d=Cs(s);return He(l,d),l.toUint8Array()},nu=e=>eu(e,Dl,Fe,Cn),ci="You must not compute changes after the event-handler fired.";class _r{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ru(this.currentTarget,this.target))}deletes(t){return go(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ct(ci);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const o=n._map.get(s);let l,f;if(this.adds(o)){let d=o.left;for(;d!==null&&this.adds(d);)d=d.left;if(this.deletes(o))if(d!==null&&this.deletes(d))l="delete",f=Br(d.content.getContent());else return;else d!==null&&this.deletes(d)?(l="update",f=Br(d.content.getContent())):(l="add",f=void 0)}else if(this.deletes(o))l="delete",f=Br(o.content.getContent());else return;t.set(s,{action:l,oldValue:f})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ct(ci);const n=this.target,r=ue(),s=ue(),o=[];if(t={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let f=null;const d=()=>{f&&o.push(f)};for(let g=n._start;g!==null;g=g.right)g.deleted?this.deletes(g)&&!this.adds(g)&&((f===null||f.delete===void 0)&&(d(),f={delete:0}),f.delete+=g.length,s.add(g)):this.adds(g)?((f===null||f.insert===void 0)&&(d(),f={insert:[]}),f.insert=f.insert.concat(g.content.getContent()),r.add(g)):((f===null||f.retain===void 0)&&(d(),f={retain:0}),f.retain+=g.length);f!==null&&f.retain===void 0&&d()}this._changes=t}return t}}const ru=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},at=()=>{Ca("Invalid access: Add Yjs type to a document before reading data.")},Do=80;let Ls=0;class su{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Ls++}}const iu=e=>{e.timestamp=Ls++},To=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Ls++},ou=(e,t,n)=>{if(e.length>=Do){const r=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return To(r,t,n),r}else{const r=new su(t,n);return e.push(r),r}},Sr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,l)=>Pn(t-o.index)<Pn(t-l.index)?o:l);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,iu(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&Pn(n.index-s)<r.parent.length/Do?(To(n,r,s),n):ou(e._searchMarker,r,s)},mn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=pe(t,s.index+n))}},xr=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;Gt(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;_o(r._eH,n,t)};class ot{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ei(),this._dEH=ei(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw At()}clone(){throw At()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ni(this._eH,t)}observeDeep(t){ni(this._dEH,t)}unobserve(t){ri(this._eH,t)}unobserveDeep(t){ri(this._dEH,t)}toJSON(){}}const Bo=(e,t,n)=>{e.doc??at(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const l=o.content.getContent();if(l.length<=t)t-=l.length;else{for(let f=t;f<l.length&&r>0;f++)s.push(l[f]),r--;t=0}}o=o.right}return s},Uo=e=>{e.doc??at();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},wn=(e,t)=>{let n=0,r=e._start;for(e.doc??at();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let o=0;o<s.length;o++)t(s[o],n++,e)}r=r.right}},Lo=(e,t)=>{const n=[];return wn(e,(r,s)=>{n.push(t(r,s,e))}),n},cu=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Mo=(e,t)=>{e.doc??at();const n=Sr(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},sr=(e,t,n,r)=>{let s=n;const o=e.doc,l=o.clientID,f=o.store,d=n===null?t._start:n.right;let g=[];const u=()=>{g.length>0&&(s=new Z(M(l,rt(f,l)),s,s&&s.lastId,d,d&&d.id,t,null,new de(g)),s.integrate(e,0),g=[])};r.forEach(p=>{if(p===null)g.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:g.push(p);break;default:switch(u(),p.constructor){case Uint8Array:case ArrayBuffer:s=new Z(M(l,rt(f,l)),s,s&&s.lastId,d,d&&d.id,t,null,new In(new Uint8Array(p))),s.integrate(e,0);break;case qe:s=new Z(M(l,rt(f,l)),s,s&&s.lastId,d,d&&d.id,t,null,new Dn(p)),s.integrate(e,0);break;default:if(p instanceof ot)s=new Z(M(l,rt(f,l)),s,s&&s.lastId,d,d&&d.id,t,null,new Wt(p)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Ro=()=>Ct("Length exceeded!"),vo=(e,t,n,r)=>{if(n>t._length)throw Ro();if(n===0)return t._searchMarker&&mn(t._searchMarker,n,r.length),sr(e,t,null,r);const s=n,o=Sr(t,n);let l=t._start;for(o!==null&&(l=o.p,n-=o.index,n===0&&(l=l.prev,n+=l&&l.countable&&!l.deleted?l.length:0));l!==null;l=l.right)if(!l.deleted&&l.countable){if(n<=l.length){n<l.length&&te(e,M(l.id.client,l.id.clock+n));break}n-=l.length}return t._searchMarker&&mn(t._searchMarker,s,r.length),sr(e,t,l,r)},lu=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,l)=>l.index>o.index?l:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return sr(e,t,s,n)},Oo=(e,t,n,r)=>{if(r===0)return;const s=n,o=r,l=Sr(t,n);let f=t._start;for(l!==null&&(f=l.p,n-=l.index);f!==null&&n>0;f=f.right)!f.deleted&&f.countable&&(n<f.length&&te(e,M(f.id.client,f.id.clock+n)),n-=f.length);for(;r>0&&f!==null;)f.deleted||(r<f.length&&te(e,M(f.id.client,f.id.clock+r)),f.delete(e),r-=f.length),f=f.right;if(r>0)throw Ro();t._searchMarker&&mn(t._searchMarker,s,-o+r)},ir=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ms=(e,t,n,r)=>{const s=t._map.get(n)||null,o=e.doc,l=o.clientID;let f;if(r==null)f=new de([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:f=new de([r]);break;case Uint8Array:f=new In(r);break;case qe:f=new Dn(r);break;default:if(r instanceof ot)f=new Wt(r);else throw new Error("Unexpected content type")}new Z(M(l,rt(o.store,l)),s,s&&s.lastId,null,null,t,n,f).integrate(e,0)},Rs=(e,t)=>{e.doc??at();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Fo=e=>{const t={};return e.doc??at(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},No=(e,t)=>{e.doc??at();const n=e._map.get(t);return n!==void 0&&!n.deleted},au=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let o=r;for(;o!==null&&(!t.sv.has(o.id.client)||o.id.clock>=(t.sv.get(o.id.client)||0));)o=o.left;o!==null&&xe(o,t)&&(n[s]=o.content.getContent()[o.length-1])}),n},Mn=e=>(e.doc??at(),Ia(e._map.entries(),t=>!t[1].deleted));class uu extends _r{}class Ue extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ue;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ue}clone(){const t=new Ue;return t.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),t}get length(){return this.doc??at(),this._length}_callObserver(t,n){super._callObserver(t,n),xr(this,t,new uu(this,t))}insert(t,n){this.doc!==null?$(this.doc,r=>{vo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?$(this.doc,n=>{lu(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?$(this.doc,r=>{Oo(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Mo(this,t)}toArray(){return Uo(this)}slice(t=0,n=this.length){return Bo(this,t,n)}toJSON(){return this.map(t=>t instanceof ot?t.toJSON():t)}map(t){return Lo(this,t)}forEach(t){wn(this,t)}[Symbol.iterator](){return cu(this)}_write(t){t.writeTypeRef(vu)}}const hu=e=>new Ue;class fu extends _r{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Ne extends ot{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Ne}clone(){const t=new Ne;return this.forEach((n,r)=>{t.set(r,n instanceof ot?n.clone():n)}),t}_callObserver(t,n){xr(this,t,new fu(this,t,n))}toJSON(){this.doc??at();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof ot?s.toJSON():s}}),t}get size(){return[...Mn(this)].length}keys(){return Nr(Mn(this),t=>t[0])}values(){return Nr(Mn(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Nr(Mn(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??at(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?$(this.doc,n=>{ir(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?$(this.doc,r=>{Ms(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Rs(this,t)}has(t){return No(this,t)}clear(){this.doc!==null?$(this.doc,t=>{this.forEach(function(n,r,s){ir(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ou)}}const du=e=>new Ne,Zt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Cl(e,t);class es{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&_t(),this.right.content.constructor){case Q:this.right.deleted||Ge(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const li=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Q:t.right.deleted||Ge(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&te(e,M(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Rn=(e,t,n,r)=>{const s=new Map,o=r?Sr(t,n):null;if(o){const l=new es(o.p.left,o.p,o.index,s);return li(e,l,n-o.index)}else{const l=new es(null,t._start,0,s);return li(e,l,n)}},$o=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Q&&Zt(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,o=s.clientID;r.forEach((l,f)=>{const d=n.left,g=n.right,u=new Z(M(o,rt(s.store,o)),d,d&&d.lastId,g,g&&g.id,t,null,new Q(f,l));u.integrate(e,0),n.right=u,n.forward()})},Ge=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Po=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Q&&Zt(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Vo=(e,t,n,r)=>{const s=e.doc,o=s.clientID,l=new Map;for(const f in r){const d=r[f],g=n.currentAttributes.get(f)??null;if(!Zt(g,d)){l.set(f,g);const{left:u,right:p}=n;n.right=new Z(M(o,rt(s.store,o)),u,u&&u.lastId,p,p&&p.id,t,null,new Q(f,d)),n.right.integrate(e,0),n.forward()}}return l},Pr=(e,t,n,r,s)=>{n.currentAttributes.forEach((w,b)=>{s[b]===void 0&&(s[b]=null)});const o=e.doc,l=o.clientID;Po(n,s);const f=Vo(e,t,n,s),d=r.constructor===String?new Ft(r):r instanceof ot?new Wt(r):new ge(r);let{left:g,right:u,index:p}=n;t._searchMarker&&mn(t._searchMarker,n.index,d.getLength()),u=new Z(M(l,rt(o.store,l)),g,g&&g.lastId,u,u&&u.id,t,null,d),u.integrate(e,0),n.right=u,n.index=p,n.forward(),$o(e,t,n,f)},ai=(e,t,n,r,s)=>{const o=e.doc,l=o.clientID;Po(n,s);const f=Vo(e,t,n,s);t:for(;n.right!==null&&(r>0||f.size>0&&(n.right.deleted||n.right.content.constructor===Q));){if(!n.right.deleted)switch(n.right.content.constructor){case Q:{const{key:d,value:g}=n.right.content,u=s[d];if(u!==void 0){if(Zt(u,g))f.delete(d);else{if(r===0)break t;f.set(d,g)}n.right.delete(e)}else n.currentAttributes.set(d,g);break}default:r<n.right.length&&te(e,M(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let d="";for(;r>0;r--)d+=`
`;n.right=new Z(M(l,rt(o.store,l)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ft(d)),n.right.integrate(e,0),n.forward()}$o(e,t,n,f)},jo=(e,t,n,r,s)=>{let o=t;const l=ft();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===Q){const g=o.content;l.set(g.key,g)}o=o.right}let f=0,d=!1;for(;t!==o;){if(n===t&&(d=!0),!t.deleted){const g=t.content;switch(g.constructor){case Q:{const{key:u,value:p}=g,w=r.get(u)??null;(l.get(u)!==g||w===p)&&(t.delete(e),f++,!d&&(s.get(u)??null)===p&&w!==p&&(w===null?s.delete(u):s.set(u,w))),!d&&!t.deleted&&Ge(s,g);break}}}t=t.right}return f},pu=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Q){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},gu=e=>{let t=0;return $(e.doc,n=>{let r=e._start,s=e._start,o=ft();const l=Gr(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Q:Ge(l,s.content);break;default:t+=jo(n,r,s,o,l),o=Gr(l),r=s;break}s=s.right}}),t},mu=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const o=e.beforeState.get(r)||0;s!==o&&Ao(e,n.store.clients.get(r),o,s,l=>{!l.deleted&&l.content.constructor===Q&&l.constructor!==kt&&t.add(l.parent)})}$(n,r=>{po(e,e.deleteSet,s=>{if(s instanceof kt||!s.parent._hasFormatting||t.has(s.parent))return;const o=s.parent;s.content.constructor===Q?t.add(o):pu(r,s)});for(const s of t)gu(s)})},ui=(e,t,n)=>{const r=n,s=Gr(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Wt:case ge:case Ft:n<t.right.length&&te(e,M(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&jo(e,o,t.right,s,t.currentAttributes);const l=(t.left||t.right).parent;return l._searchMarker&&mn(l._searchMarker,t.index,-r+n),t};class wu extends _r{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];$(t,r=>{const s=new Map,o=new Map;let l=this.target._start,f=null;const d={};let g="",u=0,p=0;const w=()=>{if(f!==null){let b=null;switch(f){case"delete":p>0&&(b={delete:p}),p=0;break;case"insert":(typeof g=="object"||g.length>0)&&(b={insert:g},s.size>0&&(b.attributes={},s.forEach((E,S)=>{E!==null&&(b.attributes[S]=E)}))),g="";break;case"retain":u>0&&(b={retain:u},Al(d)||(b.attributes=_l({},d))),u=0;break}b&&n.push(b),f=null}};for(;l!==null;){switch(l.content.constructor){case Wt:case ge:this.adds(l)?this.deletes(l)||(w(),f="insert",g=l.content.getContent()[0],w()):this.deletes(l)?(f!=="delete"&&(w(),f="delete"),p+=1):l.deleted||(f!=="retain"&&(w(),f="retain"),u+=1);break;case Ft:this.adds(l)?this.deletes(l)||(f!=="insert"&&(w(),f="insert"),g+=l.content.str):this.deletes(l)?(f!=="delete"&&(w(),f="delete"),p+=l.length):l.deleted||(f!=="retain"&&(w(),f="retain"),u+=l.length);break;case Q:{const{key:b,value:E}=l.content;if(this.adds(l)){if(!this.deletes(l)){const S=s.get(b)??null;Zt(S,E)?E!==null&&l.delete(r):(f==="retain"&&w(),Zt(E,o.get(b)??null)?delete d[b]:d[b]=E)}}else if(this.deletes(l)){o.set(b,E);const S=s.get(b)??null;Zt(S,E)||(f==="retain"&&w(),d[b]=S)}else if(!l.deleted){o.set(b,E);const S=d[b];S!==void 0&&(Zt(S,E)?S!==null&&l.delete(r):(f==="retain"&&w(),E===null?delete d[b]:d[b]=E))}l.deleted||(f==="insert"&&w(),Ge(s,l.content));break}}l=l.right}for(w();n.length>0;){const b=n[n.length-1];if(b.retain!==void 0&&b.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class $e extends ot{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??at(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new $e}clone(){const t=new $e;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new wu(this,t,n);xr(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??at();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ft&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?$(this.doc,r=>{const s=new es(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const l=t[o];if(l.insert!==void 0){const f=!n&&typeof l.insert=="string"&&o===t.length-1&&s.right===null&&l.insert.slice(-1)===`
`?l.insert.slice(0,-1):l.insert;(typeof f!="string"||f.length>0)&&Pr(r,this,s,f,l.attributes||{})}else l.retain!==void 0?ai(r,this,s,l.retain,l.attributes||{}):l.delete!==void 0&&ui(r,s,l.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??at();const s=[],o=new Map,l=this.doc;let f="",d=this._start;function g(){if(f.length>0){const p={};let w=!1;o.forEach((E,S)=>{w=!0,p[S]=E});const b={insert:f};w&&(b.attributes=p),s.push(b),f=""}}const u=()=>{for(;d!==null;){if(xe(d,t)||n!==void 0&&xe(d,n))switch(d.content.constructor){case Ft:{const p=o.get("ychange");t!==void 0&&!xe(d,t)?(p===void 0||p.user!==d.id.client||p.type!=="removed")&&(g(),o.set("ychange",r?r("removed",d.id):{type:"removed"})):n!==void 0&&!xe(d,n)?(p===void 0||p.user!==d.id.client||p.type!=="added")&&(g(),o.set("ychange",r?r("added",d.id):{type:"added"})):p!==void 0&&(g(),o.delete("ychange")),f+=d.content.str;break}case Wt:case ge:{g();const p={insert:d.content.getContent()[0]};if(o.size>0){const w={};p.attributes=w,o.forEach((b,E)=>{w[E]=b})}s.push(p);break}case Q:xe(d,t)&&(g(),Ge(o,d.content));break}d=d.right}g()};return t||n?$(l,p=>{t&&Qr(p,t),n&&Qr(p,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?$(s,o=>{const l=Rn(o,this,t,!r);r||(r={},l.currentAttributes.forEach((f,d)=>{r[d]=f})),Pr(o,this,l,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?$(s,o=>{const l=Rn(o,this,t,!r);Pr(o,this,l,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?$(r,s=>{ui(s,Rn(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?$(s,o=>{const l=Rn(o,this,t,!1);l.right!==null&&ai(o,this,l,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?$(this.doc,n=>{ir(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?$(this.doc,r=>{Ms(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Rs(this,t)}getAttributes(){return Fo(this)}_write(t){t.writeTypeRef(Fu)}}const yu=e=>new $e;class Vr{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??at()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Pe||n.constructor===fe)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class fe extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fe}clone(){const t=new fe;return t.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),t}get length(){return this.doc??at(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Vr(this,t)}querySelector(t){t=t.toUpperCase();const r=new Vr(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Qt(new Vr(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){xr(this,t,new Eu(this,n,t))}toString(){return Lo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),wn(this,o=>{s.insertBefore(o.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?$(this.doc,r=>{vo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)$(this.doc,r=>{const s=t&&t instanceof ot?t._item:t;sr(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw Ct("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?$(this.doc,r=>{Oo(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Uo(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Mo(this,t)}slice(t=0,n=this.length){return Bo(this,t,n)}forEach(t){wn(this,t)}_write(t){t.writeTypeRef($u)}}const bu=e=>new fe;class Pe extends fe{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Pe(this.nodeName)}clone(){const t=new Pe(this.nodeName),n=this.getAttributes();return xl(n,(r,s)=>{t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const f in t)r.push(f);r.sort();const s=r.length;for(let f=0;f<s;f++){const d=r[f];n.push(d+'="'+t[d]+'"')}const o=this.nodeName.toLocaleLowerCase(),l=n.length>0?" "+n.join(" "):"";return`<${o}${l}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?$(this.doc,n=>{ir(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?$(this.doc,r=>{Ms(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Rs(this,t)}hasAttribute(t){return No(this,t)}getAttributes(t){return t?au(this,t):Fo(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),o=this.getAttributes();for(const l in o){const f=o[l];typeof f=="string"&&s.setAttribute(l,f)}return wn(this,l=>{s.appendChild(l.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Nu),t.writeKey(this.nodeName)}}const ku=e=>new Pe(e.readKey());class Eu extends _r{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class or extends Ne{constructor(t){super(),this.hookName=t}_copy(){return new or(this.hookName)}clone(){const t=new or(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(Pu),t.writeKey(this.hookName)}}const _u=e=>new or(e.readKey());class cr extends $e{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new cr}clone(){const t=new cr;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const o=[];for(const l in t.attributes[s])o.push({key:l,value:t.attributes[s][l]});o.sort((l,f)=>l.key<f.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const o=n[s];r+=`<${o.nodeName}`;for(let l=0;l<o.attrs.length;l++){const f=o.attrs[l];r+=` ${f.key}="${f.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Vu)}}const Su=e=>new cr;class vs{constructor(t,n){this.id=t,this.length=n}get deleted(){throw At()}mergeWith(t){return!1}write(t,n,r){throw At()}integrate(t,n){throw At()}}const xu=0;class kt extends vs{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),xo(t.doc.store,this)}write(t,n){t.writeInfo(xu),t.writeLen(this.length-n)}getMissing(t,n){return null}}class In{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new In(this.content)}splice(t){throw At()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Au=e=>new In(e.readBuf());class yn{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new yn(this.len)}splice(t){const n=new yn(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){nr(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Cu=e=>new yn(e.readLen()),Ho=(e,t)=>new qe({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Dn{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Dn(Ho(this.doc.guid,this.opts))}splice(t){throw At()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Iu=e=>new Dn(Ho(e.readString(),e.readAny()));class ge{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ge(this.embed)}splice(t){throw At()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Du=e=>new ge(e.readJSON());class Q{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Q(this.key,this.value)}splice(t){throw At()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Tu=e=>new Q(e.readKey(),e.readJSON());class lr{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new lr(this.arr)}splice(t){const n=new lr(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Bu=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new lr(n)},Uu=Qn("node_env")==="development";class de{constructor(t){this.arr=t,Uu&&ji(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new de(this.arr)}splice(t){const n=new de(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const o=this.arr[s];t.writeAny(o)}}getRef(){return 8}}const Lu=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new de(n)};class Ft{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ft(this.str)}splice(t){const n=new Ft(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Mu=e=>new Ft(e.readString()),Ru=[hu,du,yu,ku,bu,_u,Su],vu=0,Ou=1,Fu=2,Nu=3,$u=4,Pu=5,Vu=6;class Wt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Wt(this.type._copy())}splice(t){throw At()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const ju=e=>new Wt(Ru[e.readTypeRef()](e)),ar=(e,t,n)=>{const{client:r,clock:s}=t.id,o=new Z(M(r,s+n),t,M(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=M(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o};class Z extends vs{constructor(t,n,r,s,o,l,f,d){super(t,d.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=l,this.parentSub=f,this.redone=null,this.content=d,this.info=this.content.isCountable()?Hs:0}set marker(t){(this.info&Lr)>0!==t&&(this.info^=Lr)}get marker(){return(this.info&Lr)>0}get keep(){return(this.info&js)>0}set keep(t){this.keep!==t&&(this.info^=js)}get countable(){return(this.info&Hs)>0}get deleted(){return(this.info&Ur)>0}set deleted(t){this.deleted!==t&&(this.info^=Ur)}markDeleted(){this.info|=Ur}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=rt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=rt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Be&&this.id.client!==this.parent.client&&this.parent.clock>=rt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=si(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=te(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===kt||this.right&&this.right.constructor===kt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Z?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Z&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Be){const r=$r(n,this.parent);r.constructor===kt?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=si(t,t.doc.store,M(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const o=new Set,l=new Set;for(;s!==null&&s!==this.right;){if(l.add(s),o.add(s),Ln(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Ln(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&l.has($r(t.doc.store,s.origin)))o.has($r(t.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),xo(t.doc.store,this),this.content.integrate(t,this),oi(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new kt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:M(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ln(t.origin,this.lastId)&&this.right===t&&Ln(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),nr(t.deleteSet,this.id.client,this.id.clock,this.length),oi(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw _t();this.content.gc(t),n?za(t,this,new kt(this.id,this.length)):this.content=new yn(this.length)}write(t,n){const r=n>0?M(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,l=this.content.getRef()&hr|(r===null?0:mt)|(s===null?0:qt)|(o===null?0:an);if(t.writeInfo(l),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const f=this.parent;if(f._item!==void 0){const d=f._item;if(d===null){const g=Ga(f);t.writeParentInfo(!0),t.writeString(g)}else t.writeParentInfo(!1),t.writeLeftID(d.id)}else f.constructor===String?(t.writeParentInfo(!0),t.writeString(f)):f.constructor===Be?(t.writeParentInfo(!1),t.writeLeftID(f)):_t();o!==null&&t.writeString(o)}this.content.write(t,n)}}const qo=(e,t)=>Hu[t&hr](e),Hu=[()=>{_t()},Cu,Bu,Au,Mu,Du,Tu,ju,Lu,Iu,()=>{_t()}],qu=10;class Et extends vs{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){_t()}write(t,n){t.writeInfo(qu),O(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Go=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Vs<"u"?Vs:{},Jo="__ $YJS$ __";Go[Jo]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Go[Jo]=!0;const me=e=>ve((t,n)=>{e.onerror=r=>n(new Error(r.target.error)),e.onsuccess=r=>t(r.target.result)}),Gu=(e,t)=>ve((n,r)=>{const s=indexedDB.open(e);s.onupgradeneeded=o=>t(o.target.result),s.onerror=o=>r(Ct(o.target.error)),s.onsuccess=o=>{const l=o.target.result;l.onversionchange=()=>{l.close()},n(l)}}),Ju=e=>me(indexedDB.deleteDatabase(e)),zu=(e,t)=>t.forEach(n=>e.createObjectStore.apply(e,n)),en=(e,t,n="readwrite")=>{const r=e.transaction(t,n);return t.map(s=>eh(r,s))},zo=(e,t)=>me(e.count(t)),Wu=(e,t)=>me(e.get(t)),Wo=(e,t)=>me(e.delete(t)),Yu=(e,t,n)=>me(e.put(t,n)),ns=(e,t)=>me(e.add(t)),Ku=(e,t,n)=>me(e.getAll(t,n)),Xu=(e,t,n)=>{let r=null;return th(e,t,s=>(r=s,!1),n).then(()=>r)},Zu=(e,t=null)=>Xu(e,t,"prev"),Qu=(e,t)=>ve((n,r)=>{e.onerror=r,e.onsuccess=async s=>{const o=s.target.result;if(o===null||await t(o)===!1)return n();o.continue()}}),th=(e,t,n,r="next")=>Qu(e.openKeyCursor(t,r),s=>n(s.key)),eh=(e,t)=>e.objectStore(t),nh=(e,t)=>IDBKeyRange.upperBound(e,t),rh=(e,t)=>IDBKeyRange.lowerBound(e,t),jr="custom",Yo="updates",Ko=500,Xo=(e,t=()=>{},n=()=>{})=>{const[r]=en(e.db,[Yo]);return Ku(r,rh(e._dbref,!1)).then(s=>{e._destroyed||(t(r),$(e.doc,()=>{s.forEach(o=>Pa(e.doc,o))},e,!1),n(r))}).then(()=>Zu(r).then(s=>{e._dbref=s+1})).then(()=>zo(r).then(s=>{e._dbsize=s})).then(()=>r)},sh=(e,t=!0)=>Xo(e).then(n=>{(t||e._dbsize>=Ko)&&ns(n,ko(e.doc)).then(()=>Wo(n,nh(e._dbref,!0))).then(()=>zo(n).then(r=>{e._dbsize=r}))});class ih extends Ac{constructor(t,n){super(),this.doc=n,this.name=t,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Gu(t,r=>zu(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=ve(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Xo(this,l=>ns(l,ko(n)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){const[o]=en(this.db,[Yo]);ns(o,r),++this._dbsize>=Ko&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{sh(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},n.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{Ju(this.name)})}get(t){return this._db.then(n=>{const[r]=en(n,[jr],"readonly");return Wu(r,t)})}set(t,n){return this._db.then(r=>{const[s]=en(r,[jr]);return Yu(s,n,t)})}del(t){return this._db.then(n=>{const[r]=en(n,[jr]);return Wo(r,t)})}}const Zo="schwalbvault",Je=new qe,oh=typeof window<"u",Jn=oh?new ih(Zo,Je):null,ch=Je.getMap("characters"),nn=Je.getMap("campaigns"),lh=Je.getMap("enemies"),ah=Je.getMap("encounters"),uh=()=>new Promise(e=>{if(!Jn){e();return}Jn.synced?e():Jn.on("synced",()=>{e()})}),lf=Object.freeze(Object.defineProperty({__proto__:null,campaignsMap:nn,charactersMap:ch,doc:Je,encountersMap:ah,enemiesMap:lh,provider:Jn,waitForSync:uh},Symbol.toStringTag,{value:"Module"})),{floor:hh,random:fh}=Math,bn="Trystero",kn=(e,t)=>Array(e).fill().map(t),hi="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",Qo=e=>kn(e,()=>hi[hh(fh()*hi.length)]).join(""),Ae=Qo(20),oe=Promise.all.bind(Promise),tc=typeof window<"u",{entries:rs,fromEntries:ec,keys:dh}=Object,Vt=()=>{},jt=e=>new Error(`${bn}: ${e}`),ph=new TextEncoder,gh=new TextDecoder,Le=e=>ph.encode(e),zn=e=>gh.decode(e),vn=(...e)=>e.join("@"),mh=(e,t,n,r)=>(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||n),En=JSON.stringify,_n=JSON.parse,fi=3333,On={};let ln=null,ss=null;const wh=()=>{ln||(ln=new Promise(e=>{ss=e}).finally(()=>{ss=null,ln=null}))},yh=()=>ss?.(),bh=(e,t)=>{const n={},r=()=>{const s=new WebSocket(e);s.onclose=()=>{if(ln){ln.then(r);return}On[e]??=fi,setTimeout(r,On[e]),On[e]*=2},s.onmessage=o=>t(o.data),n.socket=s,n.url=s.url,n.ready=new Promise(o=>s.onopen=()=>{o(n),On[e]=fi}),n.send=o=>{s.readyState===1&&s.send(o)}};return r(),n},kh=()=>{if(tc){const e=new AbortController;return addEventListener("online",yh,{signal:e.signal}),addEventListener("offline",wh,{signal:e.signal}),()=>e.abort()}return Vt},Os="AES-GCM",Eh={},_h=e=>btoa(String.fromCharCode.apply(null,new Uint8Array(e))),Sh=e=>{const t=atob(e);return new Uint8Array(t.length).map((n,r)=>t.charCodeAt(r)).buffer},xh=async(e,t)=>new Uint8Array(await crypto.subtle.digest(e,Le(t))),rn=async e=>Eh[e]||=Array.from(await xh("SHA-1",e)).map(t=>t.toString(36)).join(""),Ah=async(e,t,n)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Le(`${e}:${t}:${n}`)),{name:Os},!1,["encrypt","decrypt"]),nc="$",rc=",",Ch=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16));return n.join(rc)+nc+_h(await crypto.subtle.encrypt({name:Os,iv:n},await e,Le(t)))},Ih=async(e,t)=>{const[n,r]=t.split(nc);return zn(await crypto.subtle.decrypt({name:Os,iv:new Uint8Array(n.split(rc))},await e,Sh(r)))},Dh=5e3,di="icegatheringstatechange",pi="offer",Th="answer",gi=(e,{rtcConfig:t,rtcPolyfill:n,turnConfig:r})=>{const s=new(n||RTCPeerConnection)({iceServers:Bh.concat(r||[]),...t}),o={};let l=!1,f=!1,d=null;const g=p=>{p.binaryType="arraybuffer",p.bufferedAmountLowThreshold=65535,p.onmessage=w=>o.data?.(w.data),p.onopen=()=>o.connect?.(),p.onclose=()=>o.close?.(),p.onerror=w=>o.error?.(w)},u=p=>Promise.race([new Promise(w=>{const b=()=>{p.iceGatheringState==="complete"&&(p.removeEventListener(di,b),w())};p.addEventListener(di,b),b()}),new Promise(w=>setTimeout(w,Dh))]).then(()=>({type:p.localDescription.type,sdp:p.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")}));return e?(d=s.createDataChannel("data"),g(d)):s.ondatachannel=({channel:p})=>{d=p,g(p)},s.onnegotiationneeded=async()=>{try{l=!0,await s.setLocalDescription();const p=await u(s);o.signal?.(p)}catch(p){o.error?.(p)}finally{l=!1}},s.onconnectionstatechange=()=>{["disconnected","failed","closed"].includes(s.connectionState)&&o.close?.()},s.ontrack=p=>{o.track?.(p.track,p.streams[0]),o.stream?.(p.streams[0])},s.onremovestream=p=>o.stream?.(p.stream),e&&(s.canTrickleIceCandidates||s.onnegotiationneeded()),{created:Date.now(),connection:s,get channel(){return d},get isDead(){return s.connectionState==="closed"},async signal(p){if(!(d?.readyState==="open"&&!p.sdp?.includes("a=rtpmap")))try{if(p.type===pi){if(l||s.signalingState!=="stable"&&!f){if(e)return;await oe([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(p)])}else await s.setRemoteDescription(p);await s.setLocalDescription();const w=await u(s);return o.signal?.(w),w}else if(p.type===Th){f=!0;try{await s.setRemoteDescription(p)}finally{f=!1}}}catch(w){o.error?.(w)}},sendData:p=>d.send(p),destroy:()=>{d?.close(),s.close(),l=!1,f=!1},setHandlers:p=>Object.assign(o,p),offerPromise:e?new Promise(p=>o.signal=w=>{w.type===pi&&p(w)}):Promise.resolve(),addStream:p=>p.getTracks().forEach(w=>s.addTrack(w,p)),removeStream:p=>s.getSenders().filter(w=>p.getTracks().includes(w.track)).forEach(w=>s.removeTrack(w)),addTrack:(p,w)=>s.addTrack(p,w),removeTrack:p=>{const w=s.getSenders().find(b=>b.track===p);w&&s.removeTrack(w)},replaceTrack:(p,w)=>{const b=s.getSenders().find(E=>E.track===p);if(b)return b.replaceTrack(w)}}},Bh=[...kn(3,(e,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:stun.cloudflare.com:3478"].map(e=>({urls:e})),Uh=Object.getPrototypeOf(Uint8Array),Wn=12,sc=0,Yn=sc+Wn,Kn=Yn+1,sn=Kn+1,on=sn+1,se=16*2**10-on,Fn=255,mi="bufferedamountlow",Se=e=>"@_"+e,Lh=(e,t,n)=>{const r={},s={},o={},l={},f={},d={},g={},u={onPeerJoin:Vt,onPeerLeave:Vt,onPeerStream:Vt,onPeerTrack:Vt},p=(_,x)=>(_?Array.isArray(_)?_:[_]:dh(r)).flatMap(T=>{const R=r[T];return R?x(T,R):(console.warn(`${bn}: no peer with id ${T} found`),[])}),w=_=>{r[_]&&(r[_].destroy(),delete r[_],delete l[_],delete f[_],u.onPeerLeave(_),t(_))},b=_=>{if(s[_])return o[_];if(!_)throw jt("action type argument is required");const x=Le(_);if(x.byteLength>Wn)throw jt(`action type string "${_}" (${x.byteLength}b) exceeds byte limit (${Wn}). Hint: choose a shorter name.`);const T=new Uint8Array(Wn);T.set(x);let R=0;return s[_]={onComplete:Vt,onProgress:Vt,setOnComplete:V=>s[_]={...s[_],onComplete:V},setOnProgress:V=>s[_]={...s[_],onProgress:V},send:async(V,A,C,q)=>{if(C&&typeof C!="object")throw jt("action meta argument must be an object");const ct=typeof V;if(ct==="undefined")throw jt("action data cannot be undefined");const tt=ct!=="string",xt=V instanceof Blob,F=xt||V instanceof ArrayBuffer||V instanceof Uh;if(C&&!F)throw jt("action meta argument can only be used with binary data");const v=F?new Uint8Array(xt?await V.arrayBuffer():V):Le(tt?En(V):V),j=C?Le(En(C)):null,G=Math.ceil(v.byteLength/se)+(C?1:0)||1,K=kn(G,(X,et)=>{const wt=et===G-1,lt=C&&et===0,dt=new Uint8Array(on+(lt?j.byteLength:wt?v.byteLength-se*(G-(C?2:1)):se));return dt.set(T),dt.set([R],Yn),dt.set([wt|lt<<1|F<<2|tt<<3],Kn),dt.set([Math.round((et+1)/G*Fn)],sn),dt.set(C?lt?j:v.subarray((et-1)*se,et*se):v.subarray(et*se,(et+1)*se),on),dt});return R=R+1&Fn,oe(p(A,async(X,et)=>{const{channel:wt}=et;let lt=0;for(;lt<G;){const dt=K[lt];if(wt.bufferedAmount>wt.bufferedAmountLowThreshold&&await new Promise(Tn=>{const Bn=()=>{wt.removeEventListener(mi,Bn),Tn()};wt.addEventListener(mi,Bn)}),!r[X])break;et.sendData(dt),lt++,q?.(dt[sn]/Fn,X,C)}}))}},o[_]||=[s[_].send,s[_].setOnComplete,s[_].setOnProgress]},E=(_,x)=>{const T=new Uint8Array(x),R=zn(T.subarray(sc,Yn)).replaceAll("\0",""),[V]=T.subarray(Yn,Kn),[A]=T.subarray(Kn,sn),[C]=T.subarray(sn,on),q=T.subarray(on),ct=!!(A&1),tt=!!(A&2),xt=!!(A&4),F=!!(A&8);if(!s[R]){console.warn(`${bn}: received message with unregistered type (${R})`);return}l[_]||={},l[_][R]||={};const v=l[_][R][V]||={chunks:[]};if(tt?v.meta=_n(zn(q)):v.chunks.push(q),s[R].onProgress(C/Fn,_,v.meta),!ct)return;const j=new Uint8Array(v.chunks.reduce((G,K)=>G+K.byteLength,0));if(v.chunks.reduce((G,K)=>(j.set(K,G),G+K.byteLength),0),delete l[_][R][V],xt)s[R].onComplete(j,_,v.meta);else{const G=zn(j);s[R].onComplete(F?_n(G):G,_)}},S=async()=>{await re(""),await new Promise(_=>setTimeout(_,99)),rs(r).forEach(([_,x])=>{x.destroy(),delete r[_]}),n()},[L,I]=b(Se("ping")),[P,it]=b(Se("pong")),[St,we]=b(Se("signal")),[ee,ne]=b(Se("stream")),[ht,ye]=b(Se("track")),[re,be]=b(Se("leave"));return e((_,x)=>{r[x]||(r[x]=_,_.setHandlers({data:T=>E(x,T),stream:T=>{u.onPeerStream(T,x,d[x]),delete d[x]},track:(T,R)=>{u.onPeerTrack(T,R,x,g[x]),delete g[x]},signal:T=>St(T,x),close:()=>w(x),error:T=>{console.error(T),w(x)}}),u.onPeerJoin(x))}),I((_,x)=>P("",x)),it((_,x)=>{f[x]?.(),delete f[x]}),we((_,x)=>r[x]?.signal(_)),ne((_,x)=>d[x]=_),ye((_,x)=>g[x]=_),be((_,x)=>w(x)),tc&&addEventListener("beforeunload",S),{makeAction:b,leave:S,ping:async _=>{if(!_)throw jt("ping() must be called with target peer ID");const x=Date.now();return L("",_),await new Promise(T=>f[_]=T),Date.now()-x},getPeers:()=>ec(rs(r).map(([_,x])=>[_,x.connection])),addStream:(_,x,T)=>p(x,async(R,V)=>{T&&await ee(T,R),V.addStream(_)}),removeStream:(_,x)=>p(x,(T,R)=>R.removeStream(_)),addTrack:(_,x,T,R)=>p(T,async(V,A)=>{R&&await ht(R,V),A.addTrack(_,x)}),removeTrack:(_,x)=>p(x,(T,R)=>R.removeTrack(_)),replaceTrack:(_,x,T,R)=>p(T,async(V,A)=>{R&&await ht(R,V),A.replaceTrack(_,x)}),onPeerJoin:_=>u.onPeerJoin=_,onPeerLeave:_=>u.onPeerLeave=_,onPeerStream:_=>u.onPeerStream=_,onPeerTrack:_=>u.onPeerTrack=_}},Mh=20,Rh=5333,wi=57333,vh=({init:e,subscribe:t,announce:n})=>{const r={};let s=!1,o,l,f,d;return(g,u,p)=>{const{appId:w}=g;if(r[w]?.[u])return r[w][u];const b={},E={},S=vn(bn,w,u),L=rn(S),I=rn(vn(S,Ae)),P=Ah(g.password||"",w,u),it=A=>async C=>({type:C.type,sdp:await A(P,C.sdp)}),St=it(Ih),we=it(Ch),ee=()=>gi(!0,g),ne=(A,C,q)=>{if(E[C]){E[C]!==A&&A.destroy();return}E[C]=A,V(A,C),b[C]?.forEach((ct,tt)=>{tt!==q&&ct.destroy()}),delete b[C]},ht=(A,C)=>{E[C]===A&&delete E[C]},ye=(A,C)=>{if(E[A])return;const q=b[A]?.[C];q&&(delete b[A][C],q.destroy())},re=A=>(l.push(...kn(A,ee)),oe(l.splice(0,A).map(C=>C.offerPromise.then(we).then(q=>({peer:C,offer:q}))))),be=(A,C)=>p?.({error:`incorrect password (${g.password}) when decrypting ${C}`,appId:w,peerId:A,roomId:u}),_=A=>async(C,q,ct)=>{const[tt,xt]=await oe([L,I]);if(C!==tt&&C!==xt)return;const{peerId:F,offer:v,answer:j,peer:G}=typeof q=="string"?_n(q):q;if(!(F===Ae||E[F])){if(F&&!v&&!j){if(b[F]?.[A])return;const[[{peer:K,offer:X}],et]=await oe([re(1),rn(vn(S,F))]);b[F]||=[],b[F][A]=K,setTimeout(()=>ye(F,A),x[A]*.9),K.setHandlers({connect:()=>ne(K,F,A),close:()=>ht(K,F)}),ct(et,En({peerId:Ae,offer:X}))}else if(v){if(b[F]?.[A]&&Ae>F)return;const X=gi(!1,g);X.setHandlers({connect:()=>ne(X,F,A),close:()=>ht(X,F)});let et;try{et=await St(v)}catch{be(F,"offer");return}if(X.isDead)return;const[wt,lt]=await oe([rn(vn(S,F)),X.signal(et)]);ct(wt,En({peerId:Ae,answer:await we(lt)}))}else if(j){let K;try{K=await St(j)}catch{be(F,"answer");return}if(G)G.setHandlers({connect:()=>ne(G,F,A),close:()=>ht(G,F)}),G.signal(K);else{const X=b[F]?.[A];X&&!X.isDead&&X.signal(K)}}}};if(!g)throw jt("requires a config map as the first argument");if(!w&&!g.firebaseApp)throw jt("config map is missing appId field");if(!u)throw jt("roomId argument required");if(!s){const A=e(g);l=kn(Mh,ee),o=Array.isArray(A)?A:[A],s=!0,f=setInterval(()=>l=l.filter(C=>{const q=Date.now()-C.created<wi;return q||C.destroy(),q}),wi*1.03),d=g.manualRelayReconnection?Vt:kh()}const x=o.map(()=>Rh),T=[],R=o.map(async(A,C)=>t(await A,await L,await I,_(C),re));oe([L,I]).then(([A,C])=>{const q=async(ct,tt)=>{const xt=await n(ct,A,C);typeof xt=="number"&&(x[tt]=xt),T[tt]=setTimeout(()=>q(ct,tt),x[tt])};R.forEach(async(ct,tt)=>{await ct,q(await o[tt],tt)})});let V=Vt;return r[w]||={},r[w][u]=Lh(A=>V=A,A=>delete E[A],()=>{delete r[w][u],T.forEach(clearTimeout),R.forEach(async A=>(await A)()),clearInterval(f),d(),s=!1})}},Hr={},ic={},Ze={},Qe={},tn={},yi={},Nn={},Oh="announce",oc=20,bi=10,Fh=33333,Nh=120333,$h=3,Ph=async e=>{if(Hr[e])return Hr[e];const t=(await rn(e)).slice(0,oc);return Hr[e]=t,ic[t]=e,t},ki=async(e,t,n)=>e.send(En({action:Oh,info_hash:await Ph(t),peer_id:Ae,...n})),Ei=(e,t,n)=>console.warn(`${bn}: torrent tracker ${n?"failure":"warning"} from ${e} - ${t}`),cc=vh({init:e=>mh(e,Vh,$h).map(t=>{const n=bh(t,s=>{const o=_n(s),l=o["failure reason"],f=o["warning message"],{interval:d}=o,g=ic[o.info_hash];if(l){Ei(r,l,!0);return}if(f&&Ei(r,f),d&&d*1e3>tn[r]&&Qe[r][g]){const u=Math.min(d*1e3,Nh);clearInterval(Ze[r][g]),tn[r]=u,Ze[r][g]=setInterval(Qe[r][g],u)}yi[o.offer_id]||(o.offer||o.answer)&&(yi[o.offer_id]=!0,Nn[r][g]?.(o))}),{url:r}=n;return Nn[r]={},n.ready}),subscribe:(e,t,n,r,s)=>{const{url:o}=e,l=async()=>{const f=ec((await s(bi)).map(d=>[Qo(oc),d]));Nn[e.url][t]=d=>{if(d.offer)r(t,{offer:d.offer,peerId:d.peer_id},(g,u)=>ki(e,t,{answer:_n(u).answer,offer_id:d.offer_id,to_peer_id:d.peer_id}));else if(d.answer){const g=f[d.offer_id];g&&r(t,{answer:d.answer,peerId:d.peer_id,peer:g.peer})}},ki(e,t,{numwant:bi,offers:rs(f).map(([d,{offer:g}])=>({offer_id:d,offer:g}))})};return tn[o]=Fh,Qe[o]||={},Qe[o][t]=l,Ze[o]||={},Ze[o][t]=setInterval(l,tn[o]),l(),()=>{clearInterval(Ze[o][t]),delete Nn[o][t],delete Qe[o][t]}},announce:e=>tn[e.url]}),Vh=["tracker.webtorrent.dev","tracker.openwebtorrent.com","tracker.btorrent.xyz","tracker.files.fm:7073/announce"].map(e=>"wss://"+e),af=["Aeromancy","Alchemy","Alteration","Animism","Astromancy","Chaos","Chronomancy","Conjuration","Cryomancy","Dark Arts","Destruction","Divination","Eldritch","Enchantment","Evocation","Geomancy","Hydromancy","Illusion","Invocation","Necromancy","Oneiromancy","Order","Primal","Protection","Psychomancy","Pyromancy","Shadowmancy","Skullduggery","Spiritualism","Symbolism","Technomancy","Teleportation","War"],uf={NEXT_ROLL:"Prxima Rolagem",ROUNDS:"Rodadas",MINUTES:"Minutos",HOURS:"Horas",DAYS:"Dias",LUCK_ENDS:"Sorte Encerra",PERMANENT:"Indeterminado"},bt={WEAPON:"Weapon",ARMOR:"Armor",SHIELD:"Shield",CONSUMABLE:"Consumable",EXPLOSIVE:"Explosive",OTHER:"Other"},Me={ADD:"ADD",SET:"SET",MULT:"MULT"},hf={str:"Fora",agi:"Agilidade",int:"Intelecto",wil:"Vontade",defense:"Defesa",speed:"Deslocamento",health:"Vida",damage:"Dano (Dados)",boons:"Boons/Banes"},ff={Blinded:{effect:"Make rolls with 3 banes. No sight reactions. Speed halved.",speedMult:.5,rollMod:-3},Confused:{effect:"No reactions. Intellect and Will rolls with 1 bane.",rollMod:-1,attributes:["int","wil"]},Controlled:{effect:"Controller decides your turn. Regard source as ally."},Cursed:{effect:"Luck rolls with 1 bane."},Deafened:{effect:"No hearing reactions. Immune to hearing effects."},Frightened:{effect:"Attribute rolls with 1 bane (while in LOS). Grant 1 boon on rolls against you.",rollMod:-1},Held:{effect:"Speed 0. Cannot increase Speed. Auto-fail Agility defense rolls.",speedFixed:0},Impaired:{effect:"Roll with 1 bane for specified attribute. Grant 1 boon against that attribute.",rollMod:-1},Incapacitated:{effect:"Damage equals or exceeds Health. You cannot use actions or reactions. Speed 0.",speedFixed:0},"On Fire":{effect:"Take 1d6 damage at end of round. Action/Luck roll to extinguish."},Poisoned:{effect:"Attribute rolls with 1 bane. Grant 1 boon against you. Lose 1d6 Health end of round.",rollMod:-1},Prone:{effect:"No reactions. Grant 1 boon to melee vs you, impose 1 bane to ranged vs you."},Slowed:{effect:"Speed drops to 2 (if higher). Cannot benefit from Speed increases.",speedCap:2},Stunned:{effect:"No actions/reactions. Speed 0. Grant 2 boons against you. Attribute rolls with 2 banes.",speedFixed:0,rollMod:-2},Unconscious:{effect:"No actions/reactions. Speed 0. Grant 3 boons against you. Auto-fail attribute rolls.",speedFixed:0,autoFail:!0},Vulnerable:{effect:"Grant 1 boon on attacks/rolls against you."},Weakened:{effect:"Strength/Agility rolls with 1 bane. Grant 1 boon vs Str/Agi. Speed halved.",speedMult:.5,attributes:["str","agi"],rollMod:-1}},jh={OFF:"Off",ONE:"One",TWO:"Two"},Hh={name:"Alaric, o Errante",level:3,ancestry:"Humano",paths:{novice:"Mago",expert:"Alquimista",master:"-"},attributes:[{name:"Fora",value:10,key:"str"},{name:"Agilidade",value:12,key:"agi"},{name:"Intelecto",value:15,key:"int"},{name:"Vontade",value:11,key:"wil"}],currency:{gp:0,sp:0,cp:0},naturalDefense:10,bonusDamage:0,speed:10,currentRound:1,languages:["Comum","lfico"],afflictions:[],effects:[],notes:"",campaignId:null,campaignName:null,gmName:null,combatActive:!1,initiative:!1,acted:!1,spells:[{id:1,name:"Seta de Energia",tier:"Novice",type:"Ataque",tradition:"Destruction",description:"Causa 1d6 de dano a um alvo em alcance curto.",castings:3,maxCastings:3,effect:null},{id:2,name:"Escudo Mgico",tier:"Novice",type:"Utilidade",tradition:"Protection",description:"+2 em Defesa por 1 minuto.",castings:2,maxCastings:2,effect:{id:999,name:"Escudo Mgico",duration:"MINUTES",roundsLeft:10,initialRounds:10,description:"+2 Defesa",isActive:!0,modifiers:[{target:"defense",type:Me.ADD,value:2}]}}],talents:[{id:1,name:"Sentido Arcano",description:"Voc detecta magia a curto alcance.",uses:0,maxUses:0,isPassive:!0,effect:null},{id:2,name:"Sorte do Principiante",description:"Pode refazer um teste falho.",uses:1,maxUses:1,isPassive:!1,effect:null}],equipment:[{id:1,name:"Cajado",type:bt.WEAPON,quantity:1,price:5,availability:"Common",quality:"Standard",grip:jh.TWO,range:"Melee",damageDice:1,boonsBanes:0,traits:"Finesse, Versatile",equippedState:null,equipped:!1},{id:2,name:"Poo de Cura",type:bt.CONSUMABLE,quantity:3,price:10,availability:"Common",quality:"Standard",notes:"Recupera Healing Rate",equippedState:null,equipped:!1},{id:3,name:"Granada Alqumica",type:bt.EXPLOSIVE,quantity:2,price:15,availability:"Uncommon",quality:"Standard",damageDice:2,range:"Short",traits:"Blast",description:"Explode em rea curta causando 2d6 de dano.",equippedState:null,equipped:!1},{id:4,name:"Couro Batido",type:bt.ARMOR,quantity:1,price:20,availability:"Common",quality:"Standard",defenseType:"fixed",defenseFixed:12,armorWeight:"Light",equipped:!1,equippedState:null}]},D=Nt(Hh),_i=Nt([]),$n=Nt({type:null,isOpen:!1,data:null}),df=Nt("acoes"),Fs=Nt(24),ze=Nt(24),We=Nt(0),Si=Nt(!1),Ye=It(D,e=>e.effects.filter(t=>t.isActive));function Ar(e,t,n){let r=t||0;const s=n.flatMap(d=>Array.isArray(d.modifiers)?d.modifiers:[]),o=s.filter(d=>d.target===e&&d.type===Me.SET);return o.length>0&&(r=o[o.length-1].value),s.filter(d=>d.target===e&&d.type===Me.ADD).forEach(d=>{r+=d.value}),s.filter(d=>d.target===e&&d.type===Me.MULT).forEach(d=>{r*=d.value}),Math.floor(r)}const lc=It([D,Ye],([e,t])=>{const n={};return e.attributes.forEach(r=>{n[r.key]=Ar(r.key,r.value,t)}),n}),qh=It([ze,Ye],([e,t])=>Ar("health",e,t)),pf=It([qh,Fs],([e,t])=>Math.max(0,e-t)),gf=It([We,ze],([e,t])=>t>0?Math.min(100,e/t*100):100),Gh=It([We,ze],([e,t])=>e>=t),mf=It([We,ze,Gh],([e,t,n])=>e>=t/2&&!n),wf=It([D,lc,Ye],([e,t,n])=>{let r=Ar("speed",e.speed,n);const s=e.afflictions;return s.includes("Held")||s.includes("Stunned")||s.includes("Unconscious")||s.includes("Incapacitated")?0:((s.includes("Blinded")||s.includes("Weakened"))&&(r=Math.floor(r/2)),s.includes("Slowed")&&(r=Math.min(r,2)),Math.max(0,r))}),yf=It([D,Ye],([e,t])=>{let n=e.naturalDefense,r=0;const s=e.equipment.find(o=>o.type===bt.ARMOR&&o.equipped);if(s){const o=s.defenseFixed||0,l=e.naturalDefense+(s.defenseMod||0);s.defenseFixed&&s.defenseMod?n=Math.max(o,l):s.defenseFixed?n=o:s.defenseMod&&(n=e.naturalDefense+s.defenseMod)}return e.equipment.filter(o=>o.type===bt.SHIELD&&o.equippedState).forEach(o=>{r+=o.defenseMod||0}),Ar("defense",n+r,t)}),Jh=It([D,Ye],([e,t])=>{const r=t.flatMap(s=>Array.isArray(s.modifiers)?s.modifiers:[]).filter(s=>s.target==="damage"&&s.type===Me.ADD).reduce((s,o)=>s+o.value,0);return(e.bonusDamage||0)+r}),Pt={updateCurrency:(e,t)=>{D.update(n=>{let r=n.currency.gp*100+n.currency.sp*10+n.currency.cp,s=0;return e==="gp"&&(s=t*100),e==="sp"&&(s=t*10),e==="cp"&&(s=t),r+=s,r<0&&(r=0),{...n,currency:{gp:Math.floor(r/100),sp:Math.floor(r%100/10),cp:r%100%10}}})},advanceRound:e=>{D.update(t=>{const n=t.currentRound||1;if(e==="next"){const r=(t.effects||[]).map(s=>{if(s.isActive&&s.duration==="ROUNDS"&&s.roundsLeft>0){const o=s.roundsLeft-1;return o<=0?{...s,roundsLeft:0,isActive:!1}:{...s,roundsLeft:o}}return s});return{...t,currentRound:n+1,effects:r}}else return{...t,currentRound:Math.max(1,n-1)}})},addToHistory:(e,t=!0)=>{const n=Kt(D),r={id:Date.now(),timestamp:new Date,charName:n.name,...e};_i.update(s=>[r,...s]),Si.set(!0),t&&n.campaignId&&Ps(async()=>{const{syncRoll:s}=await Promise.resolve().then(()=>xi);return{syncRoll:s}},void 0,import.meta.url).then(({syncRoll:s})=>{s(r)})},clearHistory:()=>_i.set([]),addItem:e=>D.update(t=>({...t,equipment:[...t.equipment,e]})),updateItem:e=>D.update(t=>({...t,equipment:t.equipment.map(n=>n.id===e.id?e:n)})),deleteItem:e=>D.update(t=>({...t,equipment:t.equipment.filter(n=>n.id!==e)})),useConsumable:e=>{e.quantity>0&&(Pt.updateItem({...e,quantity:e.quantity-1}),Pt.addToHistory({source:"Consumvel",name:e.name,description:`Usou ${e.name} `}))},equipItem:(e,t=null)=>{D.update(n=>{let r=[...n.equipment];return e.type===bt.ARMOR?r=r.map(s=>s.id===e.id?{...s,equipped:!s.equipped}:s.type===bt.ARMOR&&e.type===bt.ARMOR&&!e.equipped?{...s,equipped:!1}:s):(e.type===bt.WEAPON||e.type===bt.SHIELD)&&(r=r.map(s=>s.id===e.id?{...s,equippedState:t}:s)),{...n,equipment:r}})},toggleAffliction:e=>{D.update(t=>t.afflictions.includes(e)?{...t,afflictions:t.afflictions.filter(n=>n!==e)}:{...t,afflictions:[...t.afflictions,e]})},addLanguage:e=>D.update(t=>({...t,languages:[...t.languages,e]})),removeLanguage:e=>D.update(t=>({...t,languages:t.languages.filter((n,r)=>r!==e)})),confirmRest:()=>{D.update(t=>{const n=t.spells.map(s=>({...s,castings:s.maxCastings})),r=t.talents.map(s=>({...s,uses:s.maxUses}));return{...t,spells:n,talents:r}}),We.set(0);const e=Kt(Fs);ze.set(e),$n.set({type:null,isOpen:!1,data:null})},finalizeRoll:(e,t,n=[])=>{const r=Kt(D),s=Kt(lc),o=e.type==="weapon_attack",l=e.type==="luck",f=e.type==="weapon_damage",d=e.source.name||"Ao";if(f){const g=e.source,u=(I,P)=>I.traits&&I.traits.toLowerCase().includes(P.toLowerCase());let p=g.damageDice||0;u(g,"Versatile")&&g.equippedState==="two"&&(p+=1);let w=r.bonusDamage||0;u(g,"Light")&&w>0&&(w-=1),Kt(Jh);const b=Kt(Ye).flatMap(I=>Array.isArray(I.modifiers)?I.modifiers:[]).filter(I=>I.target==="damage"&&I.type===Me.ADD).reduce((I,P)=>I+P.value,0);w+=b;const E=Math.max(0,p+w+t);let S=[],L=0;for(let I=0;I<E;I++){let P=Math.floor(Math.random()*6)+1;P===1&&u(g,"Brutal")&&(P=Math.floor(Math.random()*6)+1),S.push(P),L+=P}Pt.addToHistory({source:"Dano",name:g.name,description:`Dano: ${E} d6`,formula:`${E} d6[${S.join(",")}]`,total:L,effectsApplied:n}),g.type===bt.EXPLOSIVE&&Pt.useConsumable(g)}else{const g=Math.floor(Math.random()*20)+1;let u=0;e.type==="attribute"&&(u=(s[e.source.key]||e.source.value)-10);let p=0,w="";if(t!==0){const L=Math.abs(t);let I=[];for(let it=0;it<L;it++)I.push(Math.floor(Math.random()*6)+1);const P=Math.max(...I);t>0?(p=P,w=` + ${P} [Boon]`):(p=-P,w=` - ${P} [Bane]`)}const b=g+u+p;let E=o?`Ataque(${t} boons / banes)`:l?"Teste de Sorte":`Teste de ${d} `;const S=(L,I)=>L.traits&&L.traits.toLowerCase().includes(I.toLowerCase());if(o&&g===20){const L=e.source;let I=[];S(L,"Bludgeoning")&&I.push("Vuln"),S(L,"Piercing")&&I.push("Weakened"),S(L,"Slashing")&&I.push("+1d6 Dmg"),I.length>0&&(E+=`
CRTICO! ${I.join(" ")} `)}Pt.addToHistory({source:o?"Ataque":l?"Sorte":"Atributo",name:d,description:E,formula:`d20(${g})${u!==0?(u>0?"+":"")+u:""}${w} `,total:b,crit:g===20,effectsApplied:n}),D.update(L=>({...L,effects:L.effects.map(I=>I.isActive&&I.duration==="NEXT_ROLL"?{...I,isActive:!1}:I)}))}$n.set({type:null,isOpen:!1,data:null}),Si.set(!0)},addSpell:e=>D.update(t=>({...t,spells:[...t.spells,e]})),updateSpell:e=>D.update(t=>({...t,spells:t.spells.map(n=>n.id===e.id?e:n)})),deleteSpell:e=>D.update(t=>({...t,spells:t.spells.filter(n=>n.id!==e)})),commitSpellCast:e=>{e.castings>0&&(D.update(t=>({...t,spells:t.spells.map(n=>n.id===e.id?{...n,castings:n.castings-1}:n)})),Pt.addToHistory({source:"Magia",name:e.name,description:e.description}),$n.set({type:null,isOpen:!1,data:null}))},addTalent:e=>D.update(t=>({...t,talents:[...t.talents,e]})),updateTalent:e=>D.update(t=>({...t,talents:t.talents.map(n=>n.id===e.id?e:n)})),deleteTalent:e=>D.update(t=>({...t,talents:t.talents.filter(n=>n.id!==e)})),commitTalentUse:e=>{e.maxUses&&D.update(t=>({...t,talents:t.talents.map(n=>n.id===e.id?{...n,uses:n.uses-1}:n)})),Pt.addToHistory({source:"Talento",name:e.name,description:e.description}),$n.set({type:null,isOpen:!1,data:null})},recoverTalent:e=>{D.update(t=>({...t,talents:t.talents.map(n=>n.id===e&&n.uses<n.maxUses?{...n,uses:n.uses+1}:n)}))},addEffect:e=>D.update(t=>({...t,effects:[...t.effects,e]})),updateEffect:e=>D.update(t=>({...t,effects:t.effects.map(n=>n.id===e.id?e:n)})),deleteEffect:e=>D.update(t=>({...t,effects:t.effects.filter(n=>n.id!==e)})),toggleEffect:e=>D.update(t=>({...t,effects:t.effects.map(n=>{if(n.id===e){const r=!n.isActive;return{...n,isActive:r,roundsLeft:r&&n.duration==="ROUNDS"&&n.initialRounds||n.roundsLeft}}return n})})),cleanInactiveEffects:()=>D.update(e=>({...e,effects:e.effects.filter(t=>t.isActive)})),applyEffectToCharacter:(e,t)=>{const n=e.name||(t?t.name:"Efeito sem nome"),r=e.description||(t?t.description:""),s={...e,id:Date.now(),isActive:!0,name:n,description:r};s.duration==="ROUNDS"&&!s.initialRounds&&(s.initialRounds=s.roundsLeft),D.update(o=>({...o,effects:[...o.effects,s]}))},checkLuckEnds:e=>{const t=Math.floor(Math.random()*20)+1,n=t>=10;Pt.addToHistory({source:"Sorte",name:"Check Fim Efeito",description:`Rolou ${t}. ${n?"Sucesso (Encerra)":"Falha"} `}),n&&D.update(r=>({...r,effects:r.effects.map(s=>s.id===e?{...s,isActive:!1}:s)}))},joinCampaign:e=>{D.update(t=>({...t,campaignId:e.id,campaignName:e.name,gmName:e.gmName||"Mestre"})),Ps(async()=>{const{joinCampaignRoom:t}=await Promise.resolve().then(()=>xi);return{joinCampaignRoom:t}},void 0,import.meta.url).then(({joinCampaignRoom:t})=>{t(e.id,!1)})},leaveCampaign:()=>{D.update(e=>({...e,campaignId:null,campaignName:null,gmName:null,combatActive:!1}))}};We.subscribe(e=>{});const ac={appId:Zo,trackerUrls:["wss://tracker.openwebtorrent.com","wss://tracker.files.fm:7073/announce","wss://tracker.webtorrent.dev","wss://toad.vibe.community:443/announce","wss://tracker.btorrent.xyz"]},ce=Nt({roomId:null,peers:[],currentCharacterId:null,lastGmUpdate:0,isGM:!1,isConnected:!1}),zh=It(ce,e=>e.lastGmUpdate?Date.now()-e.lastGmUpdate<6e4:!1);let Bt=null,qr=null,is=null,os=null,cs=null,ls=null;const Wh={appId:"weird-wizard-vault-lobby"},as=Nt([]);function uc(){if(qr)return;qr=cc(Wh,"public-discovery");const[e,t]=qr.makeAction("discovery");return t(n=>{as.update(r=>{const s=r.findIndex(o=>o.id===n.id);if(s!==-1){const o=[...r];return o[s]={...n,lastSeen:Date.now()},o}return[...r,{...n,lastSeen:Date.now()}]})}),setInterval(()=>{const n=Date.now();as.update(r=>r.filter(s=>n-s.lastSeen<12e4))},6e4),e}let hc;function Yh(){typeof window<"u"&&(hc=uc())}Yh();function Kh(e,t=!1,n=null){Bt&&Bt.leave(),Bt=cc(ac,`campaign-${e}`),ce.set({isConnected:!0,isGM:t,currentCharacterId:n,peers:[],roomId:e,lastGmUpdate:0});const[r,s]=Bt.makeAction("combat"),[o,l]=Bt.makeAction("history"),[f,d]=Bt.makeAction("charUpdate"),[g,u]=Bt.makeAction("campaign");return is=r,os=o,cs=f,ls=g,s(p=>{t||D.update(w=>({...w,currentRound:p.round,combatActive:p.active}))}),u(p=>{ce.update(w=>({...w,lastGmUpdate:Date.now()})),t||D.update(w=>({...w,campaignName:p.name,gmName:p.gmName,passwordHash:p.passwordHash}))}),t&&setInterval(()=>{const p=nn.get(e);p&&p.isPublished&&hc({id:e,name:p.name,gmName:p.gmName||"Mestre",description:p.description})},3e4),l(p=>{Pt.addToHistory(p,!1)}),d(p=>{if(t){const w=nn.get(e);if(w){const b=w.members||[],E=b.findIndex(it=>it.id===p.id);let S;if(E!==-1){S=[...b];const it=S[E],St={...p};it.campaignApproval==="approved"&&p.campaignApproval==="pending"&&delete St.campaignApproval,S[E]={...it,...St,lastUpdate:Date.now()}}else S=[...b,{...p,lastUpdate:Date.now()}];const L=w.activeEnemies||[],I=L.findIndex(it=>it.id===p.id&&it.type==="player");let P=L;I!==-1&&(P=[...L],P[I]={...P[I],...p}),nn.set(e,{...w,members:S,activeEnemies:P})}}else{const w=Kt(ce),b=Kt(D),E=w.currentCharacterId||b?.id;if(E&&E===p.id){if(p.campaignApproval==="rejected"||p.campaignId===null){D.update(S=>({...S,campaignId:null,campaignName:null,gmName:null,campaignApproval:null}));return}D.update(S=>({...S,name:p.name||S.name,afflictions:p.afflictions||S.afflictions,initiative:p.initiative!==void 0?p.initiative:S.initiative??!1,acted:p.acted!==void 0?p.acted:S.acted??!1,campaignApproval:p.campaignApproval||S.campaignApproval})),p.damage!==void 0&&We.set(p.damage),p.currentHealth!==void 0&&ze.set(p.currentHealth),p.normalHealth!==void 0&&Fs.set(p.normalHealth)}}}),Bt.onPeerJoin(p=>{if(ce.update(w=>({...w,peers:[...w.peers,p]})),t){const w=nn.get(e);w&&(w.combat&&r(w.combat),g({name:w.name,gmName:w.gmName||"Mestre",passwordHash:w.passwordHash}))}}),Bt.onPeerLeave(p=>{ce.update(w=>({...w,peers:w.peers.filter(b=>b!==p)}))}),Bt}function Xh(e,t){is&&is(t)}function Zh(e,t){ls&&ls({name:t.name,gmName:t.gmName||"Mestre",passwordHash:t.passwordHash})}function Qh(e){os&&os(e)}function tf(e){cs&&cs(e)}const xi=Object.freeze(Object.defineProperty({__proto__:null,isGmOnline:zh,joinCampaignRoom:Kh,joinLobby:uc,publicCampaigns:as,roomConfig:ac,syncCampaign:Zh,syncCharacter:tf,syncCombat:Xh,syncRoll:Qh,syncState:ce},Symbol.toStringTag,{value:"Module"}));export{Fs as A,ze as B,Ye as C,of as D,uf as E,hf as F,jh as G,Me as H,bt as I,ff as J,lc as K,yf as L,af as M,wf as N,df as O,Hh as P,lf as Q,Kh as a,sf as b,D as c,ch as d,nn as e,lh as f,ah as g,Pt as h,zh as i,cc as j,_i as k,tf as l,Zh as m,Si as n,Xh as o,as as p,Gh as q,ac as r,Ae as s,mf as t,We as u,qh as v,uh as w,gf as x,pf as y,$n as z};
